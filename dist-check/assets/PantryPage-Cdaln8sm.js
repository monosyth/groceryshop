import{d as Pe,j as e,Q as Te,r as l,af as We,ag as Ue,q as G,z as Be,B as s,w as r,U as $,V as ie,W as y,ay as O,T as m,x,E as g,F as p,D as M,at as Le,X as H,C as f,N as z,M as le,L as ce,K as de,J as xe,y as K,I as me,S as Ne,G as Ge,l as h,p as ge,n as Me,o as He,k as R,m as q}from"./index-By-6PO1w.js";import{c as Y,a as Ke}from"./geminiService-CitDXh9M.js";import{b as qe}from"./pantryService-Bl5Oo3Za.js";import{C as J,a as pe}from"./CardContent-CwRIKd-V.js";import{T as ue}from"./TextField-CHzrXbs_.js";import{A as Ye}from"./Add-Cv_fQIv4.js";import{C as fe,U as Je}from"./Upload-BmflQxF4.js";import{G as he}from"./Grid-BKQ8lC-W.js";import{C as Qe}from"./Chip-DTceX4T0.js";import{E as ye}from"./Edit-B8JdMMSW.js";import{D as Xe}from"./Delete-Cw3wusZf.js";import{D as be,a as je,b as ve,c as Ie}from"./DialogTitle-Bbffd3dE.js";import{G as Ze,S as _e,E as Ve,B as et,A as tt,L as rt,F as st,C as at,I as nt}from"./SetMeal-CvO5cnUN.js";import{R as ot}from"./Receipt-D1omZUZU.js";import"./useFormControl-CIlIf9Fu.js";const it=Pe(e.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}));function Ct(){const{currentUser:b}=Te(),[u,Se]=l.useState([]),[ze,Q]=l.useState(!0),[C,X]=l.useState(""),[P,Z]=l.useState(!1),[j,T]=l.useState(!1),[W,_]=l.useState(!1),[k,i]=l.useState({open:!1,message:"",severity:"info"}),[Ce,U]=l.useState(!1),[w,B]=l.useState(null),[v,D]=l.useState(""),[I,V]=l.useState(!1),[ke,E]=l.useState(!1),[A,ee]=l.useState(null),[F,L]=l.useState([]),te=l.useRef(null),re=l.useRef(null),we=[{value:"produce",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ze,{sx:{fontSize:16,color:r.main}})," Produce"]}),color:r.main},{value:"meat",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(_e,{sx:{fontSize:16,color:f.main}})," Meat & Seafood"]}),color:f.main},{value:"dairy",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ve,{sx:{fontSize:16,color:z.main}})," Dairy & Eggs"]}),color:z.main},{value:"bakery",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(et,{sx:{fontSize:16,color:g.main}})," Bakery"]}),color:g.main},{value:"frozen",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(tt,{sx:{fontSize:16,color:le.main}})," Frozen"]}),color:le.main},{value:"pantry",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(O,{sx:{fontSize:16,color:ce.main}})," Pantry"]}),color:ce.main},{value:"beverages",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(rt,{sx:{fontSize:16,color:de.main}})," Beverages"]}),color:de.main},{value:"snacks",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(st,{sx:{fontSize:16,color:xe.main}})," Snacks"]}),color:xe.main},{value:"household",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(at,{sx:{fontSize:16,color:p.main}})," Household"]}),color:p.main},{value:"other",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(nt,{sx:{fontSize:16,color:p.main}})," Other"]}),color:p.main}];l.useEffect(()=>{if(!b)return;const t=We(G(h,"pantry"),Ue("userId","==",b.uid)),o=Be(t,a=>{const n=[];a.forEach(c=>{n.push({id:c.id,...c.data()})}),n.sort((c,d)=>{const S=c.createdAt?.toDate()||new Date(0);return(d.createdAt?.toDate()||new Date(0))-S}),Se(n),Q(!1)},a=>{console.error("Error fetching pantry:",a),Q(!1)});return()=>o()},[b]);const se=async()=>{if(!C.trim()){i({open:!0,message:"Please enter an item name",severity:"warning"});return}Z(!0);try{const t=await Y(C.trim());await ge(G(h,"pantry"),{userId:b.uid,name:C.trim().toLowerCase(),category:t,source:"manual",createdAt:Me()}),X(""),i({open:!0,message:"Item added to pantry!",severity:"success"})}catch(t){console.error("Error adding item:",t),i({open:!0,message:"Failed to add item",severity:"error"})}finally{Z(!1)}},ae=async t=>{const o=t.target.files?.[0];if(o){T(!0);try{const a=new FileReader;a.onload=async n=>{const c=n.target.result.split(",")[1];try{const d=await Ke(c);if(d.length>0)try{const S=await qe(b.uid,d);i({open:!0,message:`Found ${d.length} ingredient${d.length!==1?"s":""} and added ${S} to pantry!`,severity:"success"})}catch(S){console.error("Error adding to pantry:",S),i({open:!0,message:`Found ${d.length} ingredient${d.length!==1?"s":""}, but couldn't add to pantry`,severity:"warning"})}else i({open:!0,message:"No ingredients found in photo",severity:"info"})}catch(d){console.error("Error analyzing photo:",d),i({open:!0,message:d.message.includes("API")?"Please add your Gemini API key to use this feature":"Failed to analyze photo. Please try again.",severity:"error"})}finally{T(!1)}},a.readAsDataURL(o)}catch(a){console.error("Error reading file:",a),T(!1),i({open:!0,message:"Failed to read image file",severity:"error"})}}},De=t=>{ee(t),E(!0)},Ee=async()=>{if(A)try{const t={type:"delete",item:{...A},timestamp:Date.now()};L(o=>[t,...o].slice(0,30)),await He(R(h,"pantry",A.id)),i({open:!0,message:"Item removed from pantry",severity:"success"})}catch(t){console.error("Error deleting item:",t),i({open:!0,message:"Failed to delete item",severity:"error"})}finally{E(!1),ee(null)}},Ae=t=>{B(t.id),D(t.name),U(!0)},ne=async()=>{if(!(!w||!v.trim())){V(!0);try{const t=u.find(n=>n.id===w),o=await Y(v.trim());await q(R(h,"pantry",w),{name:v.trim(),category:o});const a={type:"edit",itemId:w,oldData:{name:t.name,category:t.category},timestamp:Date.now()};L(n=>[a,...n].slice(0,30)),i({open:!0,message:"Item updated and recategorized successfully",severity:"success"}),U(!1),B(null),D("")}catch(t){console.error("Error updating item:",t),i({open:!0,message:"Failed to update item",severity:"error"})}finally{V(!1)}}},Fe=async()=>{if(F.length===0)return;const[t,...o]=F;try{if(t.type==="delete"){const{item:a}=t,{id:n,...c}=a;await ge(G(h,"pantry"),c),i({open:!0,message:`Restored: ${a.name}`,severity:"success"})}else t.type==="edit"&&(await q(R(h,"pantry",t.itemId),t.oldData),i({open:!0,message:"Edit undone",severity:"success"}));L(o)}catch(a){console.error("Error undoing operation:",a),i({open:!0,message:"Failed to undo",severity:"error"})}},oe=()=>{U(!1),B(null),D("")},$e=async()=>{const t=u.filter(n=>!n.category||n.category==="other");if(t.length===0){i({open:!0,message:"All items are already categorized!",severity:"info"});return}_(!0);let o=0,a=0;try{for(const n of t)try{const c=await Y(n.name);c&&c!=="other"?(await q(R(h,"pantry",n.id),{category:c}),o++):a++}catch(c){console.error(`Error recategorizing ${n.name}:`,c),a++}i({open:!0,message:`Recategorized ${o} items${a>0?`, ${a} remained as 'other'`:""}`,severity:o>0?"success":"info"})}catch(n){console.error("Error recategorizing items:",n),i({open:!0,message:"Failed to recategorize items",severity:"error"})}finally{_(!1)}},N=u.reduce((t,o)=>{const a=o.category||"other";return t[a]||(t[a]=[]),t[a].push(o),t},{}),Oe=["produce","meat","dairy","bakery","frozen","pantry","beverages","snacks","household","other"].filter(t=>N[t]&&N[t].length>0),Re=t=>{switch(t){case"receipt":return e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:"6px",bgcolor:z.bg,border:`1.5px solid ${z.main}`},children:e.jsx(ot,{sx:{fontSize:16,color:z.dark}})});case"photo":return e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:"6px",bgcolor:f.bg,border:`1.5px solid ${f.main}`},children:e.jsx(fe,{sx:{fontSize:16,color:f.darker}})});case"manual":return e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:"6px",bgcolor:r.bg,border:`1.5px solid ${r.main}`},children:e.jsx(ye,{sx:{fontSize:16,color:r.darker}})});default:return e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:"6px",bgcolor:K.borderLight,border:`1.5px solid ${p.main}`},children:e.jsx(O,{sx:{fontSize:16,color:M.dark}})})}};return ze?e.jsx(s,{sx:{background:`linear-gradient(180deg, ${r.bg} 0%, ${$} 100%)`,minHeight:"100vh",pb:4},children:e.jsx(ie,{maxWidth:"lg",children:e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(y,{size:60,sx:{color:r.main}})})})}):e.jsxs(s,{sx:{background:`linear-gradient(180deg, ${r.bg} 0%, ${$} 100%)`,minHeight:"100vh",pb:4},children:[e.jsxs(ie,{maxWidth:"lg",children:[e.jsxs(s,{sx:{pt:4,pb:3},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"start",mb:1},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(O,{sx:{fontSize:{xs:32,md:40},color:r.main}}),e.jsx(m,{variant:"h3",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,color:r.main,fontSize:{xs:"28px",md:"34px"}},children:"My Pantry"})]}),e.jsxs(s,{sx:{display:"flex",gap:1},children:[F.length>0&&e.jsxs(x,{size:"small",onClick:Fe,startIcon:e.jsx(it,{}),sx:{fontFamily:"Outfit, sans-serif",fontSize:"12px",textTransform:"none",color:g.main,border:`1px solid ${g.main}`,borderRadius:"8px",px:2,py:.75,"&:hover":{bgcolor:r.bg,border:`1px solid ${g.dark}`}},children:["Undo (",F.length,")"]}),u.length>0&&e.jsx(x,{size:"small",onClick:$e,disabled:W,startIcon:W?e.jsx(y,{size:16}):null,sx:{fontFamily:"Outfit, sans-serif",fontSize:"12px",textTransform:"none",color:r.main,border:`1px solid ${r.main}`,borderRadius:"8px",px:2,py:.75,"&:hover":{bgcolor:r.bg,border:`1px solid ${r.dark}`},"&:disabled":{color:M.light,border:`1px solid ${p.light}`}},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Le,{sx:{fontSize:16}}),W?"Analyzing...":"AI Categorize"]})})]})]}),e.jsxs(m,{sx:{fontFamily:"Outfit, sans-serif",color:r.dark,fontSize:"16px"},children:["Your current inventory - ",u.length," item",u.length!==1?"s":""]})]}),e.jsx(J,{sx:{bgcolor:r.bg,borderRadius:"12px",border:`2px solid ${r.main}`,boxShadow:`3px 3px 0px ${r.light}`,mb:3},children:e.jsxs(pe,{sx:{p:2.5},children:[e.jsxs(s,{sx:{display:"flex",gap:1.5,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(ue,{placeholder:"Add item to pantry...",value:C,onChange:t=>X(t.target.value),onKeyPress:t=>t.key==="Enter"&&se(),disabled:P,sx:{flex:"1 1 250px","& .MuiOutlinedInput-root":{bgcolor:$,fontFamily:"Outfit, sans-serif"}}}),e.jsx(x,{variant:"contained",startIcon:P?e.jsx(y,{size:16}):e.jsx(Ye,{}),onClick:se,disabled:P,sx:{bgcolor:r.main,fontFamily:"Outfit, sans-serif",textTransform:"none",px:3,"&:hover":{bgcolor:r.dark}},children:"Add"}),e.jsx(x,{variant:"outlined",startIcon:j?e.jsx(y,{size:16}):e.jsx(fe,{}),onClick:()=>re.current?.click(),disabled:j,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:r.main,borderColor:r.main,px:2,"&:hover":{borderColor:r.dark,bgcolor:r.bg}},children:"Photo"}),e.jsx(x,{variant:"outlined",startIcon:j?e.jsx(y,{size:16}):e.jsx(Je,{}),onClick:()=>te.current?.click(),disabled:j,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:r.main,borderColor:r.main,px:2,"&:hover":{borderColor:r.dark,bgcolor:r.bg}},children:"Upload"})]}),j&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1,mt:2},children:[e.jsx(y,{size:20,sx:{color:r.main}}),e.jsx(m,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",color:r.dark,fontSize:"13px"},children:"Analyzing photo..."})]}),e.jsx("input",{ref:re,type:"file",accept:"image/*",capture:"environment",style:{display:"none"},onChange:ae}),e.jsx("input",{ref:te,type:"file",accept:"image/*",style:{display:"none"},onChange:ae})]})}),u.length===0?e.jsxs(J,{sx:{bgcolor:g.bg,borderRadius:"16px",border:`2px solid ${g.main}`,boxShadow:`3px 3px 0px ${g.light}`,p:5,textAlign:"center"},children:[e.jsx(O,{sx:{fontSize:56,color:H.main,mb:2}}),e.jsx(m,{variant:"h5",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,color:H.main,mb:1,fontSize:"20px"},children:"Your Pantry is Empty"}),e.jsx(m,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",fontWeight:400,color:H.dark},children:"Add items manually, take a pantry photo, or upload receipts to build your inventory!"})]}):e.jsx(he,{container:!0,spacing:2.5,children:Oe.map(t=>{const o=we.find(n=>n.value===t),a=N[t];return e.jsx(he,{item:!0,xs:12,sm:6,md:6,lg:4,children:e.jsx(J,{sx:{bgcolor:$,borderRadius:"12px",border:`2px solid ${K.border}`,boxShadow:`2px 2px 0px ${K.borderLight}`,height:"100%"},children:e.jsxs(pe,{sx:{p:2.5},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(m,{variant:"h6",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,color:o.color,fontSize:"16px"},children:o.label}),e.jsx(Qe,{label:a.length,size:"small",sx:{height:"20px",fontSize:"11px",fontFamily:"Outfit, sans-serif",bgcolor:`${o.color}15`,color:o.color,fontWeight:600}})]}),e.jsx(s,{sx:{display:"flex",flexDirection:"column",gap:1},children:a.map(n=>e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1,borderRadius:"8px",bgcolor:p.bg,"&:hover":{bgcolor:p.light}},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[Re(n.source),e.jsx(m,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontSize:"13px",color:M.dark,textTransform:"capitalize"},children:n.name})]}),e.jsx(me,{size:"small",onClick:()=>Ae(n),sx:{color:r.main,p:.5,"&:hover":{bgcolor:r.bg}},children:e.jsx(ye,{sx:{fontSize:16}})}),e.jsx(me,{size:"small",onClick:()=>De(n),sx:{color:f.main,p:.5,"&:hover":{bgcolor:f.bg}},children:e.jsx(Xe,{sx:{fontSize:16}})})]},n.id))})]})})},t)})})]}),e.jsxs(be,{open:ke,onClose:()=>E(!1),maxWidth:"xs",fullWidth:!0,children:[e.jsx(je,{children:"Delete Item?"}),e.jsx(ve,{children:e.jsxs(m,{children:["Are you sure you want to delete"," ",e.jsx("strong",{children:A?.name}),"? You can undo this action."]})}),e.jsxs(Ie,{children:[e.jsx(x,{onClick:()=>E(!1),children:"Cancel"}),e.jsx(x,{onClick:Ee,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsxs(be,{open:Ce,onClose:oe,maxWidth:"sm",fullWidth:!0,children:[e.jsx(je,{children:"Edit Item Name"}),e.jsx(ve,{children:e.jsx(s,{sx:{pt:1},children:e.jsx(ue,{autoFocus:!0,fullWidth:!0,label:"Item Name",value:v,onChange:t=>D(t.target.value),onKeyPress:t=>{t.key==="Enter"&&!I&&ne()},helperText:"Update the item name - will automatically recategorize with AI",disabled:I})})}),e.jsxs(Ie,{children:[e.jsx(x,{onClick:oe,disabled:I,children:"Cancel"}),e.jsx(x,{onClick:ne,variant:"contained",disabled:!v.trim()||I,children:I?"Saving...":"Save"})]})]}),e.jsx(Ne,{open:k.open,autoHideDuration:4e3,onClose:()=>i({...k,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Ge,{severity:k.severity,sx:{fontFamily:"Outfit, sans-serif"},children:k.message})})]})}export{Ct as default};
