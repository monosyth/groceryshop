import{g as cr,a as fr,r as te,u as dr,j as m,c as ur,b as hr,s as pr,d as Ne,e as Mt,f as Tt,h as gr,i as mr,k as Oe,l as je,m as nt,n as Ve,o as Ot,p as _t,q as Pt,t as xr,v as Ct,B as V,w as G,T as Y,A as Lt,x as we,y as _e,z as yr,I as Xe,C as Ge,D as $e,P as Me,E as We,F as pe,S as Wt,G as Ht,H as br,J as St,K as ot,L as jt,M as It,N as at,O as vr,Q as wr,R as Ar,U as Re,V as Cr,W as pt,X as Ze,Y as Sr}from"./index-By-6PO1w.js";import{A as jr,a as Ir,M as Ft,C as Fr,S as $t,f as Nt,b as qe}from"./formatters-C9_yVxJ8.js";import{a as Er}from"./pantryService-Bl5Oo3Za.js";import{C as Bt,a as Qt}from"./CardContent-CwRIKd-V.js";import{C as Gt}from"./Chip-DTceX4T0.js";import{R as Rr}from"./Refresh-DZxS1M1-.js";import{S as Le,L as Ur,a as Et}from"./ShoppingBag-C2dmKADw.js";import{C as kr}from"./CheckCircle-BetDzRDw.js";import{c as Dr}from"./geminiService-CitDXh9M.js";import{D as Je,a as et,b as tt,c as xt}from"./DialogTitle-Bbffd3dE.js";import{D as Rt}from"./Delete-Cw3wusZf.js";import{C as zr}from"./Close-BlBmCSKR.js";import{S as Ut,a as Mr}from"./SearchBar-Dyu40_gM.js";import{D as yt}from"./Divider-BSd6Pqhz.js";import{E as qt}from"./Edit-B8JdMMSW.js";import{T as Vt}from"./TextField-CHzrXbs_.js";import{C as Tr,F as Or,L as _r,I as Pr,A as Lr,B as Wr,E as Hr,S as $r,G as Nr}from"./SetMeal-CvO5cnUN.js";import{R as gt}from"./Receipt-D1omZUZU.js";import{C as Br,U as Qr}from"./Upload-BmflQxF4.js";import{G as Ye}from"./Grid-BKQ8lC-W.js";import{f as Gr}from"./format-BNZNg-GV.js";import"./InputAdornment-hBnm1FBs.js";import"./useFormControl-CIlIf9Fu.js";function qr(S){return cr("MuiCardMedia",S)}fr("MuiCardMedia",["root","media","img"]);const Vr=S=>{const{classes:C,isMediaComponent:U,isImageComponent:f}=S;return hr({root:["root",U&&"media",f&&"img"]},qr,C)},Kr=pr("div",{name:"MuiCardMedia",slot:"Root",overridesResolver:(S,C)=>{const{ownerState:U}=S,{isMediaComponent:f,isImageComponent:e}=U;return[C.root,f&&C.media,e&&C.img]}})({display:"block",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",variants:[{props:{isMediaComponent:!0},style:{width:"100%"}},{props:{isImageComponent:!0},style:{objectFit:"cover"}}]}),Zr=["video","audio","picture","iframe","img"],Yr=["picture","img"],Xr=te.forwardRef(function(C,U){const f=dr({props:C,name:"MuiCardMedia"}),{children:e,className:t,component:d="div",image:i,src:p,style:y,...n}=f,o=Zr.includes(d),r=!o&&i?{backgroundImage:`url("${i}")`,...y}:y,s={...f,component:d,isMediaComponent:o,isImageComponent:Yr.includes(d)},h=Vr(s);return m.jsx(Kr,{className:ur(h.root,t),as:d,role:!o&&i?"img":void 0,ref:U,style:r,ownerState:s,src:o?i||p:void 0,...n,children:e})}),Kt=Ne(m.jsx("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 18H4V8h16z"})),Jr=Ne([m.jsx("path",{d:"m12 2-5.5 9h11z"},"0"),m.jsx("circle",{cx:"17.5",cy:"17.5",r:"4.5"},"1"),m.jsx("path",{d:"M3 13.5h8v8H3z"},"2")]),kt=Ne(m.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"})),Dt=Ne(m.jsx("path",{d:"M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2zm10 14.5V20H8v-3.5l4-4zm-4-5-4-4V4h8v3.5z"})),en=Ne(m.jsx("path",{d:"M21 5h-2.64l1.14-3.14L17.15 1l-1.46 4H3v2l2 6-2 6v2h18v-2l-2-6 2-6zm-5 9h-3v3h-2v-3H8v-2h3V9h2v3h3z"})),tn=Ne([m.jsx("path",{d:"M8.55 12c-1.07-.71-2.25-1.27-3.53-1.61 1.28.34 2.46.9 3.53 1.61m10.43-1.61c-1.29.34-2.49.91-3.57 1.64 1.08-.73 2.28-1.3 3.57-1.64"},"0"),m.jsx("path",{d:"M15.49 9.63c-.18-2.79-1.31-5.51-3.43-7.63-2.14 2.14-3.32 4.86-3.55 7.63 1.28.68 2.46 1.56 3.49 2.63 1.03-1.06 2.21-1.94 3.49-2.63m-6.5 2.65c-.14-.1-.3-.19-.45-.29.15.11.31.19.45.29m6.42-.25c-.13.09-.27.16-.4.26.13-.1.27-.17.4-.26M12 15.45C9.85 12.17 6.18 10 2 10c0 5.32 3.36 9.82 8.03 11.49.63.23 1.29.4 1.97.51.68-.12 1.33-.29 1.97-.51C18.64 19.82 22 15.32 22 10c-4.18 0-7.85 2.17-10 5.45"},"1")]),rn=(S,C,U)=>({userId:S,imageUrl:C,imagePath:U,storeInfo:{name:"",location:null,date:null},items:[],summary:{subtotal:0,tax:0,total:0},metadata:{analysisStatus:jr.PENDING,processedAt:null,processingError:null,geminiFeedback:null},tags:[],notes:"",createdAt:new Date,updatedAt:new Date}),nn=S=>{const C=[];return S.userId||C.push("User ID is required"),S.imageUrl||C.push("Image URL is required"),S.imagePath||C.push("Image path is required"),S.summary&&(typeof S.summary.total!="number"&&C.push("Total must be a number"),S.summary.total<0&&C.push("Total cannot be negative")),S.items&&Array.isArray(S.items)&&S.items.forEach((U,f)=>{U.name||C.push(`Item ${f+1}: name is required`),typeof U.totalPrice!="number"&&C.push(`Item ${f+1}: totalPrice must be a number`)}),{valid:C.length===0,errors:C}};function on(S,C){return C.forEach((function(U){U&&typeof U!="string"&&!Array.isArray(U)&&Object.keys(U).forEach((function(f){if(f!=="default"&&!(f in S)){var e=Object.getOwnPropertyDescriptor(U,f);Object.defineProperty(S,f,e.get?e:{enumerable:!0,get:function(){return U[f]}})}}))})),Object.freeze(S)}function Zt(S,C){return new Promise((function(U,f){let e;return an(S).then((function(t){try{return e=t,U(new Blob([C.slice(0,2),e,C.slice(2)],{type:"image/jpeg"}))}catch(d){return f(d)}}),f)}))}const an=S=>new Promise(((C,U)=>{const f=new FileReader;f.addEventListener("load",(({target:{result:e}})=>{const t=new DataView(e);let d=0;if(t.getUint16(d)!==65496)return U("not a valid JPEG");for(d+=2;;){const i=t.getUint16(d);if(i===65498)break;const p=t.getUint16(d+2);if(i===65505&&t.getUint32(d+4)===1165519206){const y=d+10;let n;switch(t.getUint16(y)){case 18761:n=!0;break;case 19789:n=!1;break;default:return U("TIFF header contains invalid endian")}if(t.getUint16(y+2,n)!==42)return U("TIFF header contains invalid version");const o=t.getUint32(y+4,n),r=y+o+2+12*t.getUint16(y+o,n);for(let s=y+o+2;s<r;s+=12)if(t.getUint16(s,n)==274){if(t.getUint16(s+2,n)!==3)return U("Orientation data type is invalid");if(t.getUint32(s+4,n)!==1)return U("Orientation data count is invalid");t.setUint16(s+8,1,n);break}return C(e.slice(d,d+2+p))}d+=2+p}return C(new Blob)})),f.readAsArrayBuffer(S)}));var it={},sn={get exports(){return it},set exports(S){it=S}};(function(S){var C,U,f={};sn.exports=f,f.parse=function(e,t){for(var d=f.bin.readUshort,i=f.bin.readUint,p=0,y={},n=new Uint8Array(e),o=n.length-4;i(n,o)!=101010256;)o--;p=o,p+=4;var r=d(n,p+=4);d(n,p+=2);var s=i(n,p+=2),h=i(n,p+=4);p+=4,p=h;for(var j=0;j<r;j++){i(n,p),p+=4,p+=4,p+=4,i(n,p+=4),s=i(n,p+=4);var k=i(n,p+=4),b=d(n,p+=4),P=d(n,p+2),D=d(n,p+4);p+=6;var R=i(n,p+=8);p+=4,p+=b+P+D,f._readLocal(n,R,y,s,k,t)}return y},f._readLocal=function(e,t,d,i,p,y){var n=f.bin.readUshort,o=f.bin.readUint;o(e,t),n(e,t+=4),n(e,t+=2);var r=n(e,t+=2);o(e,t+=2),o(e,t+=4),t+=4;var s=n(e,t+=8),h=n(e,t+=2);t+=2;var j=f.bin.readUTF8(e,t,s);if(t+=s,t+=h,y)d[j]={size:p,csize:i};else{var k=new Uint8Array(e.buffer,t);if(r==0)d[j]=new Uint8Array(k.buffer.slice(t,t+i));else{if(r!=8)throw"unknown compression method: "+r;var b=new Uint8Array(p);f.inflateRaw(k,b),d[j]=b}}},f.inflateRaw=function(e,t){return f.F.inflate(e,t)},f.inflate=function(e,t){return e[0],e[1],f.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},f.deflate=function(e,t){t==null&&(t={level:6});var d=0,i=new Uint8Array(50+Math.floor(1.1*e.length));i[d]=120,i[d+1]=156,d+=2,d=f.F.deflateRaw(e,i,d,t.level);var p=f.adler(e,0,e.length);return i[d+0]=p>>>24&255,i[d+1]=p>>>16&255,i[d+2]=p>>>8&255,i[d+3]=p>>>0&255,new Uint8Array(i.buffer,0,d+4)},f.deflateRaw=function(e,t){t==null&&(t={level:6});var d=new Uint8Array(50+Math.floor(1.1*e.length)),i=f.F.deflateRaw(e,d,i,t.level);return new Uint8Array(d.buffer,0,i)},f.encode=function(e,t){t==null&&(t=!1);var d=0,i=f.bin.writeUint,p=f.bin.writeUshort,y={};for(var n in e){var o=!f._noNeed(n)&&!t,r=e[n],s=f.crc.crc(r,0,r.length);y[n]={cpr:o,usize:r.length,crc:s,file:o?f.deflateRaw(r):r}}for(var n in y)d+=y[n].file.length+30+46+2*f.bin.sizeUTF8(n);d+=22;var h=new Uint8Array(d),j=0,k=[];for(var n in y){var b=y[n];k.push(j),j=f._writeHeader(h,j,n,b,0)}var P=0,D=j;for(var n in y)b=y[n],k.push(j),j=f._writeHeader(h,j,n,b,1,k[P++]);var R=j-D;return i(h,j,101010256),j+=4,p(h,j+=4,P),p(h,j+=2,P),i(h,j+=2,R),i(h,j+=4,D),j+=4,j+=2,h.buffer},f._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},f._writeHeader=function(e,t,d,i,p,y){var n=f.bin.writeUint,o=f.bin.writeUshort,r=i.file;return n(e,t,p==0?67324752:33639248),t+=4,p==1&&(t+=2),o(e,t,20),o(e,t+=2,0),o(e,t+=2,i.cpr?8:0),n(e,t+=2,0),n(e,t+=4,i.crc),n(e,t+=4,r.length),n(e,t+=4,i.usize),o(e,t+=4,f.bin.sizeUTF8(d)),o(e,t+=2,0),t+=2,p==1&&(t+=2,t+=2,n(e,t+=6,y),t+=4),t+=f.bin.writeUTF8(e,t,d),p==0&&(e.set(r,t),t+=r.length),t},f.crc={table:(function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var d=t,i=0;i<8;i++)1&d?d=3988292384^d>>>1:d>>>=1;e[t]=d}return e})(),update:function(e,t,d,i){for(var p=0;p<i;p++)e=f.crc.table[255&(e^t[d+p])]^e>>>8;return e},crc:function(e,t,d){return 4294967295^f.crc.update(4294967295,e,t,d)}},f.adler=function(e,t,d){for(var i=1,p=0,y=t,n=t+d;y<n;){for(var o=Math.min(y+5552,n);y<o;)p+=i+=e[y++];i%=65521,p%=65521}return p<<16|i},f.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255,e[t+2]=d>>16&255,e[t+3]=d>>24&255},readASCII:function(e,t,d){for(var i="",p=0;p<d;p++)i+=String.fromCharCode(e[t+p]);return i},writeASCII:function(e,t,d){for(var i=0;i<d.length;i++)e[t+i]=d.charCodeAt(i)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,d){for(var i,p="",y=0;y<d;y++)p+="%"+f.bin.pad(e[t+y].toString(16));try{i=decodeURIComponent(p)}catch{return f.bin.readASCII(e,t,d)}return i},writeUTF8:function(e,t,d){for(var i=d.length,p=0,y=0;y<i;y++){var n=d.charCodeAt(y);if((4294967168&n)==0)e[t+p]=n,p++;else if((4294965248&n)==0)e[t+p]=192|n>>6,e[t+p+1]=128|n>>0&63,p+=2;else if((4294901760&n)==0)e[t+p]=224|n>>12,e[t+p+1]=128|n>>6&63,e[t+p+2]=128|n>>0&63,p+=3;else{if((4292870144&n)!=0)throw"e";e[t+p]=240|n>>18,e[t+p+1]=128|n>>12&63,e[t+p+2]=128|n>>6&63,e[t+p+3]=128|n>>0&63,p+=4}}return p},sizeUTF8:function(e){for(var t=e.length,d=0,i=0;i<t;i++){var p=e.charCodeAt(i);if((4294967168&p)==0)d++;else if((4294965248&p)==0)d+=2;else if((4294901760&p)==0)d+=3;else{if((4292870144&p)!=0)throw"e";d+=4}}return d}},f.F={},f.F.deflateRaw=function(e,t,d,i){var p=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][i],y=f.F.U,n=f.F._goodIndex;f.F._hash;var o=f.F._putsE,r=0,s=d<<3,h=0,j=e.length;if(i==0){for(;r<j;)o(t,s,r+(A=Math.min(65535,j-r))==j?1:0),s=f.F._copyExact(e,r,A,t,s+8),r+=A;return s>>>3}var k=y.lits,b=y.strt,P=y.prev,D=0,R=0,_=0,g=0,z=0,c=0;for(j>2&&(b[c=f.F._hash(e,0)]=0),r=0;r<j;r++){if(z=c,r+1<j-2){c=f.F._hash(e,r+1);var u=r+1&32767;P[u]=b[c],b[c]=u}if(h<=r){(D>14e3||R>26697)&&j-r>100&&(h<r&&(k[D]=r-h,D+=2,h=r),s=f.F._writeBlock(r==j-1||h==j?1:0,k,D,g,e,_,r-_,t,s),D=R=g=0,_=r);var v=0;r<j-2&&(v=f.F._bestMatch(e,r,P,z,Math.min(p[2],j-r),p[3]));var A=v>>>16,w=65535&v;if(v!=0){w=65535&v;var I=n(A=v>>>16,y.of0);y.lhst[257+I]++;var x=n(w,y.df0);y.dhst[x]++,g+=y.exb[I]+y.dxb[x],k[D]=A<<23|r-h,k[D+1]=w<<16|I<<8|x,D+=2,h=r+A}else y.lhst[e[r]]++;R++}}for(_==r&&e.length!=0||(h<r&&(k[D]=r-h,D+=2,h=r),s=f.F._writeBlock(1,k,D,g,e,_,r-_,t,s),D=0,R=0,D=R=g=0,_=r);(7&s)!=0;)s++;return s>>>3},f.F._bestMatch=function(e,t,d,i,p,y){var n=32767&t,o=d[n],r=n-o+32768&32767;if(o==n||i!=f.F._hash(e,t-r))return 0;for(var s=0,h=0,j=Math.min(32767,t);r<=j&&--y!=0&&o!=n;){if(s==0||e[t+s]==e[t+s-r]){var k=f.F._howLong(e,t,r);if(k>s){if(h=r,(s=k)>=p)break;r+2<k&&(k=r+2);for(var b=0,P=0;P<k-2;P++){var D=t-r+P+32768&32767,R=D-d[D]+32768&32767;R>b&&(b=R,o=D)}}}r+=(n=o)-(o=d[n])+32768&32767}return s<<16|h},f.F._howLong=function(e,t,d){if(e[t]!=e[t-d]||e[t+1]!=e[t+1-d]||e[t+2]!=e[t+2-d])return 0;var i=t,p=Math.min(e.length,t+258);for(t+=3;t<p&&e[t]==e[t-d];)t++;return t-i},f.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},f.saved=0,f.F._writeBlock=function(e,t,d,i,p,y,n,o,r){var s,h,j,k,b,P,D,R,_,g=f.F.U,z=f.F._putsF,c=f.F._putsE;g.lhst[256]++,h=(s=f.F.getTrees())[0],j=s[1],k=s[2],b=s[3],P=s[4],D=s[5],R=s[6],_=s[7];var u=32+((r+3&7)==0?0:8-(r+3&7))+(n<<3),v=i+f.F.contSize(g.fltree,g.lhst)+f.F.contSize(g.fdtree,g.dhst),A=i+f.F.contSize(g.ltree,g.lhst)+f.F.contSize(g.dtree,g.dhst);A+=14+3*D+f.F.contSize(g.itree,g.ihst)+(2*g.ihst[16]+3*g.ihst[17]+7*g.ihst[18]);for(var w=0;w<286;w++)g.lhst[w]=0;for(w=0;w<30;w++)g.dhst[w]=0;for(w=0;w<19;w++)g.ihst[w]=0;var I=u<v&&u<A?0:v<A?1:2;if(z(o,r,e),z(o,r+1,I),r+=3,I==0){for(;(7&r)!=0;)r++;r=f.F._copyExact(p,y,n,o,r)}else{var x,E;if(I==1&&(x=g.fltree,E=g.fdtree),I==2){f.F.makeCodes(g.ltree,h),f.F.revCodes(g.ltree,h),f.F.makeCodes(g.dtree,j),f.F.revCodes(g.dtree,j),f.F.makeCodes(g.itree,k),f.F.revCodes(g.itree,k),x=g.ltree,E=g.dtree,c(o,r,b-257),c(o,r+=5,P-1),c(o,r+=5,D-4),r+=4;for(var l=0;l<D;l++)c(o,r+3*l,g.itree[1+(g.ordr[l]<<1)]);r+=3*D,r=f.F._codeTiny(R,g.itree,o,r),r=f.F._codeTiny(_,g.itree,o,r)}for(var a=y,T=0;T<d;T+=2){for(var F=t[T],O=F>>>23,N=a+(8388607&F);a<N;)r=f.F._writeLit(p[a++],x,o,r);if(O!=0){var $=t[T+1],B=$>>16,H=$>>8&255,M=255&$;c(o,r=f.F._writeLit(257+H,x,o,r),O-g.of0[H]),r+=g.exb[H],z(o,r=f.F._writeLit(M,E,o,r),B-g.df0[M]),r+=g.dxb[M],a+=O}}r=f.F._writeLit(256,x,o,r)}return r},f.F._copyExact=function(e,t,d,i,p){var y=p>>>3;return i[y]=d,i[y+1]=d>>>8,i[y+2]=255-i[y],i[y+3]=255-i[y+1],y+=4,i.set(new Uint8Array(e.buffer,t,d),y),p+(d+4<<3)},f.F.getTrees=function(){for(var e=f.F.U,t=f.F._hufTree(e.lhst,e.ltree,15),d=f.F._hufTree(e.dhst,e.dtree,15),i=[],p=f.F._lenCodes(e.ltree,i),y=[],n=f.F._lenCodes(e.dtree,y),o=0;o<i.length;o+=2)e.ihst[i[o]]++;for(o=0;o<y.length;o+=2)e.ihst[y[o]]++;for(var r=f.F._hufTree(e.ihst,e.itree,7),s=19;s>4&&e.itree[1+(e.ordr[s-1]<<1)]==0;)s--;return[t,d,r,p,n,s,i,y]},f.F.getSecond=function(e){for(var t=[],d=0;d<e.length;d+=2)t.push(e[d+1]);return t},f.F.nonZero=function(e){for(var t="",d=0;d<e.length;d+=2)e[d+1]!=0&&(t+=(d>>1)+",");return t},f.F.contSize=function(e,t){for(var d=0,i=0;i<t.length;i++)d+=t[i]*e[1+(i<<1)];return d},f.F._codeTiny=function(e,t,d,i){for(var p=0;p<e.length;p+=2){var y=e[p],n=e[p+1];i=f.F._writeLit(y,t,d,i);var o=y==16?2:y==17?3:7;y>15&&(f.F._putsE(d,i,n,o),i+=o)}return i},f.F._lenCodes=function(e,t){for(var d=e.length;d!=2&&e[d-1]==0;)d-=2;for(var i=0;i<d;i+=2){var p=e[i+1],y=i+3<d?e[i+3]:-1,n=i+5<d?e[i+5]:-1,o=i==0?-1:e[i-1];if(p==0&&y==p&&n==p){for(var r=i+5;r+2<d&&e[r+2]==p;)r+=2;(s=Math.min(r+1-i>>>1,138))<11?t.push(17,s-3):t.push(18,s-11),i+=2*s-2}else if(p==o&&y==p&&n==p){for(r=i+5;r+2<d&&e[r+2]==p;)r+=2;var s=Math.min(r+1-i>>>1,6);t.push(16,s-3),i+=2*s-2}else t.push(p,0)}return d>>>1},f.F._hufTree=function(e,t,d){var i=[],p=e.length,y=t.length,n=0;for(n=0;n<y;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<p;n++)e[n]!=0&&i.push({lit:n,f:e[n]});var o=i.length,r=i.slice(0);if(o==0)return 0;if(o==1){var s=i[0].lit;return r=s==0?1:0,t[1+(s<<1)]=1,t[1+(r<<1)]=1,1}i.sort((function(R,_){return R.f-_.f}));var h=i[0],j=i[1],k=0,b=1,P=2;for(i[0]={lit:-1,f:h.f+j.f,l:h,r:j,d:0};b!=o-1;)h=k!=b&&(P==o||i[k].f<i[P].f)?i[k++]:i[P++],j=k!=b&&(P==o||i[k].f<i[P].f)?i[k++]:i[P++],i[b++]={lit:-1,f:h.f+j.f,l:h,r:j};var D=f.F.setDepth(i[b-1],0);for(D>d&&(f.F.restrictDepth(r,d,D),D=d),n=0;n<o;n++)t[1+(r[n].lit<<1)]=r[n].d;return D},f.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(f.F.setDepth(e.l,t+1),f.F.setDepth(e.r,t+1))},f.F.restrictDepth=function(e,t,d){var i=0,p=1<<d-t,y=0;for(e.sort((function(o,r){return r.d==o.d?o.f-r.f:r.d-o.d})),i=0;i<e.length&&e[i].d>t;i++){var n=e[i].d;e[i].d=t,y+=p-(1<<d-n)}for(y>>>=d-t;y>0;)(n=e[i].d)<t?(e[i].d++,y-=1<<t-n-1):i++;for(;i>=0;i--)e[i].d==t&&y<0&&(e[i].d--,y++);y!=0&&console.log("debt left")},f.F._goodIndex=function(e,t){var d=0;return t[16|d]<=e&&(d|=16),t[8|d]<=e&&(d|=8),t[4|d]<=e&&(d|=4),t[2|d]<=e&&(d|=2),t[1|d]<=e&&(d|=1),d},f.F._writeLit=function(e,t,d,i){return f.F._putsF(d,i,t[e<<1]),i+t[1+(e<<1)]},f.F.inflate=function(e,t){var d=Uint8Array;if(e[0]==3&&e[1]==0)return t||new d(0);var i=f.F,p=i._bitsF,y=i._bitsE,n=i._decodeTiny,o=i.makeCodes,r=i.codes2map,s=i._get17,h=i.U,j=t==null;j&&(t=new d(e.length>>>2<<3));for(var k,b,P=0,D=0,R=0,_=0,g=0,z=0,c=0,u=0,v=0;P==0;)if(P=p(e,v,1),D=p(e,v+1,2),v+=3,D!=0){if(j&&(t=f.F._check(t,u+(1<<17))),D==1&&(k=h.flmap,b=h.fdmap,z=511,c=31),D==2){R=y(e,v,5)+257,_=y(e,v+5,5)+1,g=y(e,v+10,4)+4,v+=14;for(var A=0;A<38;A+=2)h.itree[A]=0,h.itree[A+1]=0;var w=1;for(A=0;A<g;A++){var I=y(e,v+3*A,3);h.itree[1+(h.ordr[A]<<1)]=I,I>w&&(w=I)}v+=3*g,o(h.itree,w),r(h.itree,w,h.imap),k=h.lmap,b=h.dmap,v=n(h.imap,(1<<w)-1,R+_,e,v,h.ttree);var x=i._copyOut(h.ttree,0,R,h.ltree);z=(1<<x)-1;var E=i._copyOut(h.ttree,R,_,h.dtree);c=(1<<E)-1,o(h.ltree,x),r(h.ltree,x,k),o(h.dtree,E),r(h.dtree,E,b)}for(;;){var l=k[s(e,v)&z];v+=15&l;var a=l>>>4;if(!(a>>>8))t[u++]=a;else{if(a==256)break;var T=u+a-254;if(a>264){var F=h.ldef[a-257];T=u+(F>>>3)+y(e,v,7&F),v+=7&F}var O=b[s(e,v)&c];v+=15&O;var N=O>>>4,$=h.ddef[N],B=($>>>4)+p(e,v,15&$);for(v+=15&$,j&&(t=f.F._check(t,u+(1<<17)));u<T;)t[u]=t[u++-B],t[u]=t[u++-B],t[u]=t[u++-B],t[u]=t[u++-B];u=T}}}else{(7&v)!=0&&(v+=8-(7&v));var H=4+(v>>>3),M=e[H-4]|e[H-3]<<8;j&&(t=f.F._check(t,u+M)),t.set(new d(e.buffer,e.byteOffset+H,M),u),v=H+M<<3,u+=M}return t.length==u?t:t.slice(0,u)},f.F._check=function(e,t){var d=e.length;if(t<=d)return e;var i=new Uint8Array(Math.max(d<<1,t));return i.set(e,0),i},f.F._decodeTiny=function(e,t,d,i,p,y){for(var n=f.F._bitsE,o=f.F._get17,r=0;r<d;){var s=e[o(i,p)&t];p+=15&s;var h=s>>>4;if(h<=15)y[r]=h,r++;else{var j=0,k=0;h==16?(k=3+n(i,p,2),p+=2,j=y[r-1]):h==17?(k=3+n(i,p,3),p+=3):h==18&&(k=11+n(i,p,7),p+=7);for(var b=r+k;r<b;)y[r]=j,r++}}return p},f.F._copyOut=function(e,t,d,i){for(var p=0,y=0,n=i.length>>>1;y<d;){var o=e[y+t];i[y<<1]=0,i[1+(y<<1)]=o,o>p&&(p=o),y++}for(;y<n;)i[y<<1]=0,i[1+(y<<1)]=0,y++;return p},f.F.makeCodes=function(e,t){for(var d,i,p,y,n=f.F.U,o=e.length,r=n.bl_count,s=0;s<=t;s++)r[s]=0;for(s=1;s<o;s+=2)r[e[s]]++;var h=n.next_code;for(d=0,r[0]=0,i=1;i<=t;i++)d=d+r[i-1]<<1,h[i]=d;for(p=0;p<o;p+=2)(y=e[p+1])!=0&&(e[p]=h[y],h[y]++)},f.F.codes2map=function(e,t,d){for(var i=e.length,p=f.F.U.rev15,y=0;y<i;y+=2)if(e[y+1]!=0)for(var n=y>>1,o=e[y+1],r=n<<4|o,s=t-o,h=e[y]<<s,j=h+(1<<s);h!=j;)d[p[h]>>>15-t]=r,h++},f.F.revCodes=function(e,t){for(var d=f.F.U.rev15,i=15-t,p=0;p<e.length;p+=2){var y=e[p]<<t-e[p+1];e[p]=d[y]>>>i}},f.F._putsE=function(e,t,d){d<<=7&t;var i=t>>>3;e[i]|=d,e[i+1]|=d>>>8},f.F._putsF=function(e,t,d){d<<=7&t;var i=t>>>3;e[i]|=d,e[i+1]|=d>>>8,e[i+2]|=d>>>16},f.F._bitsE=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<d)-1},f.F._bitsF=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<d)-1},f.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},f.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},f.F.U=(C=Uint16Array,U=Uint32Array,{next_code:new C(16),bl_count:new C(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new C(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new U(32),flmap:new C(512),fltree:[],fdmap:new C(32),fdtree:[],lmap:new C(32768),ltree:[],ttree:[],dmap:new C(32768),dtree:[],imap:new C(512),itree:[],rev15:new C(32768),lhst:new U(286),dhst:new U(30),ihst:new U(19),lits:new U(15e3),strt:new C(65536),prev:new C(32768)}),(function(){for(var e=f.F.U,t=0;t<32768;t++){var d=t;d=(4278255360&(d=(4042322160&(d=(3435973836&(d=(2863311530&d)>>>1|(1431655765&d)<<1))>>>2|(858993459&d)<<2))>>>4|(252645135&d)<<4))>>>8|(16711935&d)<<8,e.rev15[t]=(d>>>16|d<<16)>>>17}function i(p,y,n){for(;y--!=0;)p.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];i(e.fltree,144,8),i(e.fltree,112,9),i(e.fltree,24,7),i(e.fltree,8,8),f.F.makeCodes(e.fltree,9),f.F.codes2map(e.fltree,9,e.flmap),f.F.revCodes(e.fltree,9),i(e.fdtree,32,5),f.F.makeCodes(e.fdtree,5),f.F.codes2map(e.fdtree,5,e.fdmap),f.F.revCodes(e.fdtree,5),i(e.itree,19,0),i(e.ltree,286,0),i(e.dtree,30,0),i(e.ttree,320,0)})()})();var ln=on({__proto__:null,default:it},[it]);const ve=(function(){var S={nextZero(n,o){for(;n[o]!=0;)o++;return o},readUshort:(n,o)=>n[o]<<8|n[o+1],writeUshort(n,o,r){n[o]=r>>8&255,n[o+1]=255&r},readUint:(n,o)=>16777216*n[o]+(n[o+1]<<16|n[o+2]<<8|n[o+3]),writeUint(n,o,r){n[o]=r>>24&255,n[o+1]=r>>16&255,n[o+2]=r>>8&255,n[o+3]=255&r},readASCII(n,o,r){let s="";for(let h=0;h<r;h++)s+=String.fromCharCode(n[o+h]);return s},writeASCII(n,o,r){for(let s=0;s<r.length;s++)n[o+s]=r.charCodeAt(s)},readBytes(n,o,r){const s=[];for(let h=0;h<r;h++)s.push(n[o+h]);return s},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,o,r){let s,h="";for(let j=0;j<r;j++)h+=`%${S.pad(n[o+j].toString(16))}`;try{s=decodeURIComponent(h)}catch{return S.readASCII(n,o,r)}return s}};function C(n,o,r,s){const h=o*r,j=t(s),k=Math.ceil(o*j/8),b=new Uint8Array(4*h),P=new Uint32Array(b.buffer),{ctype:D}=s,{depth:R}=s,_=S.readUshort;if(D==6){const F=h<<2;if(R==8)for(var g=0;g<F;g+=4)b[g]=n[g],b[g+1]=n[g+1],b[g+2]=n[g+2],b[g+3]=n[g+3];if(R==16)for(g=0;g<F;g++)b[g]=n[g<<1]}else if(D==2){const F=s.tabs.tRNS;if(F==null){if(R==8)for(g=0;g<h;g++){var z=3*g;P[g]=255<<24|n[z+2]<<16|n[z+1]<<8|n[z]}if(R==16)for(g=0;g<h;g++)z=6*g,P[g]=255<<24|n[z+4]<<16|n[z+2]<<8|n[z]}else{var c=F[0];const O=F[1],N=F[2];if(R==8)for(g=0;g<h;g++){var u=g<<2;z=3*g,P[g]=255<<24|n[z+2]<<16|n[z+1]<<8|n[z],n[z]==c&&n[z+1]==O&&n[z+2]==N&&(b[u+3]=0)}if(R==16)for(g=0;g<h;g++)u=g<<2,z=6*g,P[g]=255<<24|n[z+4]<<16|n[z+2]<<8|n[z],_(n,z)==c&&_(n,z+2)==O&&_(n,z+4)==N&&(b[u+3]=0)}}else if(D==3){const F=s.tabs.PLTE,O=s.tabs.tRNS,N=O?O.length:0;if(R==1)for(var v=0;v<r;v++){var A=v*k,w=v*o;for(g=0;g<o;g++){u=w+g<<2;var I=3*(x=n[A+(g>>3)]>>7-((7&g)<<0)&1);b[u]=F[I],b[u+1]=F[I+1],b[u+2]=F[I+2],b[u+3]=x<N?O[x]:255}}if(R==2)for(v=0;v<r;v++)for(A=v*k,w=v*o,g=0;g<o;g++)u=w+g<<2,I=3*(x=n[A+(g>>2)]>>6-((3&g)<<1)&3),b[u]=F[I],b[u+1]=F[I+1],b[u+2]=F[I+2],b[u+3]=x<N?O[x]:255;if(R==4)for(v=0;v<r;v++)for(A=v*k,w=v*o,g=0;g<o;g++)u=w+g<<2,I=3*(x=n[A+(g>>1)]>>4-((1&g)<<2)&15),b[u]=F[I],b[u+1]=F[I+1],b[u+2]=F[I+2],b[u+3]=x<N?O[x]:255;if(R==8)for(g=0;g<h;g++){var x;u=g<<2,I=3*(x=n[g]),b[u]=F[I],b[u+1]=F[I+1],b[u+2]=F[I+2],b[u+3]=x<N?O[x]:255}}else if(D==4){if(R==8)for(g=0;g<h;g++){u=g<<2;var E=n[l=g<<1];b[u]=E,b[u+1]=E,b[u+2]=E,b[u+3]=n[l+1]}if(R==16)for(g=0;g<h;g++){var l;u=g<<2,E=n[l=g<<2],b[u]=E,b[u+1]=E,b[u+2]=E,b[u+3]=n[l+2]}}else if(D==0)for(c=s.tabs.tRNS?s.tabs.tRNS:-1,v=0;v<r;v++){const F=v*k,O=v*o;if(R==1)for(var a=0;a<o;a++){var T=(E=255*(n[F+(a>>>3)]>>>7-(7&a)&1))==255*c?0:255;P[O+a]=T<<24|E<<16|E<<8|E}else if(R==2)for(a=0;a<o;a++)T=(E=85*(n[F+(a>>>2)]>>>6-((3&a)<<1)&3))==85*c?0:255,P[O+a]=T<<24|E<<16|E<<8|E;else if(R==4)for(a=0;a<o;a++)T=(E=17*(n[F+(a>>>1)]>>>4-((1&a)<<2)&15))==17*c?0:255,P[O+a]=T<<24|E<<16|E<<8|E;else if(R==8)for(a=0;a<o;a++)T=(E=n[F+a])==c?0:255,P[O+a]=T<<24|E<<16|E<<8|E;else if(R==16)for(a=0;a<o;a++)E=n[F+(a<<1)],T=_(n,F+(a<<1))==c?0:255,P[O+a]=T<<24|E<<16|E<<8|E}return b}function U(n,o,r,s){const h=t(n),j=Math.ceil(r*h/8),k=new Uint8Array((j+1+n.interlace)*s);return o=n.tabs.CgBI?e(o,k):f(o,k),n.interlace==0?o=d(o,n,0,r,s):n.interlace==1&&(o=(function(P,D){const R=D.width,_=D.height,g=t(D),z=g>>3,c=Math.ceil(R*g/8),u=new Uint8Array(_*c);let v=0;const A=[0,0,4,0,2,0,1],w=[0,4,0,2,0,1,0],I=[8,8,8,4,4,2,2],x=[8,8,4,4,2,2,1];let E=0;for(;E<7;){const a=I[E],T=x[E];let F=0,O=0,N=A[E];for(;N<_;)N+=a,O++;let $=w[E];for(;$<R;)$+=T,F++;const B=Math.ceil(F*g/8);d(P,D,v,F,O);let H=0,M=A[E];for(;M<_;){let q=w[E],re=v+H*B<<3;for(;q<R;){var l;if(g==1&&(l=(l=P[re>>3])>>7-(7&re)&1,u[M*c+(q>>3)]|=l<<7-((7&q)<<0)),g==2&&(l=(l=P[re>>3])>>6-(7&re)&3,u[M*c+(q>>2)]|=l<<6-((3&q)<<1)),g==4&&(l=(l=P[re>>3])>>4-(7&re)&15,u[M*c+(q>>1)]|=l<<4-((1&q)<<2)),g>=8){const ne=M*c+q*z;for(let J=0;J<z;J++)u[ne+J]=P[(re>>3)+J]}re+=g,q+=T}H++,M+=a}F*O!=0&&(v+=O*(1+B)),E+=1}return u})(o,n)),o}function f(n,o){return e(new Uint8Array(n.buffer,2,n.length-6),o)}var e=(function(){const n={H:{}};return n.H.N=function(o,r){const s=Uint8Array;let h,j,k=0,b=0,P=0,D=0,R=0,_=0,g=0,z=0,c=0;if(o[0]==3&&o[1]==0)return r||new s(0);const u=n.H,v=u.b,A=u.e,w=u.R,I=u.n,x=u.A,E=u.Z,l=u.m,a=r==null;for(a&&(r=new s(o.length>>>2<<5));k==0;)if(k=v(o,c,1),b=v(o,c+1,2),c+=3,b!=0){if(a&&(r=n.H.W(r,z+(1<<17))),b==1&&(h=l.J,j=l.h,_=511,g=31),b==2){P=A(o,c,5)+257,D=A(o,c+5,5)+1,R=A(o,c+10,4)+4,c+=14;let F=1;for(var T=0;T<38;T+=2)l.Q[T]=0,l.Q[T+1]=0;for(T=0;T<R;T++){const $=A(o,c+3*T,3);l.Q[1+(l.X[T]<<1)]=$,$>F&&(F=$)}c+=3*R,I(l.Q,F),x(l.Q,F,l.u),h=l.w,j=l.d,c=w(l.u,(1<<F)-1,P+D,o,c,l.v);const O=u.V(l.v,0,P,l.C);_=(1<<O)-1;const N=u.V(l.v,P,D,l.D);g=(1<<N)-1,I(l.C,O),x(l.C,O,h),I(l.D,N),x(l.D,N,j)}for(;;){const F=h[E(o,c)&_];c+=15&F;const O=F>>>4;if(!(O>>>8))r[z++]=O;else{if(O==256)break;{let N=z+O-254;if(O>264){const q=l.q[O-257];N=z+(q>>>3)+A(o,c,7&q),c+=7&q}const $=j[E(o,c)&g];c+=15&$;const B=$>>>4,H=l.c[B],M=(H>>>4)+v(o,c,15&H);for(c+=15&H;z<N;)r[z]=r[z++-M],r[z]=r[z++-M],r[z]=r[z++-M],r[z]=r[z++-M];z=N}}}}else{(7&c)!=0&&(c+=8-(7&c));const F=4+(c>>>3),O=o[F-4]|o[F-3]<<8;a&&(r=n.H.W(r,z+O)),r.set(new s(o.buffer,o.byteOffset+F,O),z),c=F+O<<3,z+=O}return r.length==z?r:r.slice(0,z)},n.H.W=function(o,r){const s=o.length;if(r<=s)return o;const h=new Uint8Array(s<<1);return h.set(o,0),h},n.H.R=function(o,r,s,h,j,k){const b=n.H.e,P=n.H.Z;let D=0;for(;D<s;){const R=o[P(h,j)&r];j+=15&R;const _=R>>>4;if(_<=15)k[D]=_,D++;else{let g=0,z=0;_==16?(z=3+b(h,j,2),j+=2,g=k[D-1]):_==17?(z=3+b(h,j,3),j+=3):_==18&&(z=11+b(h,j,7),j+=7);const c=D+z;for(;D<c;)k[D]=g,D++}}return j},n.H.V=function(o,r,s,h){let j=0,k=0;const b=h.length>>>1;for(;k<s;){const P=o[k+r];h[k<<1]=0,h[1+(k<<1)]=P,P>j&&(j=P),k++}for(;k<b;)h[k<<1]=0,h[1+(k<<1)]=0,k++;return j},n.H.n=function(o,r){const s=n.H.m,h=o.length;let j,k,b,P;const D=s.j;for(var R=0;R<=r;R++)D[R]=0;for(R=1;R<h;R+=2)D[o[R]]++;const _=s.K;for(j=0,D[0]=0,k=1;k<=r;k++)j=j+D[k-1]<<1,_[k]=j;for(b=0;b<h;b+=2)P=o[b+1],P!=0&&(o[b]=_[P],_[P]++)},n.H.A=function(o,r,s){const h=o.length,j=n.H.m.r;for(let k=0;k<h;k+=2)if(o[k+1]!=0){const b=k>>1,P=o[k+1],D=b<<4|P,R=r-P;let _=o[k]<<R;const g=_+(1<<R);for(;_!=g;)s[j[_]>>>15-r]=D,_++}},n.H.l=function(o,r){const s=n.H.m.r,h=15-r;for(let j=0;j<o.length;j+=2){const k=o[j]<<r-o[j+1];o[j]=s[k]>>>h}},n.H.M=function(o,r,s){s<<=7&r;const h=r>>>3;o[h]|=s,o[h+1]|=s>>>8},n.H.I=function(o,r,s){s<<=7&r;const h=r>>>3;o[h]|=s,o[h+1]|=s>>>8,o[h+2]|=s>>>16},n.H.e=function(o,r,s){return(o[r>>>3]|o[1+(r>>>3)]<<8)>>>(7&r)&(1<<s)-1},n.H.b=function(o,r,s){return(o[r>>>3]|o[1+(r>>>3)]<<8|o[2+(r>>>3)]<<16)>>>(7&r)&(1<<s)-1},n.H.Z=function(o,r){return(o[r>>>3]|o[1+(r>>>3)]<<8|o[2+(r>>>3)]<<16)>>>(7&r)},n.H.i=function(o,r){return(o[r>>>3]|o[1+(r>>>3)]<<8|o[2+(r>>>3)]<<16|o[3+(r>>>3)]<<24)>>>(7&r)},n.H.m=(function(){const o=Uint16Array,r=Uint32Array;return{K:new o(16),j:new o(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new o(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new r(32),J:new o(512),_:[],h:new o(32),$:[],w:new o(32768),C:[],v:[],d:new o(32768),D:[],u:new o(512),Q:[],r:new o(32768),s:new r(286),Y:new r(30),a:new r(19),t:new r(15e3),k:new o(65536),g:new o(32768)}})(),(function(){const o=n.H.m;for(var r=0;r<32768;r++){let h=r;h=(2863311530&h)>>>1|(1431655765&h)<<1,h=(3435973836&h)>>>2|(858993459&h)<<2,h=(4042322160&h)>>>4|(252645135&h)<<4,h=(4278255360&h)>>>8|(16711935&h)<<8,o.r[r]=(h>>>16|h<<16)>>>17}function s(h,j,k){for(;j--!=0;)h.push(0,k)}for(r=0;r<32;r++)o.q[r]=o.S[r]<<3|o.T[r],o.c[r]=o.p[r]<<4|o.z[r];s(o._,144,8),s(o._,112,9),s(o._,24,7),s(o._,8,8),n.H.n(o._,9),n.H.A(o._,9,o.J),n.H.l(o._,9),s(o.$,32,5),n.H.n(o.$,5),n.H.A(o.$,5,o.h),n.H.l(o.$,5),s(o.Q,19,0),s(o.C,286,0),s(o.D,30,0),s(o.v,320,0)})(),n.H.N})();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function d(n,o,r,s,h){let j=t(o);const k=Math.ceil(s*j/8);let b,P;j=Math.ceil(j/8);let D=n[r],R=0;if(D>1&&(n[r]=[0,0,1][D-2]),D==3)for(R=j;R<k;R++)n[R+1]=n[R+1]+(n[R+1-j]>>>1)&255;for(let _=0;_<h;_++)if(b=r+_*k,P=b+_+1,D=n[P-1],R=0,D==0)for(;R<k;R++)n[b+R]=n[P+R];else if(D==1){for(;R<j;R++)n[b+R]=n[P+R];for(;R<k;R++)n[b+R]=n[P+R]+n[b+R-j]}else if(D==2)for(;R<k;R++)n[b+R]=n[P+R]+n[b+R-k];else if(D==3){for(;R<j;R++)n[b+R]=n[P+R]+(n[b+R-k]>>>1);for(;R<k;R++)n[b+R]=n[P+R]+(n[b+R-k]+n[b+R-j]>>>1)}else{for(;R<j;R++)n[b+R]=n[P+R]+i(0,n[b+R-k],0);for(;R<k;R++)n[b+R]=n[P+R]+i(n[b+R-j],n[b+R-k],n[b+R-j-k])}return n}function i(n,o,r){const s=n+o-r,h=s-n,j=s-o,k=s-r;return h*h<=j*j&&h*h<=k*k?n:j*j<=k*k?o:r}function p(n,o,r){r.width=S.readUint(n,o),o+=4,r.height=S.readUint(n,o),o+=4,r.depth=n[o],o++,r.ctype=n[o],o++,r.compress=n[o],o++,r.filter=n[o],o++,r.interlace=n[o],o++}function y(n,o,r,s,h,j,k,b,P){const D=Math.min(o,h),R=Math.min(r,j);let _=0,g=0;for(let E=0;E<R;E++)for(let l=0;l<D;l++)if(k>=0&&b>=0?(_=E*o+l<<2,g=(b+E)*h+k+l<<2):(_=(-b+E)*o-k+l<<2,g=E*h+l<<2),P==0)s[g]=n[_],s[g+1]=n[_+1],s[g+2]=n[_+2],s[g+3]=n[_+3];else if(P==1){var z=n[_+3]*.00392156862745098,c=n[_]*z,u=n[_+1]*z,v=n[_+2]*z,A=s[g+3]*(1/255),w=s[g]*A,I=s[g+1]*A,x=s[g+2]*A;const a=1-z,T=z+A*a,F=T==0?0:1/T;s[g+3]=255*T,s[g+0]=(c+w*a)*F,s[g+1]=(u+I*a)*F,s[g+2]=(v+x*a)*F}else if(P==2)z=n[_+3],c=n[_],u=n[_+1],v=n[_+2],A=s[g+3],w=s[g],I=s[g+1],x=s[g+2],z==A&&c==w&&u==I&&v==x?(s[g]=0,s[g+1]=0,s[g+2]=0,s[g+3]=0):(s[g]=c,s[g+1]=u,s[g+2]=v,s[g+3]=z);else if(P==3){if(z=n[_+3],c=n[_],u=n[_+1],v=n[_+2],A=s[g+3],w=s[g],I=s[g+1],x=s[g+2],z==A&&c==w&&u==I&&v==x)continue;if(z<220&&A>20)return!1}return!0}return{decode:function(o){const r=new Uint8Array(o);let s=8;const h=S,j=h.readUshort,k=h.readUint,b={tabs:{},frames:[]},P=new Uint8Array(r.length);let D,R=0,_=0;const g=[137,80,78,71,13,10,26,10];for(var z=0;z<8;z++)if(r[z]!=g[z])throw"The input is not a PNG file!";for(;s<r.length;){const E=h.readUint(r,s);s+=4;const l=h.readASCII(r,s,4);if(s+=4,l=="IHDR")p(r,s,b);else if(l=="iCCP"){for(var c=s;r[c]!=0;)c++;h.readASCII(r,s,c-s),r[c+1];const a=r.slice(c+2,s+E);let T=null;try{T=f(a)}catch{T=e(a)}b.tabs[l]=T}else if(l=="CgBI")b.tabs[l]=r.slice(s,s+4);else if(l=="IDAT"){for(z=0;z<E;z++)P[R+z]=r[s+z];R+=E}else if(l=="acTL")b.tabs[l]={num_frames:k(r,s),num_plays:k(r,s+4)},D=new Uint8Array(r.length);else if(l=="fcTL"){_!=0&&((x=b.frames[b.frames.length-1]).data=U(b,D.slice(0,_),x.rect.width,x.rect.height),_=0);const a={x:k(r,s+12),y:k(r,s+16),width:k(r,s+4),height:k(r,s+8)};let T=j(r,s+22);T=j(r,s+20)/(T==0?100:T);const F={rect:a,delay:Math.round(1e3*T),dispose:r[s+24],blend:r[s+25]};b.frames.push(F)}else if(l=="fdAT"){for(z=0;z<E-4;z++)D[_+z]=r[s+z+4];_+=E-4}else if(l=="pHYs")b.tabs[l]=[h.readUint(r,s),h.readUint(r,s+4),r[s+8]];else if(l=="cHRM")for(b.tabs[l]=[],z=0;z<8;z++)b.tabs[l].push(h.readUint(r,s+4*z));else if(l=="tEXt"||l=="zTXt"){b.tabs[l]==null&&(b.tabs[l]={});var u=h.nextZero(r,s),v=h.readASCII(r,s,u-s),A=s+E-u-1;if(l=="tEXt")I=h.readASCII(r,u+1,A);else{var w=f(r.slice(u+2,u+2+A));I=h.readUTF8(w,0,w.length)}b.tabs[l][v]=I}else if(l=="iTXt"){b.tabs[l]==null&&(b.tabs[l]={}),u=0,c=s,u=h.nextZero(r,c),v=h.readASCII(r,c,u-c);const a=r[c=u+1];var I;r[c+1],c+=2,u=h.nextZero(r,c),h.readASCII(r,c,u-c),c=u+1,u=h.nextZero(r,c),h.readUTF8(r,c,u-c),A=E-((c=u+1)-s),a==0?I=h.readUTF8(r,c,A):(w=f(r.slice(c,c+A)),I=h.readUTF8(w,0,w.length)),b.tabs[l][v]=I}else if(l=="PLTE")b.tabs[l]=h.readBytes(r,s,E);else if(l=="hIST"){const a=b.tabs.PLTE.length/3;for(b.tabs[l]=[],z=0;z<a;z++)b.tabs[l].push(j(r,s+2*z))}else if(l=="tRNS")b.ctype==3?b.tabs[l]=h.readBytes(r,s,E):b.ctype==0?b.tabs[l]=j(r,s):b.ctype==2&&(b.tabs[l]=[j(r,s),j(r,s+2),j(r,s+4)]);else if(l=="gAMA")b.tabs[l]=h.readUint(r,s)/1e5;else if(l=="sRGB")b.tabs[l]=r[s];else if(l=="bKGD")b.ctype==0||b.ctype==4?b.tabs[l]=[j(r,s)]:b.ctype==2||b.ctype==6?b.tabs[l]=[j(r,s),j(r,s+2),j(r,s+4)]:b.ctype==3&&(b.tabs[l]=r[s]);else if(l=="IEND")break;s+=E,h.readUint(r,s),s+=4}var x;return _!=0&&((x=b.frames[b.frames.length-1]).data=U(b,D.slice(0,_),x.rect.width,x.rect.height)),b.data=U(b,P,b.width,b.height),delete b.compress,delete b.interlace,delete b.filter,b},toRGBA8:function(o){const r=o.width,s=o.height;if(o.tabs.acTL==null)return[C(o.data,r,s,o).buffer];const h=[];o.frames[0].data==null&&(o.frames[0].data=o.data);const j=r*s*4,k=new Uint8Array(j),b=new Uint8Array(j),P=new Uint8Array(j);for(let R=0;R<o.frames.length;R++){const _=o.frames[R],g=_.rect.x,z=_.rect.y,c=_.rect.width,u=_.rect.height,v=C(_.data,c,u,o);if(R!=0)for(var D=0;D<j;D++)P[D]=k[D];if(_.blend==0?y(v,c,u,k,r,s,g,z,0):_.blend==1&&y(v,c,u,k,r,s,g,z,1),h.push(k.buffer.slice(0)),_.dispose!=0){if(_.dispose==1)y(b,c,u,k,r,s,g,z,0);else if(_.dispose==2)for(D=0;D<j;D++)k[D]=P[D]}}return h},_paeth:i,_copyTile:y,_bin:S}})();(function(){const{_copyTile:S}=ve,{_bin:C}=ve,U=ve._paeth;var f={table:(function(){const c=new Uint32Array(256);for(let u=0;u<256;u++){let v=u;for(let A=0;A<8;A++)1&v?v=3988292384^v>>>1:v>>>=1;c[u]=v}return c})(),update(c,u,v,A){for(let w=0;w<A;w++)c=f.table[255&(c^u[v+w])]^c>>>8;return c},crc:(c,u,v)=>4294967295^f.update(4294967295,c,u,v)};function e(c,u,v,A){u[v]+=c[0]*A>>4,u[v+1]+=c[1]*A>>4,u[v+2]+=c[2]*A>>4,u[v+3]+=c[3]*A>>4}function t(c){return Math.max(0,Math.min(255,c))}function d(c,u){const v=c[0]-u[0],A=c[1]-u[1],w=c[2]-u[2],I=c[3]-u[3];return v*v+A*A+w*w+I*I}function i(c,u,v,A,w,I,x){x==null&&(x=1);const E=A.length,l=[];for(var a=0;a<E;a++){const M=A[a];l.push([M>>>0&255,M>>>8&255,M>>>16&255,M>>>24&255])}for(a=0;a<E;a++){let M=4294967295;for(var T=0,F=0;F<E;F++){var O=d(l[a],l[F]);F!=a&&O<M&&(M=O,T=F)}}const N=new Uint32Array(w.buffer),$=new Int16Array(u*v*4),B=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(a=0;a<B.length;a++)B[a]=255*((B[a]+.5)/16-.5);for(let M=0;M<v;M++)for(let q=0;q<u;q++){var H;a=4*(M*u+q),x!=2?H=[t(c[a]+$[a]),t(c[a+1]+$[a+1]),t(c[a+2]+$[a+2]),t(c[a+3]+$[a+3])]:(O=B[4*(3&M)+(3&q)],H=[t(c[a]+O),t(c[a+1]+O),t(c[a+2]+O),t(c[a+3]+O)]),T=0;let re=16777215;for(F=0;F<E;F++){const oe=d(H,l[F]);oe<re&&(re=oe,T=F)}const ne=l[T],J=[H[0]-ne[0],H[1]-ne[1],H[2]-ne[2],H[3]-ne[3]];x==1&&(q!=u-1&&e(J,$,a+4,7),M!=v-1&&(q!=0&&e(J,$,a+4*u-4,3),e(J,$,a+4*u,5),q!=u-1&&e(J,$,a+4*u+4,1))),I[a>>2]=T,N[a>>2]=A[T]}}function p(c,u,v,A,w){w==null&&(w={});const{crc:I}=f,x=C.writeUint,E=C.writeUshort,l=C.writeASCII;let a=8;const T=c.frames.length>1;let F,O=!1,N=33+(T?20:0);if(w.sRGB!=null&&(N+=13),w.pHYs!=null&&(N+=21),w.iCCP!=null&&(F=pako.deflate(w.iCCP),N+=21+F.length+4),c.ctype==3){for(var $=c.plte.length,B=0;B<$;B++)c.plte[B]>>>24!=255&&(O=!0);N+=8+3*$+4+(O?8+1*$+4:0)}for(var H=0;H<c.frames.length;H++)T&&(N+=38),N+=(ne=c.frames[H]).cimg.length+12,H!=0&&(N+=4);N+=12;const M=new Uint8Array(N),q=[137,80,78,71,13,10,26,10];for(B=0;B<8;B++)M[B]=q[B];if(x(M,a,13),a+=4,l(M,a,"IHDR"),a+=4,x(M,a,u),a+=4,x(M,a,v),a+=4,M[a]=c.depth,a++,M[a]=c.ctype,a++,M[a]=0,a++,M[a]=0,a++,M[a]=0,a++,x(M,a,I(M,a-17,17)),a+=4,w.sRGB!=null&&(x(M,a,1),a+=4,l(M,a,"sRGB"),a+=4,M[a]=w.sRGB,a++,x(M,a,I(M,a-5,5)),a+=4),w.iCCP!=null){const J=13+F.length;x(M,a,J),a+=4,l(M,a,"iCCP"),a+=4,l(M,a,"ICC profile"),a+=11,a+=2,M.set(F,a),a+=F.length,x(M,a,I(M,a-(J+4),J+4)),a+=4}if(w.pHYs!=null&&(x(M,a,9),a+=4,l(M,a,"pHYs"),a+=4,x(M,a,w.pHYs[0]),a+=4,x(M,a,w.pHYs[1]),a+=4,M[a]=w.pHYs[2],a++,x(M,a,I(M,a-13,13)),a+=4),T&&(x(M,a,8),a+=4,l(M,a,"acTL"),a+=4,x(M,a,c.frames.length),a+=4,x(M,a,w.loop!=null?w.loop:0),a+=4,x(M,a,I(M,a-12,12)),a+=4),c.ctype==3){for(x(M,a,3*($=c.plte.length)),a+=4,l(M,a,"PLTE"),a+=4,B=0;B<$;B++){const J=3*B,oe=c.plte[B],W=255&oe,L=oe>>>8&255,Q=oe>>>16&255;M[a+J+0]=W,M[a+J+1]=L,M[a+J+2]=Q}if(a+=3*$,x(M,a,I(M,a-3*$-4,3*$+4)),a+=4,O){for(x(M,a,$),a+=4,l(M,a,"tRNS"),a+=4,B=0;B<$;B++)M[a+B]=c.plte[B]>>>24&255;a+=$,x(M,a,I(M,a-$-4,$+4)),a+=4}}let re=0;for(H=0;H<c.frames.length;H++){var ne=c.frames[H];T&&(x(M,a,26),a+=4,l(M,a,"fcTL"),a+=4,x(M,a,re++),a+=4,x(M,a,ne.rect.width),a+=4,x(M,a,ne.rect.height),a+=4,x(M,a,ne.rect.x),a+=4,x(M,a,ne.rect.y),a+=4,E(M,a,A[H]),a+=2,E(M,a,1e3),a+=2,M[a]=ne.dispose,a++,M[a]=ne.blend,a++,x(M,a,I(M,a-30,30)),a+=4);const J=ne.cimg;x(M,a,($=J.length)+(H==0?0:4)),a+=4;const oe=a;l(M,a,H==0?"IDAT":"fdAT"),a+=4,H!=0&&(x(M,a,re++),a+=4),M.set(J,a),a+=$,x(M,a,I(M,oe,a-oe)),a+=4}return x(M,a,0),a+=4,l(M,a,"IEND"),a+=4,x(M,a,I(M,a-4,4)),a+=4,M.buffer}function y(c,u,v){for(let A=0;A<c.frames.length;A++){const w=c.frames[A];w.rect.width;const I=w.rect.height,x=new Uint8Array(I*w.bpl+I);w.cimg=s(w.img,I,w.bpp,w.bpl,x,u,v)}}function n(c,u,v,A,w){const I=w[0],x=w[1],E=w[2],l=w[3],a=w[4],T=w[5];let F=6,O=8,N=255;for(var $=0;$<c.length;$++){const se=new Uint8Array(c[$]);for(var B=se.length,H=0;H<B;H+=4)N&=se[H+3]}const M=N!=255,q=(function(ee,K,ae,fe,le,me){const ce=[];for(var ie=0;ie<ee.length;ie++){const he=new Uint8Array(ee[ie]),be=new Uint32Array(he.buffer);var xe;let ye=0,Se=0,Ae=K,ke=ae,ut=fe?1:0;if(ie!=0){const sr=me||fe||ie==1||ce[ie-2].dispose!=0?1:2;let ht=0,wt=1e9;for(let Be=0;Be<sr;Be++){var Ie=new Uint8Array(ee[ie-1-Be]);const lr=new Uint32Array(ee[ie-1-Be]);let Fe=K,Ee=ae,Pe=-1,Qe=-1;for(let De=0;De<ae;De++)for(let ze=0;ze<K;ze++)be[de=De*K+ze]!=lr[de]&&(ze<Fe&&(Fe=ze),ze>Pe&&(Pe=ze),De<Ee&&(Ee=De),De>Qe&&(Qe=De));Pe==-1&&(Fe=Ee=Pe=Qe=0),le&&((1&Fe)==1&&Fe--,(1&Ee)==1&&Ee--);const At=(Pe-Fe+1)*(Qe-Ee+1);At<wt&&(wt=At,ht=Be,ye=Fe,Se=Ee,Ae=Pe-Fe+1,ke=Qe-Ee+1)}Ie=new Uint8Array(ee[ie-1-ht]),ht==1&&(ce[ie-1].dispose=2),xe=new Uint8Array(Ae*ke*4),S(Ie,K,ae,xe,Ae,ke,-ye,-Se,0),ut=S(he,K,ae,xe,Ae,ke,-ye,-Se,3)?1:0,ut==1?r(he,K,ae,xe,{x:ye,y:Se,width:Ae,height:ke}):S(he,K,ae,xe,Ae,ke,-ye,-Se,0)}else xe=he.slice(0);ce.push({rect:{x:ye,y:Se,width:Ae,height:ke},img:xe,blend:ut,dispose:0})}if(fe)for(ie=0;ie<ce.length;ie++){if((Ue=ce[ie]).blend==1)continue;const he=Ue.rect,be=ce[ie-1].rect,ye=Math.min(he.x,be.x),Se=Math.min(he.y,be.y),Ae={x:ye,y:Se,width:Math.max(he.x+he.width,be.x+be.width)-ye,height:Math.max(he.y+he.height,be.y+be.height)-Se};ce[ie-1].dispose=1,ie-1!=0&&o(ee,K,ae,ce,ie-1,Ae,le),o(ee,K,ae,ce,ie,Ae,le)}let Ke=0;if(ee.length!=1)for(var de=0;de<ce.length;de++){var Ue;Ke+=(Ue=ce[de]).rect.width*Ue.rect.height}return ce})(c,u,v,I,x,E),re={},ne=[],J=[];if(A!=0){const se=[];for(H=0;H<q.length;H++)se.push(q[H].img.buffer);const ee=(function(le){let me=0;for(var ce=0;ce<le.length;ce++)me+=le[ce].byteLength;const ie=new Uint8Array(me);let xe=0;for(ce=0;ce<le.length;ce++){const Ie=new Uint8Array(le[ce]),Ke=Ie.length;for(let de=0;de<Ke;de+=4){let Ue=Ie[de],he=Ie[de+1],be=Ie[de+2];const ye=Ie[de+3];ye==0&&(Ue=he=be=0),ie[xe+de]=Ue,ie[xe+de+1]=he,ie[xe+de+2]=be,ie[xe+de+3]=ye}xe+=Ke}return ie.buffer})(se),K=j(ee,A);for(H=0;H<K.plte.length;H++)ne.push(K.plte[H].est.rgba);let ae=0;for(H=0;H<q.length;H++){const fe=(W=q[H]).img.length;var oe=new Uint8Array(K.inds.buffer,ae>>2,fe>>2);J.push(oe);const le=new Uint8Array(K.abuf,ae,fe);T&&i(W.img,W.rect.width,W.rect.height,ne,le,oe),W.img.set(le),ae+=fe}}else for($=0;$<q.length;$++){var W=q[$];const se=new Uint32Array(W.img.buffer);var L=W.rect.width;for(B=se.length,oe=new Uint8Array(B),J.push(oe),H=0;H<B;H++){const ee=se[H];if(H!=0&&ee==se[H-1])oe[H]=oe[H-1];else if(H>L&&ee==se[H-L])oe[H]=oe[H-L];else{let K=re[ee];if(K==null&&(re[ee]=K=ne.length,ne.push(ee),ne.length>=300))break;oe[H]=K}}}const Q=ne.length;for(Q<=256&&a==0&&(O=Q<=2?1:Q<=4?2:Q<=16?4:8,O=Math.max(O,l)),$=0;$<q.length;$++){(W=q[$]).rect.x,W.rect.y,L=W.rect.width;const se=W.rect.height;let ee=W.img;new Uint32Array(ee.buffer);let K=4*L,ae=4;if(Q<=256&&a==0){K=Math.ceil(O*L/8);var X=new Uint8Array(K*se);const fe=J[$];for(let le=0;le<se;le++){H=le*K;const me=le*L;if(O==8)for(var Z=0;Z<L;Z++)X[H+Z]=fe[me+Z];else if(O==4)for(Z=0;Z<L;Z++)X[H+(Z>>1)]|=fe[me+Z]<<4-4*(1&Z);else if(O==2)for(Z=0;Z<L;Z++)X[H+(Z>>2)]|=fe[me+Z]<<6-2*(3&Z);else if(O==1)for(Z=0;Z<L;Z++)X[H+(Z>>3)]|=fe[me+Z]<<7-1*(7&Z)}ee=X,F=3,ae=1}else if(M==0&&q.length==1){X=new Uint8Array(L*se*3);const fe=L*se;for(H=0;H<fe;H++){const le=3*H,me=4*H;X[le]=ee[me],X[le+1]=ee[me+1],X[le+2]=ee[me+2]}ee=X,F=2,ae=3,K=3*L}W.img=ee,W.bpl=K,W.bpp=ae}return{ctype:F,depth:O,plte:ne,frames:q}}function o(c,u,v,A,w,I,x){const E=Uint8Array,l=Uint32Array,a=new E(c[w-1]),T=new l(c[w-1]),F=w+1<c.length?new E(c[w+1]):null,O=new E(c[w]),N=new l(O.buffer);let $=u,B=v,H=-1,M=-1;for(let re=0;re<I.height;re++)for(let ne=0;ne<I.width;ne++){const J=I.x+ne,oe=I.y+re,W=oe*u+J,L=N[W];L==0||A[w-1].dispose==0&&T[W]==L&&(F==null||F[4*W+3]!=0)||(J<$&&($=J),J>H&&(H=J),oe<B&&(B=oe),oe>M&&(M=oe))}H==-1&&($=B=H=M=0),x&&((1&$)==1&&$--,(1&B)==1&&B--),I={x:$,y:B,width:H-$+1,height:M-B+1};const q=A[w];q.rect=I,q.blend=1,q.img=new Uint8Array(I.width*I.height*4),A[w-1].dispose==0?(S(a,u,v,q.img,I.width,I.height,-I.x,-I.y,0),r(O,u,v,q.img,I)):S(O,u,v,q.img,I.width,I.height,-I.x,-I.y,0)}function r(c,u,v,A,w){S(c,u,v,A,w.width,w.height,-w.x,-w.y,2)}function s(c,u,v,A,w,I,x){const E=[];let l,a=[0,1,2,3,4];I!=-1?a=[I]:(u*A>5e5||v==1)&&(a=[0]),x&&(l={level:0});const T=ln;for(var F=0;F<a.length;F++){for(let $=0;$<u;$++)h(w,c,$,A,v,a[F]);E.push(T.deflate(w,l))}let O,N=1e9;for(F=0;F<E.length;F++)E[F].length<N&&(O=F,N=E[F].length);return E[O]}function h(c,u,v,A,w,I){const x=v*A;let E=x+v;if(c[E]=I,E++,I==0)if(A<500)for(var l=0;l<A;l++)c[E+l]=u[x+l];else c.set(new Uint8Array(u.buffer,x,A),E);else if(I==1){for(l=0;l<w;l++)c[E+l]=u[x+l];for(l=w;l<A;l++)c[E+l]=u[x+l]-u[x+l-w]+256&255}else if(v==0){for(l=0;l<w;l++)c[E+l]=u[x+l];if(I==2)for(l=w;l<A;l++)c[E+l]=u[x+l];if(I==3)for(l=w;l<A;l++)c[E+l]=u[x+l]-(u[x+l-w]>>1)+256&255;if(I==4)for(l=w;l<A;l++)c[E+l]=u[x+l]-U(u[x+l-w],0,0)+256&255}else{if(I==2)for(l=0;l<A;l++)c[E+l]=u[x+l]+256-u[x+l-A]&255;if(I==3){for(l=0;l<w;l++)c[E+l]=u[x+l]+256-(u[x+l-A]>>1)&255;for(l=w;l<A;l++)c[E+l]=u[x+l]+256-(u[x+l-A]+u[x+l-w]>>1)&255}if(I==4){for(l=0;l<w;l++)c[E+l]=u[x+l]+256-U(0,u[x+l-A],0)&255;for(l=w;l<A;l++)c[E+l]=u[x+l]+256-U(u[x+l-w],u[x+l-A],u[x+l-w-A])&255}}}function j(c,u){const v=new Uint8Array(c),A=v.slice(0),w=new Uint32Array(A.buffer),I=k(A,u),x=I[0],E=I[1],l=v.length,a=new Uint8Array(l>>2);let T;if(v.length<2e7)for(var F=0;F<l;F+=4)T=b(x,O=v[F]*(1/255),N=v[F+1]*(1/255),$=v[F+2]*(1/255),B=v[F+3]*(1/255)),a[F>>2]=T.ind,w[F>>2]=T.est.rgba;else for(F=0;F<l;F+=4){var O=v[F]*.00392156862745098,N=v[F+1]*(1/255),$=v[F+2]*(1/255),B=v[F+3]*(1/255);for(T=x;T.left;)T=P(T.est,O,N,$,B)<=0?T.left:T.right;a[F>>2]=T.ind,w[F>>2]=T.est.rgba}return{abuf:A.buffer,inds:a,plte:E}}function k(c,u,v){v==null&&(v=1e-4);const A=new Uint32Array(c.buffer),w={i0:0,i1:c.length,bst:null,est:null,tdst:0,left:null,right:null};w.bst=_(c,w.i0,w.i1),w.est=g(w.bst);const I=[w];for(;I.length<u;){let E=0,l=0;for(var x=0;x<I.length;x++)I[x].est.L>E&&(E=I[x].est.L,l=x);if(E<v)break;const a=I[l],T=D(c,A,a.i0,a.i1,a.est.e,a.est.eMq255);if(a.i0>=T||a.i1<=T){a.est.L=0;continue}const F={i0:a.i0,i1:T,bst:null,est:null,tdst:0,left:null,right:null};F.bst=_(c,F.i0,F.i1),F.est=g(F.bst);const O={i0:T,i1:a.i1,bst:null,est:null,tdst:0,left:null,right:null};for(O.bst={R:[],m:[],N:a.bst.N-F.bst.N},x=0;x<16;x++)O.bst.R[x]=a.bst.R[x]-F.bst.R[x];for(x=0;x<4;x++)O.bst.m[x]=a.bst.m[x]-F.bst.m[x];O.est=g(O.bst),a.left=F,a.right=O,I[l]=F,I.push(O)}for(I.sort(((E,l)=>l.bst.N-E.bst.N)),x=0;x<I.length;x++)I[x].ind=x;return[w,I]}function b(c,u,v,A,w){if(c.left==null)return c.tdst=(function(F,O,N,$,B){const H=O-F[0],M=N-F[1],q=$-F[2],re=B-F[3];return H*H+M*M+q*q+re*re})(c.est.q,u,v,A,w),c;const I=P(c.est,u,v,A,w);let x=c.left,E=c.right;I>0&&(x=c.right,E=c.left);const l=b(x,u,v,A,w);if(l.tdst<=I*I)return l;const a=b(E,u,v,A,w);return a.tdst<l.tdst?a:l}function P(c,u,v,A,w){const{e:I}=c;return I[0]*u+I[1]*v+I[2]*A+I[3]*w-c.eMq}function D(c,u,v,A,w,I){for(A-=4;v<A;){for(;R(c,v,w)<=I;)v+=4;for(;R(c,A,w)>I;)A-=4;if(v>=A)break;const x=u[v>>2];u[v>>2]=u[A>>2],u[A>>2]=x,v+=4,A-=4}for(;R(c,v,w)>I;)v-=4;return v+4}function R(c,u,v){return c[u]*v[0]+c[u+1]*v[1]+c[u+2]*v[2]+c[u+3]*v[3]}function _(c,u,v){const A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=[0,0,0,0],I=v-u>>2;for(let x=u;x<v;x+=4){const E=c[x]*.00392156862745098,l=c[x+1]*(1/255),a=c[x+2]*(1/255),T=c[x+3]*(1/255);w[0]+=E,w[1]+=l,w[2]+=a,w[3]+=T,A[0]+=E*E,A[1]+=E*l,A[2]+=E*a,A[3]+=E*T,A[5]+=l*l,A[6]+=l*a,A[7]+=l*T,A[10]+=a*a,A[11]+=a*T,A[15]+=T*T}return A[4]=A[1],A[8]=A[2],A[9]=A[6],A[12]=A[3],A[13]=A[7],A[14]=A[11],{R:A,m:w,N:I}}function g(c){const{R:u}=c,{m:v}=c,{N:A}=c,w=v[0],I=v[1],x=v[2],E=v[3],l=A==0?0:1/A,a=[u[0]-w*w*l,u[1]-w*I*l,u[2]-w*x*l,u[3]-w*E*l,u[4]-I*w*l,u[5]-I*I*l,u[6]-I*x*l,u[7]-I*E*l,u[8]-x*w*l,u[9]-x*I*l,u[10]-x*x*l,u[11]-x*E*l,u[12]-E*w*l,u[13]-E*I*l,u[14]-E*x*l,u[15]-E*E*l],T=a,F=z;let O=[Math.random(),Math.random(),Math.random(),Math.random()],N=0,$=0;if(A!=0)for(let H=0;H<16&&(O=F.multVec(T,O),$=Math.sqrt(F.dot(O,O)),O=F.sml(1/$,O),!(H!=0&&Math.abs($-N)<1e-9));H++)N=$;const B=[w*l,I*l,x*l,E*l];return{Cov:a,q:B,e:O,L:N,eMq255:F.dot(F.sml(255,B),O),eMq:F.dot(O,B),rgba:(Math.round(255*B[3])<<24|Math.round(255*B[2])<<16|Math.round(255*B[1])<<8|Math.round(255*B[0])<<0)>>>0}}var z={multVec:(c,u)=>[c[0]*u[0]+c[1]*u[1]+c[2]*u[2]+c[3]*u[3],c[4]*u[0]+c[5]*u[1]+c[6]*u[2]+c[7]*u[3],c[8]*u[0]+c[9]*u[1]+c[10]*u[2]+c[11]*u[3],c[12]*u[0]+c[13]*u[1]+c[14]*u[2]+c[15]*u[3]],dot:(c,u)=>c[0]*u[0]+c[1]*u[1]+c[2]*u[2]+c[3]*u[3],sml:(c,u)=>[c*u[0],c*u[1],c*u[2],c*u[3]]};ve.encode=function(u,v,A,w,I,x,E){w==null&&(w=0),E==null&&(E=!1);const l=n(u,v,A,w,[!1,!1,!1,0,E,!1]);return y(l,-1),p(l,v,A,I,x)},ve.encodeLL=function(u,v,A,w,I,x,E,l){const a={ctype:0+(w==1?0:2)+(I==0?0:4),depth:x,frames:[]},T=(w+I)*x,F=T*v;for(let O=0;O<u.length;O++)a.frames.push({rect:{x:0,y:0,width:v,height:A},img:new Uint8Array(u[O]),blend:0,dispose:1,bpp:Math.ceil(T/8),bpl:Math.ceil(F/8)});return y(a,0,!0),p(a,v,A,E,l)},ve.encode.compress=n,ve.encode.dither=i,ve.quantize=j,ve.quantize.getKDtree=k,ve.quantize.getNearest=b})();const Yt={toArrayBuffer(S,C){const U=S.width,f=S.height,e=U<<2,t=S.getContext("2d").getImageData(0,0,U,f),d=new Uint32Array(t.data.buffer),i=(32*U+31)/32<<2,p=i*f,y=122+p,n=new ArrayBuffer(y),o=new DataView(n),r=1<<20;let s,h,j,k,b=r,P=0,D=0,R=0;function _(c){o.setUint16(D,c,!0),D+=2}function g(c){o.setUint32(D,c,!0),D+=4}function z(c){D+=c}_(19778),g(y),z(4),g(122),g(108),g(U),g(-f>>>0),_(1),_(32),g(3),g(p),g(2835),g(2835),z(8),g(16711680),g(65280),g(255),g(4278190080),g(1466527264),(function c(){for(;P<f&&b>0;){for(k=122+P*i,s=0;s<e;)b--,h=d[R++],j=h>>>24,o.setUint32(k+s,h<<8|j),s+=4;P++}R<d.length?(b=r,setTimeout(c,Yt._dly)):C(n)})()},toBlob(S,C){this.toArrayBuffer(S,(U=>{C(new Blob([U],{type:"image/bmp"}))}))},_dly:9};var ge={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},cn={[ge.CHROME]:16384,[ge.FIREFOX]:11180,[ge.DESKTOP_SAFARI]:16384,[ge.IE]:8192,[ge.IOS]:4096,[ge.ETC]:8192};const bt=typeof window<"u",Xt=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,st=bt&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),fn=(bt||Xt)&&(st&&st.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Jt=(bt||Xt)&&(st&&st.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function vt(S,C,U=Date.now()){return new Promise((f=>{const e=S.split(","),t=e[0].match(/:(.*?);/)[1],d=globalThis.atob(e[1]);let i=d.length;const p=new Uint8Array(i);for(;i--;)p[i]=d.charCodeAt(i);const y=new Blob([p],{type:t});y.name=C,y.lastModified=U,f(y)}))}function er(S){return new Promise(((C,U)=>{const f=new Jt;f.onload=()=>C(f.result),f.onerror=e=>U(e),f.readAsDataURL(S)}))}function tr(S){return new Promise(((C,U)=>{const f=new Image;f.onload=()=>C(f),f.onerror=e=>U(e),f.src=S}))}function Te(){if(Te.cachedResult!==void 0)return Te.cachedResult;let S=ge.ETC;const{userAgent:C}=navigator;return/Chrom(e|ium)/i.test(C)?S=ge.CHROME:/iP(ad|od|hone)/i.test(C)&&/WebKit/i.test(C)?S=ge.IOS:/Safari/i.test(C)?S=ge.DESKTOP_SAFARI:/Firefox/i.test(C)?S=ge.FIREFOX:(/MSIE/i.test(C)||document.documentMode)&&(S=ge.IE),Te.cachedResult=S,Te.cachedResult}function rr(S,C){const U=Te(),f=cn[U];let e=S,t=C,d=e*t;const i=e>t?t/e:e/t;for(;d>f*f;){const p=(f+e)/2,y=(f+t)/2;p<y?(t=y,e=y*i):(t=p*i,e=p),d=e*t}return{width:e,height:t}}function dt(S,C){let U,f;try{if(U=new OffscreenCanvas(S,C),f=U.getContext("2d"),f===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{U=document.createElement("canvas"),f=U.getContext("2d")}return U.width=S,U.height=C,[U,f]}function nr(S,C){const{width:U,height:f}=rr(S.width,S.height),[e,t]=dt(U,f);return C&&/jpe?g/.test(C)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(S,0,0,e.width,e.height),e}function rt(){return rt.cachedResult!==void 0||(rt.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),rt.cachedResult}function lt(S,C={}){return new Promise((function(U,f){let e,t;var d=function(){try{return t=nr(e,C.fileType||S.type),U([e,t])}catch(p){return f(p)}},i=function(p){try{var y=function(n){try{throw n}catch(o){return f(o)}};try{let n;return er(S).then((function(o){try{return n=o,tr(n).then((function(r){try{return e=r,(function(){try{return d()}catch(s){return f(s)}})()}catch(s){return y(s)}}),y)}catch(r){return y(r)}}),y)}catch(n){y(n)}}catch(n){return f(n)}};try{if(rt()||[ge.DESKTOP_SAFARI,ge.MOBILE_SAFARI].includes(Te()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(S).then((function(p){try{return e=p,d()}catch{return i()}}),i)}catch{i()}}))}function ct(S,C,U,f,e=1){return new Promise((function(t,d){let i;if(C==="image/png"){let y,n,o;return y=S.getContext("2d"),{data:n}=y.getImageData(0,0,S.width,S.height),o=ve.encode([n.buffer],S.width,S.height,4096*e),i=new Blob([o],{type:C}),i.name=U,i.lastModified=f,p.call(this)}{let y=function(){return p.call(this)};if(C==="image/bmp")return new Promise((n=>Yt.toBlob(S,n))).then((function(n){try{return i=n,i.name=U,i.lastModified=f,y.call(this)}catch(o){return d(o)}}).bind(this),d);{let n=function(){return y.call(this)};if(typeof OffscreenCanvas=="function"&&S instanceof OffscreenCanvas)return S.convertToBlob({type:C,quality:e}).then((function(o){try{return i=o,i.name=U,i.lastModified=f,n.call(this)}catch(r){return d(r)}}).bind(this),d);{let o;return o=S.toDataURL(C,e),vt(o,U,f).then((function(r){try{return i=r,n.call(this)}catch(s){return d(s)}}).bind(this),d)}}}function p(){return t(i)}}))}function Ce(S){S.width=0,S.height=0}function He(){return new Promise((function(S,C){let U,f,e,t;return He.cachedResult!==void 0?S(He.cachedResult):vt("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(d){try{return U=d,lt(U).then((function(i){try{return f=i[1],ct(f,U.type,U.name,U.lastModified).then((function(p){try{return e=p,Ce(f),lt(e).then((function(y){try{return t=y[0],He.cachedResult=t.width===1&&t.height===2,S(He.cachedResult)}catch(n){return C(n)}}),C)}catch(y){return C(y)}}),C)}catch(p){return C(p)}}),C)}catch(i){return C(i)}}),C)}))}function or(S){return new Promise(((C,U)=>{const f=new Jt;f.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return C(-2);const d=t.byteLength;let i=2;for(;i<d;){if(t.getUint16(i+2,!1)<=8)return C(-1);const p=t.getUint16(i,!1);if(i+=2,p==65505){if(t.getUint32(i+=2,!1)!=1165519206)return C(-1);const y=t.getUint16(i+=6,!1)==18761;i+=t.getUint32(i+4,y);const n=t.getUint16(i,y);i+=2;for(let o=0;o<n;o++)if(t.getUint16(i+12*o,y)==274)return C(t.getUint16(i+12*o+8,y))}else{if((65280&p)!=65280)break;i+=t.getUint16(i,!1)}}return C(-1)},f.onerror=e=>U(e),f.readAsArrayBuffer(S)}))}function ar(S,C){const{width:U}=S,{height:f}=S,{maxWidthOrHeight:e}=C;let t,d=S;return isFinite(e)&&(U>e||f>e)&&([d,t]=dt(U,f),U>f?(d.width=e,d.height=f/U*e):(d.width=U/f*e,d.height=e),t.drawImage(S,0,0,d.width,d.height),Ce(S)),d}function ir(S,C){const{width:U}=S,{height:f}=S,[e,t]=dt(U,f);switch(C>4&&C<9?(e.width=f,e.height=U):(e.width=U,e.height=f),C){case 2:t.transform(-1,0,0,1,U,0);break;case 3:t.transform(-1,0,0,-1,U,f);break;case 4:t.transform(1,0,0,-1,0,f);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,f,0);break;case 7:t.transform(0,-1,-1,0,f,U);break;case 8:t.transform(0,-1,1,0,0,U)}return t.drawImage(S,0,0,U,f),Ce(S),e}function zt(S,C,U=0){return new Promise((function(f,e){let t,d,i,p,y,n,o,r,s,h,j,k,b,P,D,R,_,g,z,c;function u(A=5){if(C.signal&&C.signal.aborted)throw C.signal.reason;t+=A,C.onProgress(Math.min(t,100))}function v(A){if(C.signal&&C.signal.aborted)throw C.signal.reason;t=Math.min(Math.max(A,t),100),C.onProgress(t)}return t=U,d=C.maxIteration||10,i=1024*C.maxSizeMB*1024,u(),lt(S,C).then((function(A){try{return[,p]=A,u(),y=ar(p,C),u(),new Promise((function(w,I){var x;if(!(x=C.exifOrientation))return or(S).then((function(l){try{return x=l,E.call(this)}catch(a){return I(a)}}).bind(this),I);function E(){return w(x)}return E.call(this)})).then((function(w){try{return n=w,u(),He().then((function(I){try{return o=I?y:ir(y,n),u(),r=C.initialQuality||1,s=C.fileType||S.type,ct(o,s,S.name,S.lastModified,r).then((function(x){try{{let l=function(){if(d--&&(D>i||D>b)){let T,F;return T=c?.95*z.width:z.width,F=c?.95*z.height:z.height,[_,g]=dt(T,F),g.drawImage(z,0,0,T,F),r*=s==="image/png"?.85:.95,ct(_,s,S.name,S.lastModified,r).then((function(O){try{return R=O,Ce(z),z=_,D=R.size,v(Math.min(99,Math.floor((P-D)/(P-i)*100))),l}catch(N){return e(N)}}),e)}return[1]},a=function(){return Ce(z),Ce(_),Ce(y),Ce(o),Ce(p),v(100),f(R)};if(h=x,u(),j=h.size>i,k=h.size>S.size,!j&&!k)return v(100),f(h);var E;return b=S.size,P=h.size,D=P,z=o,c=!C.alwaysKeepResolution&&j,(E=(function(T){for(;T;){if(T.then)return void T.then(E,e);try{if(T.pop){if(T.length)return T.pop()?a.call(this):T;T=l}else T=T.call(this)}catch(F){return e(F)}}}).bind(this))(l)}}catch(l){return e(l)}}).bind(this),e)}catch(x){return e(x)}}).bind(this),e)}catch(I){return e(I)}}).bind(this),e)}catch(w){return e(w)}}).bind(this),e)}))}const dn=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let mt;function un(S,C){return new Promise(((U,f)=>{mt||(mt=(function(d){const i=[];return i.push(d),URL.createObjectURL(new Blob(i))})(dn));const e=new Worker(mt);e.addEventListener("message",(function(d){if(C.signal&&C.signal.aborted)e.terminate();else if(d.data.progress===void 0){if(d.data.error)return f(new Error(d.data.error)),void e.terminate();U(d.data.file),e.terminate()}else C.onProgress(d.data.progress)})),e.addEventListener("error",f),C.signal&&C.signal.addEventListener("abort",(()=>{f(C.signal.reason),e.terminate()})),e.postMessage({file:S,imageCompressionLibUrl:C.libURL,options:{...C,onProgress:void 0,signal:void 0}})}))}function ue(S,C){return new Promise((function(U,f){let e,t,d,i,p,y;if(e={...C},d=0,{onProgress:i}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,p=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=s=>{d=s,typeof i=="function"&&i(d)},!(S instanceof Blob||S instanceof fn))return f(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(S.type))return f(new Error("The file given is not an image"));if(y=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!p||typeof Worker!="function"||y)return zt(S,e).then((function(s){try{return t=s,r.call(this)}catch(h){return f(h)}}).bind(this),f);var n=(function(){try{return r.call(this)}catch(s){return f(s)}}).bind(this),o=function(s){try{return zt(S,e).then((function(h){try{return t=h,n()}catch(j){return f(j)}}),f)}catch(h){return f(h)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",un(S,e).then((function(s){try{return t=s,n()}catch{return o()}}),o)}catch{o()}function r(){try{t.name=S.name,t.lastModified=S.lastModified}catch{}try{e.preserveExif&&S.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===S.type)&&(t=Zt(S,t))}catch{}return U(t)}}))}ue.getDataUrlFromFile=er,ue.getFilefromDataUrl=vt,ue.loadImage=tr,ue.drawImageInCanvas=nr,ue.drawFileInCanvas=lt,ue.canvasToFile=ct,ue.getExifOrientation=or,ue.handleMaxWidthOrHeight=ar,ue.followExifOrientation=ir,ue.cleanupCanvasMemory=Ce,ue.isAutoOrientationInBrowser=He,ue.approximateBelowMaximumCanvasSizeOfBrowser=rr,ue.copyExifWithoutOrientation=Zt,ue.getBrowserName=Te,ue.version="2.0.2";const hn=S=>S?Ir.includes(S.type)?S.size>Ft?{valid:!1,error:`File size exceeds ${Ft/1024/1024}MB limit.`}:{valid:!0,error:null}:{valid:!1,error:"Invalid file type. Please upload a JPEG, PNG, or WebP image."}:{valid:!1,error:"No file provided"},pn=async(S,C)=>{try{const U={maxSizeMB:Fr/1024/1024,maxWidthOrHeight:1920,useWebWorker:!0,fileType:S.type,onProgress:C||void 0};return await ue(S,U)}catch(U){throw console.error("Image compression error:",U),new Error("Failed to compress image")}},gn=async(S,C,U)=>{try{const f=hn(S);if(!f.valid)throw new Error(f.error);const e=await pn(S,n=>{U&&U(n*.3)}),t=Date.now(),d=S.name.replace(/[^a-zA-Z0-9.-]/g,"_"),i=`receipts/${C}/${t}_${d}`,p=Mt(Tt,i),y=gr(p,e);return new Promise((n,o)=>{y.on("state_changed",r=>{const s=r.bytesTransferred/r.totalBytes*70+30;U&&U(s)},r=>{console.error("Upload error:",r),o(new Error("Failed to upload image"))},async()=>{try{const r=await mr(y.snapshot.ref);U&&U(100),n({url:r,path:i})}catch(r){console.error("Error getting download URL:",r),o(new Error("Failed to get download URL"))}})})}catch(f){throw console.error("uploadReceiptImage error:",f),f}},ft="receipts",mn=async(S,C,U,f=null)=>{try{const{url:e,path:t}=await gn(S,C,U),d=rn(C,e,t),i=nn(d);if(!i.valid)throw new Error(`Validation error: ${i.errors.join(", ")}`);return(await _t(Pt(je,ft),{...d,householdId:f||null,createdAt:Ve(),updatedAt:Ve()})).id}catch(e){throw console.error("createReceipt error:",e),e}},xn=async S=>{try{const C=Oe(je,ft,S),U=await xr(C);if(!U.exists())throw new Error("Receipt not found");return{id:U.id,...U.data()}}catch(C){throw console.error("getReceipt error:",C),C}},yn=async S=>{try{const C=Oe(je,ft,S);await nt(C,{"metadata.analysisStatus":"pending","metadata.processingError":null,"metadata.technicalError":null,"metadata.retryable":null,"metadata.retryCount":Ve(),updatedAt:Ve()});const U=await xn(S);await Ot(C),await _t(Pt(je,ft),{...U,id:void 0,metadata:{...U.metadata,analysisStatus:"pending",processingError:null,technicalError:null,retryable:null},updatedAt:Ve()})}catch(C){throw console.error("retryReceiptAnalysis error:",C),C}};function bn({receipt:S,onClick:C,onRetry:U}){const{storeInfo:f,summary:e,metadata:t,imageUrl:d}=S,i=S.id?S.id.charCodeAt(0)%Ct.length:0,p=Ct[i],n=(s=>{switch(s){case"completed":return{label:" Analyzed",color:"success",icon:m.jsx(kr,{sx:{fontSize:16}})};case"processing":return{label:" Processing",color:"warning",icon:m.jsx(Dt,{sx:{fontSize:16}})};case"failed_retryable":return{label:" Try Again",color:"warning",icon:m.jsx(kt,{sx:{fontSize:16}})};case"failed":return{label:" Failed",color:"error",icon:m.jsx(kt,{sx:{fontSize:16}})};default:return{label:" Pending",color:"default",icon:m.jsx(Dt,{sx:{fontSize:16}})}}})(t?.analysisStatus),o=t?.analysisStatus==="failed_retryable"||t?.retryable,r=s=>{s.stopPropagation(),U&&U(S.id)};return m.jsxs(Bt,{onClick:C,sx:{cursor:"pointer",height:"100%",display:"flex",flexDirection:"column",bgcolor:p.bg,borderRadius:"12px",border:`2px solid ${p.border}`,boxShadow:`3px 3px 0px ${p.shadow}`},children:[m.jsx(Xr,{component:"img",height:"200",image:d,alt:f?.name||"Receipt",sx:{objectFit:"cover",backgroundColor:"grey.100"}}),m.jsxs(Qt,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[m.jsx(V,{sx:{mb:2},children:m.jsx(Gt,{label:n.label,color:t?.analysisStatus==="completed"?void 0:n.color,size:"small",sx:{fontWeight:600,fontFamily:"Outfit, sans-serif",borderRadius:"8px",fontSize:"12px",...t?.analysisStatus==="completed"&&{bgcolor:G.main,color:"white","& .MuiChip-icon":{color:"white"}}}})}),m.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:.75,mb:1},children:[m.jsx($t,{sx:{fontSize:"20px",color:p.border}}),m.jsx(Y,{variant:"h6",component:"h3",noWrap:!0,sx:{fontWeight:600,fontFamily:"Outfit, sans-serif",color:p.border,fontSize:"18px"},children:f?.name||"Unknown Store"})]}),m.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:.75,mb:1},children:[m.jsx(Kt,{sx:{fontSize:"16px",color:"text.secondary"}}),m.jsx(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",color:"text.secondary",fontWeight:500,fontSize:"13px"},children:f?.date?Nt(f.date):"No date"})]}),m.jsx(Y,{variant:"body2",sx:{mb:2,fontFamily:"Outfit, sans-serif",color:"text.secondary",minHeight:"18px",fontWeight:400,fontSize:"13px"},children:f?.location||""}),m.jsx(V,{sx:{flexGrow:1}}),e?.total!==void 0&&m.jsxs(V,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pt:2,borderTop:`2px solid ${p.border}`},children:[m.jsx(Lt,{sx:{fontSize:"24px",color:p.border}}),m.jsx(Y,{variant:"h5",sx:{fontWeight:700,fontFamily:"Outfit, sans-serif",color:p.border,fontSize:"22px"},children:qe(e.total)})]}),(t?.analysisStatus==="failed"||t?.analysisStatus==="failed_retryable")&&t?.processingError&&m.jsxs(V,{sx:{mt:2},children:[m.jsx(Y,{variant:"body2",color:"error",sx:{mb:1,fontFamily:"Outfit, sans-serif",fontWeight:600},children:t.processingError}),o&&U&&m.jsx(we,{size:"small",variant:"contained",startIcon:m.jsx(Rr,{}),onClick:r,sx:{mt:1,fontFamily:"Outfit, sans-serif",fontWeight:700,textTransform:"none",borderRadius:"12px",bgcolor:p.border,border:`2px solid ${p.shadow}`,"&:hover":{bgcolor:p.shadow}},children:"Retry Analysis"})]})]})]})}function vn(){return m.jsxs(Bt,{sx:{borderRadius:"24px",border:`4px solid ${_e.border}`},children:[m.jsx(Le,{variant:"rectangular",height:200}),m.jsxs(Qt,{children:[m.jsx(Le,{variant:"rounded",width:100,height:24,sx:{mb:2,borderRadius:"12px"}}),m.jsx(Le,{variant:"text",width:"80%",height:32,sx:{mb:1}}),m.jsx(Le,{variant:"text",width:"60%",height:20,sx:{mb:1}}),m.jsx(Le,{variant:"text",width:"70%",height:20,sx:{mb:2}}),m.jsx(Le,{variant:"text",width:"40%",height:36})]})]})}function wn({receipt:S,open:C,onClose:U}){const[f,e]=te.useState(!1),[t,d]=te.useState(!1),[i,p]=te.useState({open:!1,message:"",severity:"success"}),[y,n]=te.useState(!1),[o,r]=te.useState(null),[s,h]=te.useState(""),[j,k]=te.useState(!1),[b,P]=te.useState(S);if(te.useEffect(()=>{if(!S?.id)return;const l=yr(Oe(je,"receipts",S.id),a=>{a.exists()&&P({id:a.id,...a.data()})},a=>{console.error("Error listening to receipt updates:",a)});return()=>l()},[S?.id]),te.useEffect(()=>{S&&P(S)},[S]),!b)return null;const{storeInfo:D,items:R=[],summary:_,metadata:g,imageUrl:z}=b,c=["produce","meat","dairy","bakery","frozen","pantry","beverages","snacks","household","personal care","health","other"],u=R.map((l,a)=>({...l,originalIndex:a})).sort((l,a)=>{const T=l.category?.toLowerCase()||"other",F=a.category?.toLowerCase()||"other",O=c.indexOf(T),N=c.indexOf(F),$=O===-1?c.length:O,B=N===-1?c.length:N;return $-B}),v=async()=>{d(!0);try{if(await Ot(Oe(je,"receipts",b.id)),b.imagePath){const l=Mt(Tt,b.imagePath);await br(l)}p({open:!0,message:"Receipt deleted successfully!",severity:"success"}),e(!1),setTimeout(()=>{U()},500)}catch(l){console.error("Error deleting receipt:",l),p({open:!0,message:"Failed to delete receipt. Please try again.",severity:"error"})}finally{d(!1)}},A=()=>{p({...i,open:!1})},w=(l,a)=>{r(l),h(a),n(!0)},I=async()=>{if(!(o===null||!s.trim())){k(!0);try{const l=await Dr(s.trim()),a=[...R];a[o]={...a[o],name:s.trim(),category:l},await nt(Oe(je,"receipts",b.id),{items:a}),p({open:!0,message:"Item updated and recategorized successfully",severity:"success"}),n(!1),r(null),h("")}catch(l){console.error("Error updating item name:",l),p({open:!0,message:"Failed to update item",severity:"error"})}finally{k(!1)}}},x=()=>{n(!1),r(null),h("")},E=l=>{const a={produce:{icon:Nr,color:G.main,bg:G.bg},meat:{icon:$r,color:Ge.main,bg:Ge.bg},dairy:{icon:Hr,color:at.main,bg:at.bg},bakery:{icon:Wr,color:We.main,bg:We.bg},frozen:{icon:Lr,color:It.main,bg:It.bg},pantry:{icon:Pr,color:jt.main,bg:jt.bg},beverages:{icon:_r,color:ot.main,bg:ot.bg},snacks:{icon:Or,color:St.main,bg:St.bg},household:{icon:Tr,color:pe.main,bg:pe.bg},"personal care":{icon:tn,color:pe.main,bg:pe.bg},health:{icon:en,color:G.main,bg:G.bg},grocery:{icon:vr,color:G.main,bg:G.bg},other:{icon:Jr,color:pe.main,bg:pe.bg}};return a[l?.toLowerCase()]||a.other};return m.jsxs(Je,{open:C,onClose:U,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"16px",border:`2px solid ${G.main}`,boxShadow:`4px 4px 0px ${G.light}`}},children:[m.jsx(et,{sx:{pb:1},children:m.jsxs(V,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[m.jsx(Y,{variant:"h5",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,color:G.main,fontSize:"24px"},children:"Receipt Details"}),m.jsxs(V,{sx:{display:"flex",gap:1},children:[m.jsx(Xe,{onClick:()=>e(!0),size:"small",sx:{color:Ge.dark,border:`2px solid ${Ge.dark}`,"&:hover":{bgcolor:Ge.light}},children:m.jsx(Rt,{fontSize:"small"})}),m.jsx(Xe,{onClick:U,size:"small",sx:{border:`2px solid ${$e.light}`,"&:hover":{bgcolor:_e.borderLight}},children:m.jsx(zr,{fontSize:"small"})})]})]})}),m.jsxs(tt,{children:[m.jsxs(V,{sx:{display:"flex",gap:2,mb:3,flexDirection:{xs:"column",sm:"row"}},children:[m.jsx(V,{component:"img",src:z,alt:"Receipt",sx:{width:{xs:"100%",sm:"50%"},maxHeight:300,objectFit:"contain",borderRadius:"10px",backgroundColor:"grey.100",border:`2px solid ${_e.border}`}}),m.jsx(Me,{elevation:0,sx:{flex:1,p:2.5,bgcolor:G.bg,borderRadius:"12px",border:`2px solid ${G.main}`,boxShadow:`2px 2px 0px ${G.light}`,display:"flex",flexDirection:"column",justifyContent:"center"},children:m.jsxs(Ut,{spacing:1.5,children:[D?.name&&m.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1},children:[m.jsx($t,{sx:{fontSize:"20px",color:G.main}}),m.jsx(Y,{variant:"h6",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,color:G.dark,fontSize:"18px"},children:D.name})]}),D?.location&&m.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1},children:[m.jsx(Ur,{sx:{fontSize:"16px",color:G.main}}),m.jsx(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontWeight:500,color:G.dark,fontSize:"13px"},children:D.location})]}),D?.date&&m.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1},children:[m.jsx(Kt,{sx:{fontSize:"16px",color:G.main}}),m.jsx(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontWeight:500,color:G.dark,fontSize:"13px"},children:Nt(D.date)})]})]})})]}),R.length>0?m.jsxs(m.Fragment,{children:[m.jsxs(Y,{variant:"h6",sx:{mb:2,fontFamily:"Outfit, sans-serif",fontWeight:600,color:G.main,fontSize:"18px"},children:["Items (",R.length,")"]}),m.jsx(Me,{elevation:0,sx:{mb:3,borderRadius:"12px",border:`2px solid ${We.main}`,boxShadow:`2px 2px 0px ${We.light}`,p:2},children:(()=>{const l={};return u.forEach(a=>{const T=a.category||"other";l[T]||(l[T]=[]),l[T].push(a)}),Object.entries(l).map(([a,T],F)=>{const O=E(a);return m.jsxs(V,{children:[F>0&&m.jsx(yt,{sx:{my:1.5,borderStyle:"dashed",borderColor:_e.border}}),m.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:.5,mb:1,bgcolor:O.bg,px:1,py:.5,borderRadius:"6px"},children:[m.jsx(O.icon,{sx:{fontSize:"14px",color:O.color}}),m.jsx(Y,{variant:"caption",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,fontSize:"11px",color:O.color,textTransform:"uppercase",letterSpacing:"0.5px"},children:a})]}),T.map(N=>m.jsxs(V,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:.75,px:.5,"&:hover":{bgcolor:pe.bg}},children:[m.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[m.jsxs(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontWeight:500,fontSize:"12px",color:$e.dark,flex:1},children:[N.quantity>1&&m.jsxs(V,{component:"span",sx:{color:pe.main,fontSize:"11px",mr:.5},children:[N.quantity,"x"]}),N.name]}),m.jsx(Xe,{size:"small",onClick:()=>w(N.originalIndex,N.name),sx:{padding:.25,color:"text.secondary","&:hover":{color:G.main,bgcolor:G.bg}},children:m.jsx(qt,{sx:{fontSize:14}})})]}),m.jsx(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,fontSize:"12px",color:$e.darker,minWidth:"60px",textAlign:"right"},children:qe(N.totalPrice)})]},N.originalIndex))]},a)})})()})]}):m.jsx(Y,{variant:"body2",color:"text.secondary",sx:{mb:3,textAlign:"center",py:3},children:"No items extracted yet"}),_&&m.jsxs(Me,{elevation:0,sx:{p:2.5,bgcolor:G.bg,borderRadius:"12px",border:`2px solid ${G.main}`,boxShadow:`2px 2px 0px ${G.light}`},children:[m.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[m.jsx(Lt,{sx:{color:G.dark,fontSize:"24px"}}),m.jsx(Y,{variant:"h6",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,color:G.dark,fontSize:"18px"},children:"Summary"})]}),m.jsxs(Ut,{spacing:1,children:[m.jsxs(V,{sx:{display:"flex",justifyContent:"space-between"},children:[m.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",fontWeight:500,fontSize:"14px"},children:"Subtotal:"}),m.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",fontWeight:500,fontSize:"14px"},children:qe(_.subtotal)})]}),m.jsxs(V,{sx:{display:"flex",justifyContent:"space-between"},children:[m.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",fontWeight:500,fontSize:"14px"},children:"Tax:"}),m.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",fontWeight:500,fontSize:"14px"},children:qe(_.tax)})]}),m.jsx(yt,{sx:{my:1,borderColor:G.light}}),m.jsxs(V,{sx:{display:"flex",justifyContent:"space-between"},children:[m.jsx(Y,{variant:"h6",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,color:G.dark,fontSize:"18px"},children:"Total:"}),m.jsx(Y,{variant:"h6",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,color:G.dark,fontSize:"18px"},children:qe(_.total)})]})]})]}),g?.analysisStatus&&m.jsx(V,{sx:{mt:2,textAlign:"center"},children:m.jsxs(Y,{variant:"caption",color:"text.secondary",children:["Status: ",g.analysisStatus,g.geminiFeedback&&`  Confidence: ${g.geminiFeedback}`]})})]}),m.jsxs(Je,{open:f,onClose:()=>!t&&e(!1),maxWidth:"xs",fullWidth:!0,children:[m.jsx(et,{children:"Delete Receipt?"}),m.jsx(tt,{children:m.jsx(Y,{children:"Are you sure you want to delete this receipt? This will permanently remove the receipt data and image. This action cannot be undone."})}),m.jsxs(xt,{children:[m.jsx(we,{onClick:()=>e(!1),disabled:t,children:"Cancel"}),m.jsx(we,{onClick:v,color:"error",variant:"contained",disabled:t,startIcon:t?null:m.jsx(Rt,{}),children:t?"Deleting...":"Delete"})]})]}),m.jsxs(Je,{open:y,onClose:x,maxWidth:"sm",fullWidth:!0,children:[m.jsx(et,{children:"Edit Item Name"}),m.jsx(tt,{children:m.jsx(V,{sx:{pt:1},children:m.jsx(Vt,{autoFocus:!0,fullWidth:!0,label:"Item Name",value:s,onChange:l=>h(l.target.value),onKeyPress:l=>{l.key==="Enter"&&I()},helperText:"Update the product name - will automatically recategorize with AI",disabled:j})})}),m.jsxs(xt,{children:[m.jsx(we,{onClick:x,disabled:j,children:"Cancel"}),m.jsx(we,{onClick:I,variant:"contained",disabled:!s.trim()||j,children:j?"Saving...":"Save"})]})]}),m.jsx(Wt,{open:i.open,autoHideDuration:4e3,onClose:A,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:m.jsx(Ht,{onClose:A,severity:i.severity,sx:{width:"100%"},children:i.message})})]})}function Qn(){const{currentUser:S}=wr(),{receipts:C,loading:U}=Ar(),[f,e]=te.useState(null),[t,d]=te.useState(!1),[i,p]=te.useState(0),[y,n]=te.useState(""),[o,r]=te.useState({dateRange:"all",category:"all"}),[s,h]=te.useState("date-desc"),[j,k]=te.useState("name-asc"),[b,P]=te.useState(!1),[D,R]=te.useState(null),[_,g]=te.useState(""),[z,c]=te.useState({open:!1,message:"",severity:"success"}),[u,v]=te.useState(!1),[A,w]=te.useState(0),I=te.useRef(null),x=te.useRef(null),E=te.useRef(new Set);te.useEffect(()=>{!S||!C.length||C.forEach(async W=>{if(W.items&&W.items.length>0&&W.metadata?.analysisStatus==="completed"&&!W.metadata?.addedToPantry&&!E.current.has(W.id)){E.current.add(W.id);try{const L=await Er(S.uid,W.id,W.items,W.storeInfo?.name);await nt(Oe(je,"receipts",W.id),{"metadata.addedToPantry":!0,"metadata.pantryItemsAdded":L}),L>0&&c({open:!0,message:`Added ${L} item${L!==1?"s":""} to pantry!`,severity:"success"})}catch(L){console.error("Error adding items to pantry:",L)}}})},[C,S]);const l=W=>{e(W),d(!0)},a=async W=>{try{await yn(W),c({open:!0,message:"Retrying analysis... Please wait a moment.",severity:"info"})}catch(L){console.error("Retry error:",L),c({open:!0,message:"Failed to retry. Please try again.",severity:"error"})}},T=async W=>{if(!S){c({open:!0,message:"You must be logged in to upload receipts",severity:"error"});return}try{v(!0),w(0),await mn(W,S.uid,L=>{w(L)}),c({open:!0,message:"Receipt uploaded successfully! Analyzing...",severity:"success"})}catch(L){console.error("Upload error:",L),c({open:!0,message:L.message||"Failed to upload receipt",severity:"error"})}finally{v(!1),w(0)}},F=W=>{const L=W.target.files?.[0];L&&T(L)},O=()=>{I.current?.click()},N=()=>{x.current?.click()},$=()=>{c({...z,open:!1})},B=()=>{d(!1),e(null)},H=(W,L)=>{p(L),n("")},M=te.useMemo(()=>{const W=[];return C.forEach(L=>{L.items&&Array.isArray(L.items)&&L.items.forEach((Q,X)=>{W.push({...Q,itemId:`${L.id}-${X}`,receiptId:L.id,receiptStore:L.storeInfo?.name||"Unknown Store",receiptDate:L.storeInfo?.date,receiptLocation:L.storeInfo?.location})})}),W},[C]),q=te.useMemo(()=>{let W=[...C];if(y){const L=y.toLowerCase();W=W.filter(Q=>{const X=Q.storeInfo?.name?.toLowerCase()||"",Z=Q.storeInfo?.location?.toLowerCase()||"",se=Q.items?.map(ae=>ae.name?.toLowerCase()).join(" ")||"",ee=Q.items?.map(ae=>ae.receiptText?.toLowerCase()).join(" ")||"",K=Q.items?.flatMap(ae=>ae.keywords||[]).map(ae=>ae.toLowerCase()).join(" ")||"";return X.includes(L)||Z.includes(L)||se.includes(L)||ee.includes(L)||K.includes(L)})}if(o.dateRange!=="all"){const L=new Date,Q=new Date;switch(o.dateRange){case"today":Q.setHours(0,0,0,0);break;case"7days":Q.setDate(L.getDate()-7);break;case"30days":Q.setDate(L.getDate()-30);break;case"90days":Q.setDate(L.getDate()-90);break}W=W.filter(X=>(X.createdAt?.toDate()||new Date(0))>=Q)}return o.category!=="all"&&(W=W.filter(L=>L.items?.some(Q=>Q.category===o.category))),W.sort((L,Q)=>{switch(s){case"date-desc":return(Q.createdAt?.toDate()||new Date(0))-(L.createdAt?.toDate()||new Date(0));case"date-asc":return(L.createdAt?.toDate()||new Date(0))-(Q.createdAt?.toDate()||new Date(0));case"amount-desc":return(Q.summary?.total||0)-(L.summary?.total||0);case"amount-asc":return(L.summary?.total||0)-(Q.summary?.total||0);case"store-asc":return(L.storeInfo?.name||"").localeCompare(Q.storeInfo?.name||"");default:return 0}}),W},[C,y,o,s]),re=te.useMemo(()=>{let W=[...M];if(y.trim()){const L=y.toLowerCase().trim();W=W.filter(Q=>!!(Q.name?.toLowerCase().includes(L)||Q.receiptText?.toLowerCase().includes(L)||Q.keywords&&Array.isArray(Q.keywords)&&Q.keywords.some(X=>X.toLowerCase().includes(L))||Q.category?.toLowerCase().includes(L)||Q.receiptStore?.toLowerCase().includes(L)||Q.receiptLocation?.toLowerCase().includes(L)))}if(o.dateRange!=="all"){const L=new Date,Q=new Date;switch(o.dateRange){case"today":Q.setHours(0,0,0,0);break;case"7days":Q.setDate(L.getDate()-7);break;case"30days":Q.setDate(L.getDate()-30);break;case"90days":Q.setDate(L.getDate()-90);break}W=W.filter(X=>X.receiptDate?X.receiptDate.toDate()>=Q:!1)}switch(o.category!=="all"&&(W=W.filter(L=>L.category===o.category)),j){case"name-asc":W.sort((L,Q)=>(L.name||"").localeCompare(Q.name||""));break;case"name-desc":W.sort((L,Q)=>(Q.name||"").localeCompare(L.name||""));break;case"store-asc":W.sort((L,Q)=>(L.receiptStore||"").localeCompare(Q.receiptStore||""));break;case"store-desc":W.sort((L,Q)=>(Q.receiptStore||"").localeCompare(L.receiptStore||""));break;case"amount-asc":W.sort((L,Q)=>(L.totalPrice||0)-(Q.totalPrice||0));break;case"amount-desc":W.sort((L,Q)=>(Q.totalPrice||0)-(L.totalPrice||0));break}return W},[M,y,o,j]),ne=W=>{R(W),g(W.name),P(!0)},J=async()=>{if(!(!D||!_.trim()))try{const W=Oe(je,"receipts",D.receiptId),L=C.find(Z=>Z.id===D.receiptId);if(!L)throw new Error("Receipt not found");const Q=L.items.findIndex((Z,se)=>`${D.receiptId}-${se}`===D.itemId);if(Q===-1)throw new Error("Item not found in receipt");const X=[...L.items];X[Q]={...X[Q],name:_.trim()},await nt(W,{items:X}),c({open:!0,message:"Item name updated successfully",severity:"success"}),P(!1),R(null),g("")}catch(W){console.error("Error updating item name:",W),c({open:!0,message:"Failed to update item name",severity:"error"})}},oe=()=>{P(!1),R(null),g("")};return m.jsx(V,{sx:{background:`linear-gradient(180deg, ${G.bg} 0%, ${Re} 100%)`,minHeight:"100vh",pb:4},children:m.jsxs(Cr,{maxWidth:"lg",children:[m.jsxs(V,{sx:{pt:4,pb:3},children:[m.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:2,mb:1,flexWrap:"wrap"},children:[m.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[i===0?m.jsx(gt,{sx:{fontSize:{xs:28,md:34},color:G.main}}):m.jsx(Et,{sx:{fontSize:{xs:28,md:34},color:G.main}}),m.jsx(Y,{variant:"h3",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,color:G.main,fontSize:{xs:"28px",md:"34px"}},children:i===0?"Receipts":"All Items"})]}),i===0&&m.jsxs(V,{sx:{display:"flex",gap:1.5},children:[m.jsx(we,{variant:"outlined",startIcon:u?m.jsx(pt,{size:16}):m.jsx(Br,{}),onClick:N,disabled:u,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:G.main,borderColor:G.main,px:2,"&:hover":{borderColor:G.darker,bgcolor:G.bg}},children:"Photo"}),m.jsx(we,{variant:"outlined",startIcon:u?m.jsx(pt,{size:16}):m.jsx(Qr,{}),onClick:O,disabled:u,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:G.main,borderColor:G.main,px:2,"&:hover":{borderColor:G.darker,bgcolor:G.bg}},children:"Upload"})]})]}),m.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",color:Ze.main,fontWeight:400},children:i===0?C.length>0?`${q.length} of ${C.length} receipt${C.length===1?"":"s"}`:"Upload your first receipt to get started!":`${re.length} total item${re.length!==1?"s":""}`}),u&&m.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1,mt:2},children:[m.jsx(pt,{size:20,sx:{color:G.main}}),m.jsx(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",color:G.dark,fontSize:"13px"},children:"Analyzing receipt..."})]})]}),m.jsx("input",{ref:I,type:"file",accept:"image/*",style:{display:"none"},onChange:F}),m.jsx("input",{ref:x,type:"file",accept:"image/*",capture:"environment",style:{display:"none"},onChange:F}),!U&&C.length>0&&m.jsxs(V,{sx:{mb:3,display:"flex",gap:1},children:[m.jsx(we,{onClick:W=>H(W,0),sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,fontSize:"13px",px:2,py:.75,borderRadius:"8px",textTransform:"none",color:i===0?Re:G.main,bgcolor:i===0?G.main:Re,border:"1px solid",borderColor:i===0?G.main:_e.border,minWidth:"auto",transition:"all 0.15s ease","&:hover":{bgcolor:i===0?G.darker:pe.bg,borderColor:i===0?G.darker:pe.light}},startIcon:m.jsx(gt,{fontSize:"small"}),children:"Receipts"}),m.jsx(we,{onClick:W=>H(W,1),sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,fontSize:"13px",px:2,py:.75,borderRadius:"8px",textTransform:"none",color:i===1?Re:G.main,bgcolor:i===1?G.main:Re,border:"1px solid",borderColor:i===1?G.main:_e.border,minWidth:"auto",transition:"all 0.15s ease","&:hover":{bgcolor:i===1?G.darker:pe.bg,borderColor:i===1?G.darker:pe.light}},startIcon:m.jsx(Et,{fontSize:"small"}),children:"Items"})]}),!U&&C.length>0&&m.jsx(Mr,{onSearchChange:n,onFilterChange:r,onSortChange:i===0?h:k,hideSortDropdown:i===1}),U&&m.jsx(Ye,{container:!0,spacing:3,children:[1,2,3,4,5,6].map(W=>m.jsx(Ye,{item:!0,xs:12,sm:6,md:4,children:m.jsx(vn,{})},W))}),!U&&C.length===0&&m.jsxs(Me,{elevation:0,sx:{p:8,textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",gap:2,bgcolor:Re,borderRadius:"24px",border:`4px solid ${at.bg}`,boxShadow:`6px 6px 0px ${at.bg}`},children:[m.jsx(gt,{sx:{fontSize:"80px",mb:1,color:G.light}}),m.jsx(Y,{variant:"h5",sx:{fontFamily:"Outfit, sans-serif",fontWeight:800,color:G.main},children:"No Receipts Yet!"}),m.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",color:Ze.main,maxWidth:400},children:"Upload your first receipt to start tracking your grocery spending"})]}),!U&&C.length>0&&i===0&&m.jsxs(m.Fragment,{children:[q.length===0&&m.jsxs(Me,{elevation:0,sx:{p:8,textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",gap:2,bgcolor:Re,borderRadius:"24px",border:`4px solid ${ot.bg}`,boxShadow:`6px 6px 0px ${ot.bg}`},children:[m.jsx(V,{sx:{fontSize:"80px",mb:1},children:""}),m.jsx(Y,{variant:"h5",sx:{fontFamily:"Outfit, sans-serif",fontWeight:800,color:G.main},children:"No Receipts Found"}),m.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",color:Ze.main},children:"Try adjusting your search or filters"})]}),q.length>0&&m.jsx(Ye,{container:!0,spacing:3,children:q.map(W=>m.jsx(Ye,{item:!0,xs:12,sm:6,md:4,children:m.jsx(bn,{receipt:W,onClick:()=>l(W),onRetry:a})},W.id))})]}),!U&&C.length>0&&i===1&&m.jsxs(m.Fragment,{children:[re.length===0&&(y||o.category!=="all"||o.dateRange!=="all")&&m.jsxs(Me,{elevation:0,sx:{p:6,textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",gap:2,bgcolor:Re,borderRadius:"24px",border:`4px solid ${G.light}`,boxShadow:`6px 6px 0px ${G.light}`},children:[m.jsx(V,{sx:{fontSize:"64px",mb:1},children:""}),m.jsx(Y,{variant:"h6",sx:{fontFamily:"Outfit, sans-serif",fontWeight:800,color:G.main},children:"No Items Found"}),m.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",color:Ze.main},children:"Try adjusting your search or filters"})]}),re.length>0&&m.jsx(Me,{elevation:0,sx:{borderRadius:"16px",border:`3px solid ${We.main}`,boxShadow:`3px 3px 0px ${We.light}`,p:2.5},children:(()=>{const W=["produce","meat","dairy","bakery","frozen","pantry","beverages","snacks","household","personal care","health","other"],L=[...re].sort((X,Z)=>{const se=X.category?.toLowerCase()||"other",ee=Z.category?.toLowerCase()||"other",K=W.indexOf(se),ae=W.indexOf(ee),fe=K===-1?W.length:K,le=ae===-1?W.length:ae;return fe-le}),Q={};return L.forEach(X=>{const Z=X.category||"other";Q[Z]||(Q[Z]=[]),Q[Z].push(X)}),Object.entries(Q).map(([X,Z],se)=>{const ee=Sr(X);return m.jsxs(V,{children:[se>0&&m.jsx(yt,{sx:{my:2,borderStyle:"dashed",borderColor:_e.border}}),m.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1,mb:1.5,bgcolor:ee.bg,px:1.5,py:.75,borderRadius:"8px"},children:[m.jsxs(Y,{variant:"subtitle2",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,fontSize:"13px",color:ee.color,textTransform:"uppercase",letterSpacing:"0.5px"},children:[ee.emoji," ",X]}),m.jsx(Gt,{label:`${Z.length} item${Z.length!==1?"s":""}`,size:"small",sx:{height:"20px",fontSize:"11px",fontFamily:"Outfit, sans-serif",bgcolor:ee.color,color:"#fff",fontWeight:600}})]}),Z.map(K=>m.jsxs(V,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:1,px:1,borderRadius:"8px","&:hover":{bgcolor:pe.bg}},children:[m.jsxs(V,{sx:{display:"flex",flexDirection:"column",gap:.5,flex:1},children:[m.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:.5},children:[m.jsxs(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,fontSize:"13px",color:$e.darker},children:[K.quantity>1&&m.jsxs(V,{component:"span",sx:{color:pe.main,fontSize:"12px",mr:.5},children:[K.quantity,"x"]}),K.name]}),m.jsx(Xe,{size:"small",onClick:()=>ne(K),sx:{padding:.25,color:"text.secondary","&:hover":{color:G.main,bgcolor:G.bg}},children:m.jsx(qt,{sx:{fontSize:14}})})]}),m.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1},children:[m.jsx(Y,{variant:"caption",sx:{fontFamily:"Outfit, sans-serif",fontSize:"11px",color:G.main,fontWeight:600},children:K.receiptStore}),K.receiptDate&&m.jsx(Y,{variant:"caption",sx:{fontFamily:"Outfit, sans-serif",fontSize:"11px",color:$e.light},children:Gr(K.receiptDate.toDate(),"MMM d, yyyy")})]})]}),m.jsxs(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,fontSize:"13px",color:$e.darker,minWidth:"70px",textAlign:"right"},children:["$",(K.totalPrice||0).toFixed(2)]})]},K.itemId))]},X)})})()})]}),m.jsx(wn,{receipt:f,open:t,onClose:B}),m.jsxs(Je,{open:b,onClose:oe,maxWidth:"sm",fullWidth:!0,children:[m.jsx(et,{children:"Edit Item Name"}),m.jsx(tt,{children:m.jsx(V,{sx:{pt:1},children:m.jsx(Vt,{autoFocus:!0,fullWidth:!0,label:"Item Name",value:_,onChange:W=>g(W.target.value),onKeyPress:W=>{W.key==="Enter"&&J()},helperText:"Update the product name (e.g., 'Tillamook Ice Cream' instead of 'Tillamook Cheese')"})})}),m.jsxs(xt,{children:[m.jsx(we,{onClick:oe,children:"Cancel"}),m.jsx(we,{onClick:J,variant:"contained",disabled:!_.trim(),children:"Save"})]})]}),m.jsx(Wt,{open:z.open,autoHideDuration:4e3,onClose:$,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:m.jsx(Ht,{onClose:$,severity:z.severity,sx:{width:"100%"},children:z.message})})]})})}export{Qn as default};
