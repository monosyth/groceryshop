import{d as Re,j as e,Q as Pe,r as l,af as Te,ag as We,q as G,z as Ue,B as s,w as r,U as F,V as ne,W as h,ay as O,T as m,x,E as p,F as y,D as M,at as Be,X as H,C as u,N as z,M as ie,L as le,K as ce,J as de,I as xe,S as Ne,G as Le,l as f,p as me,n as Ge,o as Me,k as R,m as K,y as He}from"./index-DXmyYrXK.js";import{c as q,a as Ke}from"./geminiService-CitDXh9M.js";import{b as qe}from"./pantryService-BKnB9OfB.js";import{C as Y,a as pe}from"./CardContent-6HittqKH.js";import{T as ge}from"./TextField-a07EZWx1.js";import{A as Ye}from"./Add-QqI-DAfC.js";import{C as ue,U as Je}from"./Upload-ClP8zliP.js";import{G as fe}from"./Grid-CaLYXV8M.js";import{C as Qe}from"./Chip-C2TkmNu1.js";import{E as he}from"./Edit-_jehEjjs.js";import{D as Xe}from"./Delete-Ch4Y1qzR.js";import{D as ye,a as be,b as je,c as ve}from"./DialogTitle-DpdWYvWj.js";import{G as Ze,S as _e,E as Ve,B as et,A as tt,L as rt,F as st,C as at,I as ot}from"./SetMeal-9OAHgmJI.js";import{R as nt}from"./Receipt-DeHEZvNy.js";import"./useFormControl-D4NiSBq1.js";const it=Re(e.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}));function Ct(){const{currentUser:b}=Pe(),[g,Ie]=l.useState([]),[Se,J]=l.useState(!0),[C,Q]=l.useState(""),[P,X]=l.useState(!1),[j,T]=l.useState(!1),[W,Z]=l.useState(!1),[k,i]=l.useState({open:!1,message:"",severity:"info"}),[ze,U]=l.useState(!1),[w,B]=l.useState(null),[v,D]=l.useState(""),[I,_]=l.useState(!1),[Ce,E]=l.useState(!1),[$,V]=l.useState(null),[A,N]=l.useState([]),ee=l.useRef(null),te=l.useRef(null),ke=[{value:"produce",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ze,{sx:{fontSize:16,color:r.main}})," Produce"]}),color:r.main},{value:"meat",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(_e,{sx:{fontSize:16,color:u.main}})," Meat & Seafood"]}),color:u.main},{value:"dairy",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ve,{sx:{fontSize:16,color:z.main}})," Dairy & Eggs"]}),color:z.main},{value:"bakery",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(et,{sx:{fontSize:16,color:p.main}})," Bakery"]}),color:p.main},{value:"frozen",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(tt,{sx:{fontSize:16,color:ie.main}})," Frozen"]}),color:ie.main},{value:"pantry",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(O,{sx:{fontSize:16,color:le.main}})," Pantry"]}),color:le.main},{value:"beverages",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(rt,{sx:{fontSize:16,color:ce.main}})," Beverages"]}),color:ce.main},{value:"snacks",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(st,{sx:{fontSize:16,color:de.main}})," Snacks"]}),color:de.main},{value:"household",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(at,{sx:{fontSize:16,color:y.main}})," Household"]}),color:y.main},{value:"other",label:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(ot,{sx:{fontSize:16,color:y.main}})," Other"]}),color:y.main}];l.useEffect(()=>{if(!b)return;const t=Te(G(f,"pantry"),We("userId","==",b.uid)),o=Ue(t,a=>{const n=[];a.forEach(c=>{n.push({id:c.id,...c.data()})}),n.sort((c,d)=>{const S=c.createdAt?.toDate()||new Date(0);return(d.createdAt?.toDate()||new Date(0))-S}),Ie(n),J(!1)},a=>{console.error("Error fetching pantry:",a),J(!1)});return()=>o()},[b]);const re=async()=>{if(!C.trim()){i({open:!0,message:"Please enter an item name",severity:"warning"});return}X(!0);try{const t=await q(C.trim());await me(G(f,"pantry"),{userId:b.uid,name:C.trim().toLowerCase(),category:t,source:"manual",createdAt:Ge()}),Q(""),i({open:!0,message:"Item added to pantry!",severity:"success"})}catch(t){console.error("Error adding item:",t),i({open:!0,message:"Failed to add item",severity:"error"})}finally{X(!1)}},se=async t=>{const o=t.target.files?.[0];if(o){T(!0);try{const a=new FileReader;a.onload=async n=>{const c=n.target.result.split(",")[1];try{const d=await Ke(c);if(d.length>0)try{const S=await qe(b.uid,d);i({open:!0,message:`Found ${d.length} ingredient${d.length!==1?"s":""} and added ${S} to pantry!`,severity:"success"})}catch(S){console.error("Error adding to pantry:",S),i({open:!0,message:`Found ${d.length} ingredient${d.length!==1?"s":""}, but couldn't add to pantry`,severity:"warning"})}else i({open:!0,message:"No ingredients found in photo",severity:"info"})}catch(d){console.error("Error analyzing photo:",d),i({open:!0,message:d.message.includes("API")?"Please add your Gemini API key to use this feature":"Failed to analyze photo. Please try again.",severity:"error"})}finally{T(!1)}},a.readAsDataURL(o)}catch(a){console.error("Error reading file:",a),T(!1),i({open:!0,message:"Failed to read image file",severity:"error"})}}},we=t=>{V(t),E(!0)},De=async()=>{if($)try{const t={type:"delete",item:{...$},timestamp:Date.now()};N(o=>[t,...o].slice(0,30)),await Me(R(f,"pantry",$.id)),i({open:!0,message:"Item removed from pantry",severity:"success"})}catch(t){console.error("Error deleting item:",t),i({open:!0,message:"Failed to delete item",severity:"error"})}finally{E(!1),V(null)}},Ee=t=>{B(t.id),D(t.name),U(!0)},ae=async()=>{if(!(!w||!v.trim())){_(!0);try{const t=g.find(n=>n.id===w),o=await q(v.trim());await K(R(f,"pantry",w),{name:v.trim(),category:o});const a={type:"edit",itemId:w,oldData:{name:t.name,category:t.category},timestamp:Date.now()};N(n=>[a,...n].slice(0,30)),i({open:!0,message:"Item updated and recategorized successfully",severity:"success"}),U(!1),B(null),D("")}catch(t){console.error("Error updating item:",t),i({open:!0,message:"Failed to update item",severity:"error"})}finally{_(!1)}}},$e=async()=>{if(A.length===0)return;const[t,...o]=A;try{if(t.type==="delete"){const{item:a}=t,{id:n,...c}=a;await me(G(f,"pantry"),c),i({open:!0,message:`Restored: ${a.name}`,severity:"success"})}else t.type==="edit"&&(await K(R(f,"pantry",t.itemId),t.oldData),i({open:!0,message:"Edit undone",severity:"success"}));N(o)}catch(a){console.error("Error undoing operation:",a),i({open:!0,message:"Failed to undo",severity:"error"})}},oe=()=>{U(!1),B(null),D("")},Ae=async()=>{const t=g.filter(n=>!n.category||n.category==="other");if(t.length===0){i({open:!0,message:"All items are already categorized!",severity:"info"});return}Z(!0);let o=0,a=0;try{for(const n of t)try{const c=await q(n.name);c&&c!=="other"?(await K(R(f,"pantry",n.id),{category:c}),o++):a++}catch(c){console.error(`Error recategorizing ${n.name}:`,c),a++}i({open:!0,message:`Recategorized ${o} items${a>0?`, ${a} remained as 'other'`:""}`,severity:o>0?"success":"info"})}catch(n){console.error("Error recategorizing items:",n),i({open:!0,message:"Failed to recategorize items",severity:"error"})}finally{Z(!1)}},L=g.reduce((t,o)=>{const a=o.category||"other";return t[a]||(t[a]=[]),t[a].push(o),t},{}),Fe=["produce","meat","dairy","bakery","frozen","pantry","beverages","snacks","household","other"].filter(t=>L[t]&&L[t].length>0),Oe=t=>{switch(t){case"receipt":return e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:"6px",bgcolor:z.bg,border:`1.5px solid ${z.main}`},children:e.jsx(nt,{sx:{fontSize:16,color:z.dark}})});case"photo":return e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:"6px",bgcolor:u.bg,border:`1.5px solid ${u.main}`},children:e.jsx(ue,{sx:{fontSize:16,color:u.darker}})});case"manual":return e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:"6px",bgcolor:r.bg,border:`1.5px solid ${r.main}`},children:e.jsx(he,{sx:{fontSize:16,color:r.darker}})});default:return e.jsx(s,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:"6px",bgcolor:He.borderLight,border:`1.5px solid ${y.main}`},children:e.jsx(O,{sx:{fontSize:16,color:M.dark}})})}};return Se?e.jsx(s,{sx:{background:`linear-gradient(180deg, ${r.bg} 0%, ${F} 100%)`,minHeight:"100vh",pb:4},children:e.jsx(ne,{maxWidth:"lg",children:e.jsx(s,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(h,{size:60,sx:{color:r.main}})})})}):e.jsxs(s,{sx:{background:`linear-gradient(180deg, ${r.bg} 0%, ${F} 100%)`,minHeight:"100vh",pb:4},children:[e.jsxs(ne,{maxWidth:"lg",children:[e.jsxs(s,{sx:{pt:4,pb:3},children:[e.jsxs(s,{sx:{display:"flex",justifyContent:"space-between",alignItems:"start",mb:1},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(O,{sx:{fontSize:{xs:32,md:40},color:r.main}}),e.jsx(m,{variant:"h3",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,color:r.main,fontSize:{xs:"28px",md:"34px"}},children:"My Pantry"})]}),e.jsxs(s,{sx:{display:"flex",gap:1},children:[A.length>0&&e.jsxs(x,{size:"small",onClick:$e,startIcon:e.jsx(it,{}),sx:{fontFamily:"Outfit, sans-serif",fontSize:"12px",textTransform:"none",color:p.main,border:`1px solid ${p.main}`,borderRadius:"8px",px:2,py:.75,"&:hover":{bgcolor:r.bg,border:`1px solid ${p.dark}`}},children:["Undo (",A.length,")"]}),g.length>0&&e.jsx(x,{size:"small",onClick:Ae,disabled:W,startIcon:W?e.jsx(h,{size:16}):null,sx:{fontFamily:"Outfit, sans-serif",fontSize:"12px",textTransform:"none",color:r.main,border:`1px solid ${r.main}`,borderRadius:"8px",px:2,py:.75,"&:hover":{bgcolor:r.bg,border:`1px solid ${r.dark}`},"&:disabled":{color:M.light,border:`1px solid ${y.light}`}},children:e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Be,{sx:{fontSize:16}}),W?"Analyzing...":"AI Categorize"]})})]})]}),e.jsxs(m,{sx:{fontFamily:"Outfit, sans-serif",color:r.dark,fontSize:"16px"},children:["Your current inventory - ",g.length," item",g.length!==1?"s":""]})]}),e.jsx(Y,{sx:{bgcolor:r.bg,borderRadius:"12px",border:`2px solid ${r.main}`,boxShadow:`3px 3px 0px ${r.light}`,mb:3},children:e.jsxs(pe,{sx:{p:2.5},children:[e.jsxs(s,{sx:{display:"flex",gap:1.5,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(ge,{placeholder:"Add item to pantry...",value:C,onChange:t=>Q(t.target.value),onKeyPress:t=>t.key==="Enter"&&re(),disabled:P,sx:{flex:"1 1 250px","& .MuiOutlinedInput-root":{bgcolor:F,fontFamily:"Outfit, sans-serif"}}}),e.jsx(x,{variant:"contained",startIcon:P?e.jsx(h,{size:16}):e.jsx(Ye,{}),onClick:re,disabled:P,sx:{bgcolor:r.main,fontFamily:"Outfit, sans-serif",textTransform:"none",px:3,"&:hover":{bgcolor:r.dark}},children:"Add"}),e.jsx(x,{variant:"outlined",startIcon:j?e.jsx(h,{size:16}):e.jsx(ue,{}),onClick:()=>te.current?.click(),disabled:j,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:r.main,borderColor:r.main,px:2,"&:hover":{borderColor:r.dark,bgcolor:r.bg}},children:"Photo"}),e.jsx(x,{variant:"outlined",startIcon:j?e.jsx(h,{size:16}):e.jsx(Je,{}),onClick:()=>ee.current?.click(),disabled:j,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:r.main,borderColor:r.main,px:2,"&:hover":{borderColor:r.dark,bgcolor:r.bg}},children:"Upload"})]}),j&&e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1,mt:2},children:[e.jsx(h,{size:20,sx:{color:r.main}}),e.jsx(m,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",color:r.dark,fontSize:"13px"},children:"Analyzing photo..."})]}),e.jsx("input",{ref:te,type:"file",accept:"image/*",capture:"environment",style:{display:"none"},onChange:se}),e.jsx("input",{ref:ee,type:"file",accept:"image/*",style:{display:"none"},onChange:se})]})}),g.length===0?e.jsxs(Y,{sx:{bgcolor:p.bg,borderRadius:"16px",border:`2px solid ${p.main}`,boxShadow:`3px 3px 0px ${p.light}`,p:5,textAlign:"center"},children:[e.jsx(O,{sx:{fontSize:56,color:H.main,mb:2}}),e.jsx(m,{variant:"h5",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,color:H.main,mb:1,fontSize:"20px"},children:"Your Pantry is Empty"}),e.jsx(m,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",fontWeight:400,color:H.dark},children:"Add items manually, take a pantry photo, or upload receipts to build your inventory!"})]}):e.jsx(fe,{container:!0,spacing:2.5,children:Fe.map(t=>{const o=ke.find(n=>n.value===t),a=L[t];return e.jsx(fe,{item:!0,xs:12,sm:6,md:6,lg:4,children:e.jsx(Y,{sx:{bgcolor:`${o.color}08`,borderRadius:"12px",border:`2px solid ${o.color}`,boxShadow:`3px 3px 0px ${o.color}30`,height:"100%"},children:e.jsxs(pe,{sx:{p:2.5},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(m,{variant:"h6",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,color:o.color,fontSize:"16px"},children:o.label}),e.jsx(Qe,{label:a.length,size:"small",sx:{height:"20px",fontSize:"11px",fontFamily:"Outfit, sans-serif",bgcolor:`${o.color}15`,color:o.color,fontWeight:600}})]}),e.jsx(s,{sx:{display:"flex",flexDirection:"column",gap:1},children:a.map(n=>e.jsxs(s,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1,borderRadius:"8px",bgcolor:F,border:`1px solid ${o.color}25`,"&:hover":{bgcolor:`${o.color}10`}},children:[e.jsxs(s,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[Oe(n.source),e.jsx(m,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontSize:"13px",color:M.dark,textTransform:"capitalize"},children:n.name})]}),e.jsx(xe,{size:"small",onClick:()=>Ee(n),sx:{color:r.main,p:.5,"&:hover":{bgcolor:r.bg}},children:e.jsx(he,{sx:{fontSize:16}})}),e.jsx(xe,{size:"small",onClick:()=>we(n),sx:{color:u.main,p:.5,"&:hover":{bgcolor:u.bg}},children:e.jsx(Xe,{sx:{fontSize:16}})})]},n.id))})]})})},t)})})]}),e.jsxs(ye,{open:Ce,onClose:()=>E(!1),maxWidth:"xs",fullWidth:!0,children:[e.jsx(be,{children:"Delete Item?"}),e.jsx(je,{children:e.jsxs(m,{children:["Are you sure you want to delete"," ",e.jsx("strong",{children:$?.name}),"? You can undo this action."]})}),e.jsxs(ve,{children:[e.jsx(x,{onClick:()=>E(!1),children:"Cancel"}),e.jsx(x,{onClick:De,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsxs(ye,{open:ze,onClose:oe,maxWidth:"sm",fullWidth:!0,children:[e.jsx(be,{children:"Edit Item Name"}),e.jsx(je,{children:e.jsx(s,{sx:{pt:1},children:e.jsx(ge,{autoFocus:!0,fullWidth:!0,label:"Item Name",value:v,onChange:t=>D(t.target.value),onKeyPress:t=>{t.key==="Enter"&&!I&&ae()},helperText:"Update the item name - will automatically recategorize with AI",disabled:I})})}),e.jsxs(ve,{children:[e.jsx(x,{onClick:oe,disabled:I,children:"Cancel"}),e.jsx(x,{onClick:ae,variant:"contained",disabled:!v.trim()||I,children:I?"Saving...":"Save"})]})]}),e.jsx(Ne,{open:k.open,autoHideDuration:4e3,onClose:()=>i({...k,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Le,{severity:k.severity,sx:{fontFamily:"Outfit, sans-serif"},children:k.message})})]})}export{Ct as default};
