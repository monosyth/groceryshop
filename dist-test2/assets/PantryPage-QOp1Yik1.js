import{d as Pe,j as e,w as r,C as oe,N as ae,E as se,M as ne,L as ie,ay as M,K as le,J as ce,F as h,U as A,O as Re,Q as Te,r as d,af as We,ag as Ue,q as B,z as Le,B as g,V as de,W as y,T as x,x as u,D as ge,at as Be,I as me,S as Ne,G as Ge,l as f,p as pe,n as He,o as Me,k as $,m as N}from"./index-BugtZPxr.js";import{c as G,a as Ke}from"./geminiService-CitDXh9M.js";import{L as qe,S as Ye,b as Je}from"./pantryService-o2NslTcL.js";import{G as Qe,S as Xe,E as Ze,B as _e,A as Ve,L as et,F as tt,C as rt,I as ot}from"./SetMeal-CPdaW2fI.js";import{C as H,a as ue}from"./CardContent-SvSXiK-s.js";import{T as xe}from"./TextField-Dk5mJdGW.js";import{A as at}from"./Add-ROHADGrl.js";import{C as fe,U as st}from"./Upload-NLt-j4dl.js";import{G as he}from"./Grid-DZvrU_m5.js";import{C as nt}from"./Chip-pSwn2DP9.js";import{R as it}from"./Receipt-uiQFyaNH.js";import{E as ye}from"./Edit-Cd5mII4C.js";import{D as lt}from"./Delete-CBStAulL.js";import{D as be,a as je,b as ve,c as Ce}from"./DialogTitle-D3Zjs63e.js";import"./useFormControl-Ccz3v5v6.js";const ct=Pe(e.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"})),m={produce:{value:"produce",label:"Produce",icon:Qe,color:r.main,bg:r.bg},meat:{value:"meat",label:"Meat & Seafood",icon:Xe,color:oe.main,bg:oe.bg},dairy:{value:"dairy",label:"Dairy & Eggs",icon:Ze,color:ae.main,bg:ae.bg},bakery:{value:"bakery",label:"Bakery",icon:_e,color:se.main,bg:se.bg},frozen:{value:"frozen",label:"Frozen",icon:Ve,color:ne.main,bg:ne.bg},pantry:{value:"pantry",label:"Pantry",icon:M,color:ie.main,bg:ie.bg},beverages:{value:"beverages",label:"Beverages",icon:et,color:le.main,bg:le.bg},snacks:{value:"snacks",label:"Snacks",icon:tt,color:ce.main,bg:ce.bg},household:{value:"household",label:"Household",icon:rt,color:h.main,bg:h.bg},"personal care":{value:"personal care",label:"Personal Care",icon:Ye,color:h.main,bg:h.bg},health:{value:"health",label:"Health",icon:qe,color:r.main,bg:r.bg},grocery:{value:"grocery",label:"Grocery",icon:Re,color:r.main,bg:r.bg},other:{value:"other",label:"Other",icon:ot,color:h.main,bg:h.bg}},dt=[m.produce,m.meat,m.dairy,m.bakery,m.frozen,m.pantry,m.beverages,m.snacks,m.household,m.other],F=c=>{const i=c?.toLowerCase()||"other";return m[i]||m.other},gt=c=>{const i=F(c);return{bgcolor:i.bg,borderRadius:"12px",border:`2px solid ${i.color}`,boxShadow:`3px 3px 0px ${i.color}40`,height:"100%"}},mt=c=>({fontFamily:"Outfit, sans-serif",fontWeight:600,color:F(c).color,fontSize:"16px"}),pt=c=>{const i=F(c);return{height:"20px",fontSize:"11px",fontFamily:"Outfit, sans-serif",bgcolor:`${i.color}20`,color:i.color,fontWeight:600}},ut=c=>{const i=F(c);return{bgcolor:A,border:`1px solid ${i.color}25`,borderRadius:"8px",p:1,"&:hover":{bgcolor:`${i.color}10`}}},xt=c=>({display:"flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:"6px",bgcolor:`${c}15`,border:`1.5px solid ${c}`});function Ot(){const{currentUser:c}=Te(),[i,Se]=d.useState([]),[Ie,K]=d.useState(!0),[S,q]=d.useState(""),[O,Y]=d.useState(!1),[b,P]=d.useState(!1),[R,J]=d.useState(!1),[I,l]=d.useState({open:!1,message:"",severity:"info"}),[ze,T]=d.useState(!1),[z,W]=d.useState(null),[j,k]=d.useState(""),[v,Q]=d.useState(!1),[ke,w]=d.useState(!1),[D,X]=d.useState(null),[E,U]=d.useState([]),Z=d.useRef(null),_=d.useRef(null),we=dt;d.useEffect(()=>{if(!c)return;const t=We(B(f,"pantry"),Ue("userId","==",c.uid)),a=Le(t,o=>{const n=[];o.forEach(s=>{n.push({id:s.id,...s.data()})}),n.sort((s,p)=>{const C=s.createdAt?.toDate()||new Date(0);return(p.createdAt?.toDate()||new Date(0))-C}),Se(n),K(!1)},o=>{console.error("Error fetching pantry:",o),K(!1)});return()=>a()},[c]);const V=async()=>{if(!S.trim()){l({open:!0,message:"Please enter an item name",severity:"warning"});return}Y(!0);try{const t=await G(S.trim());await pe(B(f,"pantry"),{userId:c.uid,name:S.trim().toLowerCase(),category:t,source:"manual",createdAt:He()}),q(""),l({open:!0,message:"Item added to pantry!",severity:"success"})}catch(t){console.error("Error adding item:",t),l({open:!0,message:"Failed to add item",severity:"error"})}finally{Y(!1)}},ee=async t=>{const a=t.target.files?.[0];if(a){P(!0);try{const o=new FileReader;o.onload=async n=>{const s=n.target.result.split(",")[1];try{const p=await Ke(s);if(p.length>0)try{const C=await Je(c.uid,p);l({open:!0,message:`Found ${p.length} ingredient${p.length!==1?"s":""} and added ${C} to pantry!`,severity:"success"})}catch(C){console.error("Error adding to pantry:",C),l({open:!0,message:`Found ${p.length} ingredient${p.length!==1?"s":""}, but couldn't add to pantry`,severity:"warning"})}else l({open:!0,message:"No ingredients found in photo",severity:"info"})}catch(p){console.error("Error analyzing photo:",p),l({open:!0,message:p.message.includes("API")?"Please add your Gemini API key to use this feature":"Failed to analyze photo. Please try again.",severity:"error"})}finally{P(!1)}},o.readAsDataURL(a)}catch(o){console.error("Error reading file:",o),P(!1),l({open:!0,message:"Failed to read image file",severity:"error"})}}},De=t=>{X(t),w(!0)},Ee=async()=>{if(D)try{const t={type:"delete",item:{...D},timestamp:Date.now()};U(a=>[t,...a].slice(0,30)),await Me($(f,"pantry",D.id)),l({open:!0,message:"Item removed from pantry",severity:"success"})}catch(t){console.error("Error deleting item:",t),l({open:!0,message:"Failed to delete item",severity:"error"})}finally{w(!1),X(null)}},$e=t=>{W(t.id),k(t.name),T(!0)},te=async()=>{if(!(!z||!j.trim())){Q(!0);try{const t=i.find(n=>n.id===z),a=await G(j.trim());await N($(f,"pantry",z),{name:j.trim(),category:a});const o={type:"edit",itemId:z,oldData:{name:t.name,category:t.category},timestamp:Date.now()};U(n=>[o,...n].slice(0,30)),l({open:!0,message:"Item updated and recategorized successfully",severity:"success"}),T(!1),W(null),k("")}catch(t){console.error("Error updating item:",t),l({open:!0,message:"Failed to update item",severity:"error"})}finally{Q(!1)}}},Ae=async()=>{if(E.length===0)return;const[t,...a]=E;try{if(t.type==="delete"){const{item:o}=t,{id:n,...s}=o;await pe(B(f,"pantry"),s),l({open:!0,message:`Restored: ${o.name}`,severity:"success"})}else t.type==="edit"&&(await N($(f,"pantry",t.itemId),t.oldData),l({open:!0,message:"Edit undone",severity:"success"}));U(a)}catch(o){console.error("Error undoing operation:",o),l({open:!0,message:"Failed to undo",severity:"error"})}},re=()=>{T(!1),W(null),k("")},Fe=async()=>{const t=i.filter(n=>!n.category||n.category==="other");if(t.length===0){l({open:!0,message:"All items are already categorized!",severity:"info"});return}J(!0);let a=0,o=0;try{for(const n of t)try{const s=await G(n.name);s&&s!=="other"?(await N($(f,"pantry",n.id),{category:s}),a++):o++}catch(s){console.error(`Error recategorizing ${n.name}:`,s),o++}l({open:!0,message:`Recategorized ${a} items${o>0?`, ${o} remained as 'other'`:""}`,severity:a>0?"success":"info"})}catch(n){console.error("Error recategorizing items:",n),l({open:!0,message:"Failed to recategorize items",severity:"error"})}finally{J(!1)}},L=i.reduce((t,a)=>{const o=a.category||"other";return t[o]||(t[o]=[]),t[o].push(a),t},{}),Oe=["produce","meat","dairy","bakery","frozen","pantry","beverages","snacks","household","other"].filter(t=>L[t]&&L[t].length>0);return Ie?e.jsx(g,{sx:{background:`linear-gradient(180deg, ${r.bg} 0%, ${A} 100%)`,minHeight:"100vh",pb:4},children:e.jsx(de,{maxWidth:"lg",children:e.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(y,{size:60,sx:{color:r.main}})})})}):e.jsxs(g,{sx:{background:`linear-gradient(180deg, ${r.bg} 0%, ${A} 100%)`,minHeight:"100vh",pb:4},children:[e.jsxs(de,{maxWidth:"lg",children:[e.jsxs(g,{sx:{pt:4,pb:3},children:[e.jsxs(g,{sx:{display:"flex",justifyContent:"space-between",alignItems:"start",mb:1},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(M,{sx:{fontSize:{xs:32,md:40},color:r.main}}),e.jsx(x,{variant:"h3",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,color:r.main,fontSize:{xs:"28px",md:"34px"}},children:"My Pantry"})]}),e.jsxs(g,{sx:{display:"flex",gap:1},children:[E.length>0&&e.jsxs(u,{size:"small",onClick:Ae,startIcon:e.jsx(ct,{}),sx:{fontFamily:"Outfit, sans-serif",fontSize:"12px",textTransform:"none",color:amber.main,border:`1px solid ${amber.main}`,borderRadius:"8px",px:2,py:.75,"&:hover":{bgcolor:r.bg,border:`1px solid ${amber.dark}`}},children:["Undo (",E.length,")"]}),i.length>0&&e.jsx(u,{size:"small",onClick:Fe,disabled:R,startIcon:R?e.jsx(y,{size:16}):null,sx:{fontFamily:"Outfit, sans-serif",fontSize:"12px",textTransform:"none",color:r.main,border:`1px solid ${r.main}`,borderRadius:"8px",px:2,py:.75,"&:hover":{bgcolor:r.bg,border:`1px solid ${r.dark}`},"&:disabled":{color:ge.light,border:`1px solid ${h.light}`}},children:e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Be,{sx:{fontSize:16}}),R?"Analyzing...":"AI Categorize"]})})]})]}),e.jsxs(x,{sx:{fontFamily:"Outfit, sans-serif",color:r.dark,fontSize:"16px"},children:["Your current inventory - ",i.length," item",i.length!==1?"s":""]})]}),e.jsx(H,{sx:{bgcolor:r.bg,borderRadius:"12px",border:`2px solid ${r.main}`,boxShadow:`3px 3px 0px ${r.light}`,mb:3},children:e.jsxs(ue,{sx:{p:2.5},children:[e.jsxs(g,{sx:{display:"flex",gap:1.5,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(xe,{placeholder:"Add item to pantry...",value:S,onChange:t=>q(t.target.value),onKeyPress:t=>t.key==="Enter"&&V(),disabled:O,sx:{flex:"1 1 250px","& .MuiOutlinedInput-root":{bgcolor:A,fontFamily:"Outfit, sans-serif"}}}),e.jsx(u,{variant:"contained",startIcon:O?e.jsx(y,{size:16}):e.jsx(at,{}),onClick:V,disabled:O,sx:{bgcolor:r.main,fontFamily:"Outfit, sans-serif",textTransform:"none",px:3,"&:hover":{bgcolor:r.dark}},children:"Add"}),e.jsx(u,{variant:"outlined",startIcon:b?e.jsx(y,{size:16}):e.jsx(fe,{}),onClick:()=>_.current?.click(),disabled:b,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:r.main,borderColor:r.main,px:2,"&:hover":{borderColor:r.dark,bgcolor:r.bg}},children:"Photo"}),e.jsx(u,{variant:"outlined",startIcon:b?e.jsx(y,{size:16}):e.jsx(st,{}),onClick:()=>Z.current?.click(),disabled:b,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:r.main,borderColor:r.main,px:2,"&:hover":{borderColor:r.dark,bgcolor:r.bg}},children:"Upload"})]}),b&&e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,mt:2},children:[e.jsx(y,{size:20,sx:{color:r.main}}),e.jsx(x,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",color:r.dark,fontSize:"13px"},children:"Analyzing photo..."})]}),e.jsx("input",{ref:_,type:"file",accept:"image/*",capture:"environment",style:{display:"none"},onChange:ee}),e.jsx("input",{ref:Z,type:"file",accept:"image/*",style:{display:"none"},onChange:ee})]})}),i.length===0?e.jsxs(H,{sx:{bgcolor:amber.bg,borderRadius:"16px",border:`2px solid ${amber.main}`,boxShadow:`3px 3px 0px ${amber.light}`,p:5,textAlign:"center"},children:[e.jsx(M,{sx:{fontSize:56,color:brown.main,mb:2}}),e.jsx(x,{variant:"h5",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,color:brown.main,mb:1,fontSize:"20px"},children:"Your Pantry is Empty"}),e.jsx(x,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",fontWeight:400,color:brown.dark},children:"Add items manually, take a pantry photo, or upload receipts to build your inventory!"})]}):e.jsx(he,{container:!0,spacing:2.5,children:Oe.map(t=>{const a=we.find(s=>s.value===t),o=L[t],n=a.icon;return e.jsx(he,{item:!0,xs:12,sm:6,md:6,lg:4,children:e.jsx(H,{sx:gt(t),children:e.jsxs(ue,{sx:{p:2.5},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(n,{sx:{fontSize:20,color:a.color}}),e.jsx(x,{variant:"h6",sx:mt(t),children:a.label}),e.jsx(nt,{label:o.length,size:"small",sx:pt(t)})]}),e.jsx(g,{sx:{display:"flex",flexDirection:"column",gap:1},children:o.map(s=>e.jsxs(g,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",...ut(t)},children:[e.jsxs(g,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[e.jsx(g,{sx:xt(a.color),children:s.source==="receipt"?e.jsx(it,{sx:{fontSize:16,color:a.color}}):s.source==="photo"?e.jsx(fe,{sx:{fontSize:16,color:a.color}}):e.jsx(ye,{sx:{fontSize:16,color:a.color}})}),e.jsx(x,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontSize:"13px",color:ge.dark,textTransform:"capitalize"},children:s.name})]}),e.jsx(me,{size:"small",onClick:()=>$e(s),sx:{color:a.color,p:.5,"&:hover":{bgcolor:`${a.color}15`}},children:e.jsx(ye,{sx:{fontSize:16}})}),e.jsx(me,{size:"small",onClick:()=>De(s),sx:{color:red.main,p:.5,"&:hover":{bgcolor:red.bg}},children:e.jsx(lt,{sx:{fontSize:16}})})]},s.id))})]})})},t)})})]}),e.jsxs(be,{open:ke,onClose:()=>w(!1),maxWidth:"xs",fullWidth:!0,children:[e.jsx(je,{children:"Delete Item?"}),e.jsx(ve,{children:e.jsxs(x,{children:["Are you sure you want to delete"," ",e.jsx("strong",{children:D?.name}),"? You can undo this action."]})}),e.jsxs(Ce,{children:[e.jsx(u,{onClick:()=>w(!1),children:"Cancel"}),e.jsx(u,{onClick:Ee,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsxs(be,{open:ze,onClose:re,maxWidth:"sm",fullWidth:!0,children:[e.jsx(je,{children:"Edit Item Name"}),e.jsx(ve,{children:e.jsx(g,{sx:{pt:1},children:e.jsx(xe,{autoFocus:!0,fullWidth:!0,label:"Item Name",value:j,onChange:t=>k(t.target.value),onKeyPress:t=>{t.key==="Enter"&&!v&&te()},helperText:"Update the item name - will automatically recategorize with AI",disabled:v})})}),e.jsxs(Ce,{children:[e.jsx(u,{onClick:re,disabled:v,children:"Cancel"}),e.jsx(u,{onClick:te,variant:"contained",disabled:!j.trim()||v,children:v?"Saving...":"Save"})]})]}),e.jsx(Ne,{open:I.open,autoHideDuration:4e3,onClose:()=>l({...I,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Ge,{severity:I.severity,sx:{fontFamily:"Outfit, sans-serif"},children:I.message})})]})}export{Ot as default};
