import{d as Pe,j as e,Q as Re,r as l,af as Te,ag as We,q as M,z as Ue,B as n,w as o,U as F,V as ce,W as h,ay as $,T as g,x,E as m,F as u,D as de,at as Be,X as G,C as S,N as L,M as H,L as K,K as q,J as Y,I as xe,S as Ne,G as Me,l as f,p as me,n as Ge,o as Le,k as O,m as J}from"./index-oLzLRuGj.js";import{c as Q,a as He}from"./geminiService-CitDXh9M.js";import{b as Ke}from"./pantryService-BVvyzJTa.js";import{C as X,a as ge}from"./CardContent-DyLJn8kR.js";import{T as pe}from"./TextField-C9c5A1Lx.js";import{A as qe}from"./Add-4bhPWSPA.js";import{C as ue,U as Ye}from"./Upload-BvZogK9v.js";import{G as fe}from"./Grid-BINwt3mZ.js";import{C as Je}from"./Chip-CV-fw4zx.js";import{E as he}from"./Edit-WotB6fsq.js";import{D as Qe}from"./Delete-DTnUu-RJ.js";import{D as ye,a as be,b as je,c as ve}from"./DialogTitle-DpRGkUWM.js";import{G as Xe,S as Ze,E as _e,B as Ve,A as et,L as tt,F as st,C as rt,I as at}from"./SetMeal-BlKJcaug.js";import{R as ot}from"./Receipt-Sm6kr_sO.js";import"./useFormControl-BkNEnTDh.js";const nt=Pe(e.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}));function zt(){const{currentUser:y}=Re(),[p,Ie]=l.useState([]),[Se,Z]=l.useState(!0),[z,_]=l.useState(""),[P,V]=l.useState(!1),[b,R]=l.useState(!1),[T,ee]=l.useState(!1),[C,i]=l.useState({open:!1,message:"",severity:"info"}),[ze,W]=l.useState(!1),[k,U]=l.useState(null),[j,w]=l.useState(""),[v,te]=l.useState(!1),[Ce,D]=l.useState(!1),[E,se]=l.useState(null),[A,B]=l.useState([]),re=l.useRef(null),ae=l.useRef(null),ke=[{value:"produce",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Xe,{sx:{fontSize:16,color:o.main}})," Produce"]}),color:o.main,bg:o.bg},{value:"meat",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ze,{sx:{fontSize:16,color:S.main}})," Meat & Seafood"]}),color:S.main,bg:S.bg},{value:"dairy",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(_e,{sx:{fontSize:16,color:L.main}})," Dairy & Eggs"]}),color:L.main,bg:L.bg},{value:"bakery",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ve,{sx:{fontSize:16,color:m.main}})," Bakery"]}),color:m.main,bg:m.bg},{value:"frozen",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(et,{sx:{fontSize:16,color:H.main}})," Frozen"]}),color:H.main,bg:H.bg},{value:"pantry",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx($,{sx:{fontSize:16,color:K.main}})," Pantry"]}),color:K.main,bg:K.bg},{value:"beverages",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(tt,{sx:{fontSize:16,color:q.main}})," Beverages"]}),color:q.main,bg:q.bg},{value:"snacks",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(st,{sx:{fontSize:16,color:Y.main}})," Snacks"]}),color:Y.main,bg:Y.bg},{value:"household",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(rt,{sx:{fontSize:16,color:u.main}})," Household"]}),color:u.main,bg:u.bg},{value:"other",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(at,{sx:{fontSize:16,color:u.main}})," Other"]}),color:u.main,bg:u.bg}];l.useEffect(()=>{if(!y)return;const t=Te(M(f,"pantry"),We("userId","==",y.uid)),s=Ue(t,r=>{const a=[];r.forEach(c=>{a.push({id:c.id,...c.data()})}),a.sort((c,d)=>{const I=c.createdAt?.toDate()||new Date(0);return(d.createdAt?.toDate()||new Date(0))-I}),Ie(a),Z(!1)},r=>{console.error("Error fetching pantry:",r),Z(!1)});return()=>s()},[y]);const oe=async()=>{if(!z.trim()){i({open:!0,message:"Please enter an item name",severity:"warning"});return}V(!0);try{const t=await Q(z.trim());await me(M(f,"pantry"),{userId:y.uid,name:z.trim().toLowerCase(),category:t,source:"manual",createdAt:Ge()}),_(""),i({open:!0,message:"Item added to pantry!",severity:"success"})}catch(t){console.error("Error adding item:",t),i({open:!0,message:"Failed to add item",severity:"error"})}finally{V(!1)}},ne=async t=>{const s=t.target.files?.[0];if(s){R(!0);try{const r=new FileReader;r.onload=async a=>{const c=a.target.result.split(",")[1];try{const d=await He(c);if(d.length>0)try{const I=await Ke(y.uid,d);i({open:!0,message:`Found ${d.length} ingredient${d.length!==1?"s":""} and added ${I} to pantry!`,severity:"success"})}catch(I){console.error("Error adding to pantry:",I),i({open:!0,message:`Found ${d.length} ingredient${d.length!==1?"s":""}, but couldn't add to pantry`,severity:"warning"})}else i({open:!0,message:"No ingredients found in photo",severity:"info"})}catch(d){console.error("Error analyzing photo:",d),i({open:!0,message:d.message.includes("API")?"Please add your Gemini API key to use this feature":"Failed to analyze photo. Please try again.",severity:"error"})}finally{R(!1)}},r.readAsDataURL(s)}catch(r){console.error("Error reading file:",r),R(!1),i({open:!0,message:"Failed to read image file",severity:"error"})}}},we=t=>{se(t),D(!0)},De=async()=>{if(E)try{const t={type:"delete",item:{...E},timestamp:Date.now()};B(s=>[t,...s].slice(0,30)),await Le(O(f,"pantry",E.id)),i({open:!0,message:"Item removed from pantry",severity:"success"})}catch(t){console.error("Error deleting item:",t),i({open:!0,message:"Failed to delete item",severity:"error"})}finally{D(!1),se(null)}},Ee=t=>{U(t.id),w(t.name),W(!0)},ie=async()=>{if(!(!k||!j.trim())){te(!0);try{const t=p.find(a=>a.id===k),s=await Q(j.trim());await J(O(f,"pantry",k),{name:j.trim(),category:s});const r={type:"edit",itemId:k,oldData:{name:t.name,category:t.category},timestamp:Date.now()};B(a=>[r,...a].slice(0,30)),i({open:!0,message:"Item updated and recategorized successfully",severity:"success"}),W(!1),U(null),w("")}catch(t){console.error("Error updating item:",t),i({open:!0,message:"Failed to update item",severity:"error"})}finally{te(!1)}}},Ae=async()=>{if(A.length===0)return;const[t,...s]=A;try{if(t.type==="delete"){const{item:r}=t,{id:a,...c}=r;await me(M(f,"pantry"),c),i({open:!0,message:`Restored: ${r.name}`,severity:"success"})}else t.type==="edit"&&(await J(O(f,"pantry",t.itemId),t.oldData),i({open:!0,message:"Edit undone",severity:"success"}));B(s)}catch(r){console.error("Error undoing operation:",r),i({open:!0,message:"Failed to undo",severity:"error"})}},le=()=>{W(!1),U(null),w("")},Fe=async()=>{const t=p.filter(a=>!a.category||a.category==="other");if(t.length===0){i({open:!0,message:"All items are already categorized!",severity:"info"});return}ee(!0);let s=0,r=0;try{for(const a of t)try{const c=await Q(a.name);c&&c!=="other"?(await J(O(f,"pantry",a.id),{category:c}),s++):r++}catch(c){console.error(`Error recategorizing ${a.name}:`,c),r++}i({open:!0,message:`Recategorized ${s} items${r>0?`, ${r} remained as 'other'`:""}`,severity:s>0?"success":"info"})}catch(a){console.error("Error recategorizing items:",a),i({open:!0,message:"Failed to recategorize items",severity:"error"})}finally{ee(!1)}},N=p.reduce((t,s)=>{const r=s.category||"other";return t[r]||(t[r]=[]),t[r].push(s),t},{}),$e=["produce","meat","dairy","bakery","frozen","pantry","beverages","snacks","household","other"].filter(t=>N[t]&&N[t].length>0),Oe=(t,s)=>{const a={receipt:ot,photo:ue,manual:he}[t]||$;return e.jsx(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:"6px",bgcolor:`${s}15`,border:`1.5px solid ${s}`},children:e.jsx(a,{sx:{fontSize:16,color:s}})})};return Se?e.jsx(n,{sx:{background:`linear-gradient(180deg, ${o.bg} 0%, ${F} 100%)`,minHeight:"100vh",pb:4},children:e.jsx(ce,{maxWidth:"lg",children:e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(h,{size:60,sx:{color:o.main}})})})}):e.jsxs(n,{sx:{background:`linear-gradient(180deg, ${o.bg} 0%, ${F} 100%)`,minHeight:"100vh",pb:4},children:[e.jsxs(ce,{maxWidth:"lg",children:[e.jsxs(n,{sx:{pt:4,pb:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"start",mb:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx($,{sx:{fontSize:{xs:32,md:40},color:o.main}}),e.jsx(g,{variant:"h3",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,color:o.main,fontSize:{xs:"28px",md:"34px"}},children:"My Pantry"})]}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[A.length>0&&e.jsxs(x,{size:"small",onClick:Ae,startIcon:e.jsx(nt,{}),sx:{fontFamily:"Outfit, sans-serif",fontSize:"12px",textTransform:"none",color:m.main,border:`1px solid ${m.main}`,borderRadius:"8px",px:2,py:.75,"&:hover":{bgcolor:o.bg,border:`1px solid ${m.dark}`}},children:["Undo (",A.length,")"]}),p.length>0&&e.jsx(x,{size:"small",onClick:Fe,disabled:T,startIcon:T?e.jsx(h,{size:16}):null,sx:{fontFamily:"Outfit, sans-serif",fontSize:"12px",textTransform:"none",color:o.main,border:`1px solid ${o.main}`,borderRadius:"8px",px:2,py:.75,"&:hover":{bgcolor:o.bg,border:`1px solid ${o.dark}`},"&:disabled":{color:de.light,border:`1px solid ${u.light}`}},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Be,{sx:{fontSize:16}}),T?"Analyzing...":"AI Categorize"]})})]})]}),e.jsxs(g,{sx:{fontFamily:"Outfit, sans-serif",color:o.dark,fontSize:"16px"},children:["Your current inventory - ",p.length," item",p.length!==1?"s":""]})]}),e.jsx(X,{sx:{bgcolor:o.bg,borderRadius:"12px",border:`2px solid ${o.main}`,boxShadow:`3px 3px 0px ${o.light}`,mb:3},children:e.jsxs(ge,{sx:{p:2.5},children:[e.jsxs(n,{sx:{display:"flex",gap:1.5,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(pe,{placeholder:"Add item to pantry...",value:z,onChange:t=>_(t.target.value),onKeyPress:t=>t.key==="Enter"&&oe(),disabled:P,sx:{flex:"1 1 250px","& .MuiOutlinedInput-root":{bgcolor:F,fontFamily:"Outfit, sans-serif"}}}),e.jsx(x,{variant:"contained",startIcon:P?e.jsx(h,{size:16}):e.jsx(qe,{}),onClick:oe,disabled:P,sx:{bgcolor:o.main,fontFamily:"Outfit, sans-serif",textTransform:"none",px:3,"&:hover":{bgcolor:o.dark}},children:"Add"}),e.jsx(x,{variant:"outlined",startIcon:b?e.jsx(h,{size:16}):e.jsx(ue,{}),onClick:()=>ae.current?.click(),disabled:b,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:o.main,borderColor:o.main,px:2,"&:hover":{borderColor:o.dark,bgcolor:o.bg}},children:"Photo"}),e.jsx(x,{variant:"outlined",startIcon:b?e.jsx(h,{size:16}):e.jsx(Ye,{}),onClick:()=>re.current?.click(),disabled:b,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:o.main,borderColor:o.main,px:2,"&:hover":{borderColor:o.dark,bgcolor:o.bg}},children:"Upload"})]}),b&&e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mt:2},children:[e.jsx(h,{size:20,sx:{color:o.main}}),e.jsx(g,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",color:o.dark,fontSize:"13px"},children:"Analyzing photo..."})]}),e.jsx("input",{ref:ae,type:"file",accept:"image/*",capture:"environment",style:{display:"none"},onChange:ne}),e.jsx("input",{ref:re,type:"file",accept:"image/*",style:{display:"none"},onChange:ne})]})}),p.length===0?e.jsxs(X,{sx:{bgcolor:m.bg,borderRadius:"16px",border:`2px solid ${m.main}`,boxShadow:`3px 3px 0px ${m.light}`,p:5,textAlign:"center"},children:[e.jsx($,{sx:{fontSize:56,color:G.main,mb:2}}),e.jsx(g,{variant:"h5",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,color:G.main,mb:1,fontSize:"20px"},children:"Your Pantry is Empty"}),e.jsx(g,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",fontWeight:400,color:G.dark},children:"Add items manually, take a pantry photo, or upload receipts to build your inventory!"})]}):e.jsx(fe,{container:!0,spacing:2.5,children:$e.map(t=>{const s=ke.find(a=>a.value===t),r=N[t];return e.jsx(fe,{item:!0,xs:12,sm:6,md:6,lg:4,children:e.jsx(X,{sx:{bgcolor:s.bg,borderRadius:"12px",border:`2px solid ${s.color}`,boxShadow:`3px 3px 0px ${s.color}40`,height:"100%"},children:e.jsxs(ge,{sx:{p:2.5},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(g,{variant:"h6",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,color:s.color,fontSize:"16px"},children:s.label}),e.jsx(Je,{label:r.length,size:"small",sx:{height:"20px",fontSize:"11px",fontFamily:"Outfit, sans-serif",bgcolor:`${s.color}15`,color:s.color,fontWeight:600}})]}),e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:1},children:r.map(a=>e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1,borderRadius:"8px",bgcolor:F,border:`1px solid ${s.color}25`,"&:hover":{bgcolor:`${s.color}10`}},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[Oe(a.source,s.color),e.jsx(g,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontSize:"13px",color:de.dark,textTransform:"capitalize"},children:a.name})]}),e.jsx(xe,{size:"small",onClick:()=>Ee(a),sx:{color:s.color,p:.5,"&:hover":{bgcolor:`${s.color}15`}},children:e.jsx(he,{sx:{fontSize:16}})}),e.jsx(xe,{size:"small",onClick:()=>we(a),sx:{color:S.main,p:.5,"&:hover":{bgcolor:S.bg}},children:e.jsx(Qe,{sx:{fontSize:16}})})]},a.id))})]})})},t)})})]}),e.jsxs(ye,{open:Ce,onClose:()=>D(!1),maxWidth:"xs",fullWidth:!0,children:[e.jsx(be,{children:"Delete Item?"}),e.jsx(je,{children:e.jsxs(g,{children:["Are you sure you want to delete"," ",e.jsx("strong",{children:E?.name}),"? You can undo this action."]})}),e.jsxs(ve,{children:[e.jsx(x,{onClick:()=>D(!1),children:"Cancel"}),e.jsx(x,{onClick:De,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsxs(ye,{open:ze,onClose:le,maxWidth:"sm",fullWidth:!0,children:[e.jsx(be,{children:"Edit Item Name"}),e.jsx(je,{children:e.jsx(n,{sx:{pt:1},children:e.jsx(pe,{autoFocus:!0,fullWidth:!0,label:"Item Name",value:j,onChange:t=>w(t.target.value),onKeyPress:t=>{t.key==="Enter"&&!v&&ie()},helperText:"Update the item name - will automatically recategorize with AI",disabled:v})})}),e.jsxs(ve,{children:[e.jsx(x,{onClick:le,disabled:v,children:"Cancel"}),e.jsx(x,{onClick:ie,variant:"contained",disabled:!j.trim()||v,children:v?"Saving...":"Save"})]})]}),e.jsx(Ne,{open:C.open,autoHideDuration:4e3,onClose:()=>i({...C,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Me,{severity:C.severity,sx:{fontFamily:"Outfit, sans-serif"},children:C.message})})]})}export{zt as default};
