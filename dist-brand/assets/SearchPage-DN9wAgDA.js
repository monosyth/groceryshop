import{r as d,g as $,a as I,u as z,j as t,c as M,b as H,s as W,Z as V,_ as R,d as Z,Q as oe,R as ae,V as Q,B as D,W as re,T as f,P as O,$ as _,x as U,I as se,S as ne,G as ie,k as le,l as ce,m as de}from"./index-CsiIu3XX.js";import{a as pe}from"./SearchBar-JsO6RCdl.js";import{E as ue}from"./Edit-ihsG2UmY.js";import{C as ge}from"./Chip-QOg_ts1l.js";import{D as xe,a as he,b as fe,c as ye}from"./DialogTitle-Bnfj9tVW.js";import{T as me}from"./TextField-D1kGytsK.js";import{f as be}from"./format-BNZNg-GV.js";import"./InputAdornment-D-5E6HZU.js";import"./useFormControl-CaPw9b04.js";const ee=d.createContext();function ve(e){return $("MuiTable",e)}I("MuiTable",["root","stickyHeader"]);const Ce=e=>{const{classes:a,stickyHeader:n}=e;return H({root:["root",n&&"stickyHeader"]},ve,a)},je=W("table",{name:"MuiTable",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,n.stickyHeader&&a.stickyHeader]}})(V(({theme:e})=>({display:"table",width:"100%",borderCollapse:"collapse",borderSpacing:0,"& caption":{...e.typography.body2,padding:e.spacing(2),color:(e.vars||e).palette.text.secondary,textAlign:"left",captionSide:"bottom"},variants:[{props:({ownerState:a})=>a.stickyHeader,style:{borderCollapse:"separate"}}]}))),q="table",Te=d.forwardRef(function(a,n){const l=z({props:a,name:"MuiTable"}),{className:u,component:i=q,padding:p="normal",size:c="medium",stickyHeader:g=!1,...b}=l,x={...l,component:i,padding:p,size:c,stickyHeader:g},y=Ce(x),S=d.useMemo(()=>({padding:p,size:c,stickyHeader:g}),[p,c,g]);return t.jsx(ee.Provider,{value:S,children:t.jsx(je,{as:i,role:i===q?null:"table",ref:n,className:M(y.root,u),ownerState:x,...b})})}),B=d.createContext();function we(e){return $("MuiTableBody",e)}I("MuiTableBody",["root"]);const ke=e=>{const{classes:a}=e;return H({root:["root"]},we,a)},Se=W("tbody",{name:"MuiTableBody",slot:"Root"})({display:"table-row-group"}),De={variant:"body"},G="tbody",Re=d.forwardRef(function(a,n){const l=z({props:a,name:"MuiTableBody"}),{className:u,component:i=G,...p}=l,c={...l,component:i},g=ke(c);return t.jsx(B.Provider,{value:De,children:t.jsx(Se,{className:M(g.root,u),as:i,ref:n,role:i===G?null:"rowgroup",ownerState:c,...p})})});function $e(e){return $("MuiTableCell",e)}const Ie=I("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),ze=e=>{const{classes:a,variant:n,align:l,padding:u,size:i,stickyHeader:p}=e,c={root:["root",n,p&&"stickyHeader",l!=="inherit"&&`align${R(l)}`,u!=="normal"&&`padding${R(u)}`,`size${R(i)}`]};return H(c,$e,a)},Me=W("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,a[n.variant],a[`size${R(n.size)}`],n.padding!=="normal"&&a[`padding${R(n.padding)}`],n.align!=="inherit"&&a[`align${R(n.align)}`],n.stickyHeader&&a.stickyHeader]}})(V(({theme:e})=>({...e.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:e.vars?`1px solid ${e.vars.palette.TableCell.border}`:`1px solid
    ${e.palette.mode==="light"?e.lighten(e.alpha(e.palette.divider,1),.88):e.darken(e.alpha(e.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(e.vars||e).palette.text.primary,lineHeight:e.typography.pxToRem(24),fontWeight:e.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(e.vars||e).palette.text.primary}},{props:{variant:"footer"},style:{color:(e.vars||e).palette.text.secondary,lineHeight:e.typography.pxToRem(21),fontSize:e.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${Ie.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:a})=>a.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(e.vars||e).palette.background.default}}]}))),j=d.forwardRef(function(a,n){const l=z({props:a,name:"MuiTableCell"}),{align:u="inherit",className:i,component:p,padding:c,scope:g,size:b,sortDirection:x,variant:y,...S}=l,h=d.useContext(ee),T=d.useContext(B),k=T&&T.variant==="head";let v;p?v=p:v=k?"th":"td";let w=g;v==="td"?w=void 0:!w&&k&&(w="col");const m=y||T&&T.variant,A={...l,align:u,component:v,padding:c||(h&&h.padding?h.padding:"normal"),size:b||(h&&h.size?h.size:"medium"),sortDirection:x,stickyHeader:m==="head"&&h&&h.stickyHeader,variant:m},N=ze(A);let P=null;return x&&(P=x==="asc"?"ascending":"descending"),t.jsx(Me,{as:v,ref:n,className:M(N.root,i),"aria-sort":P,scope:w,ownerState:A,...S})});function He(e){return $("MuiTableContainer",e)}I("MuiTableContainer",["root"]);const We=e=>{const{classes:a}=e;return H({root:["root"]},He,a)},Pe=W("div",{name:"MuiTableContainer",slot:"Root"})({width:"100%",overflowX:"auto"}),Ue=d.forwardRef(function(a,n){const l=z({props:a,name:"MuiTableContainer"}),{className:u,component:i="div",...p}=l,c={...l,component:i},g=We(c);return t.jsx(Pe,{ref:n,as:i,className:M(g.root,u),ownerState:c,...p})});function Ae(e){return $("MuiTableHead",e)}I("MuiTableHead",["root"]);const Ne=e=>{const{classes:a}=e;return H({root:["root"]},Ae,a)},Be=W("thead",{name:"MuiTableHead",slot:"Root"})({display:"table-header-group"}),Ee={variant:"head"},J="thead",Le=d.forwardRef(function(a,n){const l=z({props:a,name:"MuiTableHead"}),{className:u,component:i=J,...p}=l,c={...l,component:i},g=Ne(c);return t.jsx(B.Provider,{value:Ee,children:t.jsx(Be,{as:i,className:M(g.root,u),ref:n,role:i===J?null:"rowgroup",ownerState:c,...p})})});function Fe(e){return $("MuiTableRow",e)}const K=I("MuiTableRow",["root","selected","hover","head","footer"]),Oe=e=>{const{classes:a,selected:n,hover:l,head:u,footer:i}=e;return H({root:["root",n&&"selected",l&&"hover",u&&"head",i&&"footer"]},Fe,a)},Ve=W("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(e,a)=>{const{ownerState:n}=e;return[a.root,n.head&&a.head,n.footer&&a.footer]}})(V(({theme:e})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${K.hover}:hover`]:{backgroundColor:(e.vars||e).palette.action.hover},[`&.${K.selected}`]:{backgroundColor:e.alpha((e.vars||e).palette.primary.main,(e.vars||e).palette.action.selectedOpacity),"&:hover":{backgroundColor:e.alpha((e.vars||e).palette.primary.main,`${(e.vars||e).palette.action.selectedOpacity} + ${(e.vars||e).palette.action.hoverOpacity}`)}}}))),X="tr",Y=d.forwardRef(function(a,n){const l=z({props:a,name:"MuiTableRow"}),{className:u,component:i=X,hover:p=!1,selected:c=!1,...g}=l,b=d.useContext(B),x={...l,component:i,hover:p,selected:c,head:b&&b.variant==="head",footer:b&&b.variant==="footer"},y=Oe(x);return t.jsx(Ve,{as:i,ref:n,className:M(y.root,u),role:i===X?null:"row",ownerState:x,...g})}),Qe=Z(t.jsx("path",{d:"m20 12-1.41-1.41L13 16.17V4h-2v12.17l-5.58-5.59L4 12l8 8z"})),_e=Z(t.jsx("path",{d:"m4 12 1.41 1.41L11 7.83V20h2V7.83l5.58 5.59L20 12l-8-8z"})),qe={grocery:"default",produce:"success",meat:"error",dairy:"info",bakery:"warning",frozen:"primary",beverages:"secondary",snacks:"warning",household:"default","personal care":"info",health:"success",other:"default"};function at(){const{currentUser:e}=oe(),{receipts:a,loading:n}=ae(),[l,u]=d.useState(""),[i,p]=d.useState({dateRange:"all",category:"all"}),[c,g]=d.useState("name-asc"),[b,x]=d.useState(!1),[y,S]=d.useState(null),[h,T]=d.useState(""),[k,v]=d.useState({open:!1,message:"",severity:"success"}),w=d.useMemo(()=>{const o=[];return a.forEach(r=>{r.items&&Array.isArray(r.items)&&r.items.forEach((s,C)=>{o.push({...s,itemId:`${r.id}-${C}`,receiptId:r.id,receiptStore:r.storeInfo?.name||"Unknown Store",receiptDate:r.storeInfo?.date,receiptLocation:r.storeInfo?.location})})}),o},[a]),m=d.useMemo(()=>{let o=[...w];if(l.trim()){const r=l.toLowerCase().trim();o=o.filter(s=>!!(s.name?.toLowerCase().includes(r)||s.receiptText?.toLowerCase().includes(r)||s.keywords&&Array.isArray(s.keywords)&&s.keywords.some(C=>C.toLowerCase().includes(r))||s.category?.toLowerCase().includes(r)||s.receiptStore?.toLowerCase().includes(r)||s.receiptLocation?.toLowerCase().includes(r)))}if(i.dateRange!=="all"){const r=new Date,s=new Date;switch(i.dateRange){case"today":s.setHours(0,0,0,0);break;case"7days":s.setDate(r.getDate()-7);break;case"30days":s.setDate(r.getDate()-30);break;case"90days":s.setDate(r.getDate()-90);break}o=o.filter(C=>C.receiptDate?C.receiptDate.toDate()>=s:!1)}switch(i.category!=="all"&&(o=o.filter(r=>r.category===i.category)),c){case"name-asc":o.sort((r,s)=>(r.name||"").localeCompare(s.name||""));break;case"name-desc":o.sort((r,s)=>(s.name||"").localeCompare(r.name||""));break;case"store-asc":o.sort((r,s)=>(r.receiptStore||"").localeCompare(s.receiptStore||""));break;case"store-desc":o.sort((r,s)=>(s.receiptStore||"").localeCompare(r.receiptStore||""));break;case"amount-asc":o.sort((r,s)=>(r.totalPrice||0)-(s.totalPrice||0));break;case"amount-desc":o.sort((r,s)=>(s.totalPrice||0)-(r.totalPrice||0));break;case"date-desc":o.sort((r,s)=>r.receiptDate?s.receiptDate?s.receiptDate.toDate()-r.receiptDate.toDate():-1:1);break;case"date-asc":o.sort((r,s)=>r.receiptDate?s.receiptDate?r.receiptDate.toDate()-s.receiptDate.toDate():-1:1);break}return o},[w,l,i,c]),A=o=>{S(o),T(o.name),x(!0)},N=async()=>{if(!(!y||!h.trim()))try{const o=le(ce,"receipts",y.receiptId),r=a.find(F=>F.id===y.receiptId);if(!r)throw new Error("Receipt not found");const s=r.items.findIndex((F,te)=>`${y.receiptId}-${te}`===y.itemId);if(s===-1)throw new Error("Item not found in receipt");const C=[...r.items];C[s]={...C[s],name:h.trim()},await de(o,{items:C}),v({open:!0,message:"Item name updated successfully",severity:"success"}),x(!1),S(null),T("")}catch(o){console.error("Error updating item name:",o),v({open:!0,message:"Failed to update item name",severity:"error"})}},P=()=>{x(!1),S(null),T("")},E=o=>{c===`${o}-asc`?g(`${o}-desc`):g(`${o}-asc`)},L=o=>c===`${o}-asc`?t.jsx(_e,{sx:{fontSize:16}}):c===`${o}-desc`?t.jsx(Qe,{sx:{fontSize:16}}):null;return n?t.jsx(Q,{maxWidth:"lg",children:t.jsx(D,{sx:{display:"flex",justifyContent:"center",mt:8},children:t.jsx(re,{})})}):t.jsxs(Q,{maxWidth:"lg",children:[t.jsxs(D,{sx:{mb:4},children:[t.jsx(f,{variant:"h3",gutterBottom:!0,fontWeight:"bold",color:"primary.main",children:"Search Items"}),t.jsx(f,{variant:"body1",color:"text.secondary",children:"Find items by name, keywords (candy, creamer, etc.), category, date, or store"})]}),t.jsx(pe,{onSearchChange:u,onFilterChange:p,onSortChange:g,hideSortDropdown:!0}),m.length>0&&t.jsx(D,{sx:{mb:2},children:t.jsx(f,{variant:"h6",color:"text.secondary",children:l||i.category!=="all"||i.dateRange!=="all"?`Found ${m.length} item${m.length!==1?"s":""}`:`${m.length} total item${m.length!==1?"s":""}`})}),w.length===0&&t.jsxs(O,{elevation:2,sx:{p:6,textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[t.jsx(_,{sx:{fontSize:64,color:"primary.light"}}),t.jsx(f,{variant:"h6",fontWeight:"600",children:"No Receipts Yet"}),t.jsx(f,{variant:"body1",color:"text.secondary",children:"Upload a receipt to start tracking your grocery items"})]}),w.length>0&&m.length===0&&(l||i.category!=="all"||i.dateRange!=="all")&&t.jsxs(O,{elevation:2,sx:{p:6,textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:[t.jsx(_,{sx:{fontSize:64,color:"text.disabled"}}),t.jsx(f,{variant:"h6",fontWeight:"600",children:"No Items Found"}),t.jsx(f,{variant:"body1",color:"text.secondary",children:"Try adjusting your search or filters"})]}),m.length>0&&t.jsx(Ue,{component:O,elevation:1,children:t.jsxs(Te,{children:[t.jsx(Le,{children:t.jsxs(Y,{sx:{bgcolor:"grey.50"},children:[t.jsx(j,{sx:{fontWeight:600},children:t.jsx(U,{size:"small",onClick:()=>E("name"),sx:{color:"inherit",fontWeight:600,textTransform:"none",minWidth:"auto",p:0,"&:hover":{bgcolor:"transparent",textDecoration:"underline"}},endIcon:L("name"),children:"Item"})}),t.jsx(j,{sx:{fontWeight:600},children:t.jsx(U,{size:"small",onClick:()=>E("store"),sx:{color:"inherit",fontWeight:600,textTransform:"none",minWidth:"auto",p:0,"&:hover":{bgcolor:"transparent",textDecoration:"underline"}},endIcon:L("store"),children:"Store"})}),t.jsx(j,{align:"center",sx:{fontWeight:600},children:"Qty"}),t.jsx(j,{align:"right",sx:{fontWeight:600},children:"Unit Price"}),t.jsx(j,{align:"right",sx:{fontWeight:600},children:t.jsx(U,{size:"small",onClick:()=>E("amount"),sx:{color:"inherit",fontWeight:600,textTransform:"none",minWidth:"auto",p:0,"&:hover":{bgcolor:"transparent",textDecoration:"underline"}},endIcon:L("amount"),children:"Total"})})]})}),t.jsx(Re,{children:m.map(o=>t.jsxs(Y,{sx:{"&:last-child td":{border:0},"&:hover":{bgcolor:"action.hover"}},children:[t.jsx(j,{children:t.jsxs(D,{children:[t.jsxs(D,{sx:{display:"flex",alignItems:"center",gap:.5,mb:.5},children:[t.jsx(f,{variant:"body2",sx:{fontWeight:500},children:o.name}),t.jsx(se,{size:"small",onClick:()=>A(o),sx:{ml:.5,padding:.5,color:"text.secondary","&:hover":{color:"primary.main"}},children:t.jsx(ue,{sx:{fontSize:16}})})]}),o.receiptText&&o.receiptText!==o.name&&t.jsxs(f,{variant:"caption",color:"text.secondary",sx:{display:"block",mb:.5},children:["Receipt: ",o.receiptText]}),t.jsx(ge,{label:o.category,size:"small",color:qe[o.category]||"default",sx:{height:20,fontSize:"0.7rem",textTransform:"capitalize"}})]})}),t.jsx(j,{children:t.jsxs(D,{children:[t.jsx(f,{variant:"body2",fontWeight:"600",color:"primary.main",children:o.receiptStore}),o.receiptLocation&&t.jsx(f,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:o.receiptLocation}),o.receiptDate&&t.jsx(f,{variant:"caption",color:"text.secondary",sx:{display:"block"},children:be(o.receiptDate.toDate(),"MMM d, yyyy")})]})}),t.jsx(j,{align:"center",children:o.quantity||1}),t.jsxs(j,{align:"right",children:["$",(o.unitPrice||0).toFixed(2)]}),t.jsxs(j,{align:"right",sx:{fontWeight:600},children:["$",(o.totalPrice||0).toFixed(2)]})]},o.itemId))})]})}),t.jsxs(xe,{open:b,onClose:P,maxWidth:"sm",fullWidth:!0,children:[t.jsx(he,{children:"Edit Item Name"}),t.jsx(fe,{children:t.jsx(D,{sx:{pt:1},children:t.jsx(me,{autoFocus:!0,fullWidth:!0,label:"Item Name",value:h,onChange:o=>T(o.target.value),onKeyPress:o=>{o.key==="Enter"&&N()},helperText:"Update the product name (e.g., 'Tillamook Ice Cream' instead of 'Tillamook Cheese')"})})}),t.jsxs(ye,{children:[t.jsx(U,{onClick:P,children:"Cancel"}),t.jsx(U,{onClick:N,variant:"contained",disabled:!h.trim(),children:"Save"})]})]}),t.jsx(ne,{open:k.open,autoHideDuration:4e3,onClose:()=>v({...k,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:t.jsx(ie,{onClose:()=>v({...k,open:!1}),severity:k.severity,variant:"filled",children:k.message})})]})}export{at as default};
