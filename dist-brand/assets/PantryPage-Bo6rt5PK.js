import{d as Pe,j as e,Q as Re,r as l,af as Te,ag as We,q as M,z as Ue,B as n,w as o,U as $,V as ae,W as f,ay as A,T as m,x,E as p,F as I,D as oe,at as Be,X as G,C as F,N as ne,M as ie,L as le,K as ce,J as de,I as xe,S as Ne,G as Me,l as u,p as me,n as Ge,o as Le,k as O,m as L}from"./index-CsiIu3XX.js";import{c as H,a as He}from"./geminiService-CitDXh9M.js";import{b as Ke}from"./pantryService-GjU_0mSh.js";import{C as K,a as pe}from"./CardContent-Cwpzu-y0.js";import{T as ge}from"./TextField-D1kGytsK.js";import{A as qe}from"./Add-D1EhQcfK.js";import{C as ue,U as Ye}from"./Upload-Du66gKw6.js";import{G as fe}from"./Grid-DXzofRRI.js";import{C as Je}from"./Chip-QOg_ts1l.js";import{E as he}from"./Edit-ihsG2UmY.js";import{D as Qe}from"./Delete-szcEwxXk.js";import{D as ye,a as be,b as je,c as ve}from"./DialogTitle-Bnfj9tVW.js";import{G as Xe,S as Ze,E as _e,B as Ve,A as et,L as tt,F as st,C as rt,I as at}from"./SetMeal-DcelBSPR.js";import{R as ot}from"./Receipt-M4nAHohi.js";import"./useFormControl-CaPw9b04.js";const nt=Pe(e.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}));function zt(){const{currentUser:h}=Re(),[g,Ie]=l.useState([]),[Se,q]=l.useState(!0),[S,Y]=l.useState(""),[P,J]=l.useState(!1),[y,R]=l.useState(!1),[T,Q]=l.useState(!1),[z,i]=l.useState({open:!1,message:"",severity:"info"}),[ze,W]=l.useState(!1),[C,U]=l.useState(null),[b,k]=l.useState(""),[j,X]=l.useState(!1),[Ce,w]=l.useState(!1),[D,Z]=l.useState(null),[E,B]=l.useState([]),_=l.useRef(null),V=l.useRef(null),ke=[{value:"produce",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Xe,{sx:{fontSize:16,color:o.main}})," Produce"]}),color:o.main},{value:"meat",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ze,{sx:{fontSize:16,color:F.main}})," Meat & Seafood"]}),color:F.main},{value:"dairy",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(_e,{sx:{fontSize:16,color:ne.main}})," Dairy & Eggs"]}),color:ne.main},{value:"bakery",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ve,{sx:{fontSize:16,color:p.main}})," Bakery"]}),color:p.main},{value:"frozen",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(et,{sx:{fontSize:16,color:ie.main}})," Frozen"]}),color:ie.main},{value:"pantry",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(A,{sx:{fontSize:16,color:le.main}})," Pantry"]}),color:le.main},{value:"beverages",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(tt,{sx:{fontSize:16,color:ce.main}})," Beverages"]}),color:ce.main},{value:"snacks",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(st,{sx:{fontSize:16,color:de.main}})," Snacks"]}),color:de.main},{value:"household",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(rt,{sx:{fontSize:16,color:I.main}})," Household"]}),color:I.main},{value:"other",label:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(at,{sx:{fontSize:16,color:I.main}})," Other"]}),color:I.main}];l.useEffect(()=>{if(!h)return;const t=Te(M(u,"pantry"),We("userId","==",h.uid)),s=Ue(t,r=>{const a=[];r.forEach(c=>{a.push({id:c.id,...c.data()})}),a.sort((c,d)=>{const v=c.createdAt?.toDate()||new Date(0);return(d.createdAt?.toDate()||new Date(0))-v}),Ie(a),q(!1)},r=>{console.error("Error fetching pantry:",r),q(!1)});return()=>s()},[h]);const ee=async()=>{if(!S.trim()){i({open:!0,message:"Please enter an item name",severity:"warning"});return}J(!0);try{const t=await H(S.trim());await me(M(u,"pantry"),{userId:h.uid,name:S.trim().toLowerCase(),category:t,source:"manual",createdAt:Ge()}),Y(""),i({open:!0,message:"Item added to pantry!",severity:"success"})}catch(t){console.error("Error adding item:",t),i({open:!0,message:"Failed to add item",severity:"error"})}finally{J(!1)}},te=async t=>{const s=t.target.files?.[0];if(s){R(!0);try{const r=new FileReader;r.onload=async a=>{const c=a.target.result.split(",")[1];try{const d=await He(c);if(d.length>0)try{const v=await Ke(h.uid,d);i({open:!0,message:`Found ${d.length} ingredient${d.length!==1?"s":""} and added ${v} to pantry!`,severity:"success"})}catch(v){console.error("Error adding to pantry:",v),i({open:!0,message:`Found ${d.length} ingredient${d.length!==1?"s":""}, but couldn't add to pantry`,severity:"warning"})}else i({open:!0,message:"No ingredients found in photo",severity:"info"})}catch(d){console.error("Error analyzing photo:",d),i({open:!0,message:d.message.includes("API")?"Please add your Gemini API key to use this feature":"Failed to analyze photo. Please try again.",severity:"error"})}finally{R(!1)}},r.readAsDataURL(s)}catch(r){console.error("Error reading file:",r),R(!1),i({open:!0,message:"Failed to read image file",severity:"error"})}}},we=t=>{Z(t),w(!0)},De=async()=>{if(D)try{const t={type:"delete",item:{...D},timestamp:Date.now()};B(s=>[t,...s].slice(0,30)),await Le(O(u,"pantry",D.id)),i({open:!0,message:"Item removed from pantry",severity:"success"})}catch(t){console.error("Error deleting item:",t),i({open:!0,message:"Failed to delete item",severity:"error"})}finally{w(!1),Z(null)}},Ee=t=>{U(t.id),k(t.name),W(!0)},se=async()=>{if(!(!C||!b.trim())){X(!0);try{const t=g.find(a=>a.id===C),s=await H(b.trim());await L(O(u,"pantry",C),{name:b.trim(),category:s});const r={type:"edit",itemId:C,oldData:{name:t.name,category:t.category},timestamp:Date.now()};B(a=>[r,...a].slice(0,30)),i({open:!0,message:"Item updated and recategorized successfully",severity:"success"}),W(!1),U(null),k("")}catch(t){console.error("Error updating item:",t),i({open:!0,message:"Failed to update item",severity:"error"})}finally{X(!1)}}},$e=async()=>{if(E.length===0)return;const[t,...s]=E;try{if(t.type==="delete"){const{item:r}=t,{id:a,...c}=r;await me(M(u,"pantry"),c),i({open:!0,message:`Restored: ${r.name}`,severity:"success"})}else t.type==="edit"&&(await L(O(u,"pantry",t.itemId),t.oldData),i({open:!0,message:"Edit undone",severity:"success"}));B(s)}catch(r){console.error("Error undoing operation:",r),i({open:!0,message:"Failed to undo",severity:"error"})}},re=()=>{W(!1),U(null),k("")},Ae=async()=>{const t=g.filter(a=>!a.category||a.category==="other");if(t.length===0){i({open:!0,message:"All items are already categorized!",severity:"info"});return}Q(!0);let s=0,r=0;try{for(const a of t)try{const c=await H(a.name);c&&c!=="other"?(await L(O(u,"pantry",a.id),{category:c}),s++):r++}catch(c){console.error(`Error recategorizing ${a.name}:`,c),r++}i({open:!0,message:`Recategorized ${s} items${r>0?`, ${r} remained as 'other'`:""}`,severity:s>0?"success":"info"})}catch(a){console.error("Error recategorizing items:",a),i({open:!0,message:"Failed to recategorize items",severity:"error"})}finally{Q(!1)}},N=g.reduce((t,s)=>{const r=s.category||"other";return t[r]||(t[r]=[]),t[r].push(s),t},{}),Fe=["produce","meat","dairy","bakery","frozen","pantry","beverages","snacks","household","other"].filter(t=>N[t]&&N[t].length>0),Oe=(t,s)=>{const a={receipt:ot,photo:ue,manual:he}[t]||A;return e.jsx(n,{sx:{display:"flex",alignItems:"center",justifyContent:"center",width:28,height:28,borderRadius:"6px",bgcolor:`${s}15`,border:`1.5px solid ${s}`},children:e.jsx(a,{sx:{fontSize:16,color:s}})})};return Se?e.jsx(n,{sx:{background:`linear-gradient(180deg, ${o.bg} 0%, ${$} 100%)`,minHeight:"100vh",pb:4},children:e.jsx(ae,{maxWidth:"lg",children:e.jsx(n,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(f,{size:60,sx:{color:o.main}})})})}):e.jsxs(n,{sx:{background:`linear-gradient(180deg, ${o.bg} 0%, ${$} 100%)`,minHeight:"100vh",pb:4},children:[e.jsxs(ae,{maxWidth:"lg",children:[e.jsxs(n,{sx:{pt:4,pb:3},children:[e.jsxs(n,{sx:{display:"flex",justifyContent:"space-between",alignItems:"start",mb:1},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(A,{sx:{fontSize:{xs:32,md:40},color:o.main}}),e.jsx(m,{variant:"h3",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,color:o.main,fontSize:{xs:"28px",md:"34px"}},children:"My Pantry"})]}),e.jsxs(n,{sx:{display:"flex",gap:1},children:[E.length>0&&e.jsxs(x,{size:"small",onClick:$e,startIcon:e.jsx(nt,{}),sx:{fontFamily:"Outfit, sans-serif",fontSize:"12px",textTransform:"none",color:p.main,border:`1px solid ${p.main}`,borderRadius:"8px",px:2,py:.75,"&:hover":{bgcolor:o.bg,border:`1px solid ${p.dark}`}},children:["Undo (",E.length,")"]}),g.length>0&&e.jsx(x,{size:"small",onClick:Ae,disabled:T,startIcon:T?e.jsx(f,{size:16}):null,sx:{fontFamily:"Outfit, sans-serif",fontSize:"12px",textTransform:"none",color:o.main,border:`1px solid ${o.main}`,borderRadius:"8px",px:2,py:.75,"&:hover":{bgcolor:o.bg,border:`1px solid ${o.dark}`},"&:disabled":{color:oe.light,border:`1px solid ${I.light}`}},children:e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Be,{sx:{fontSize:16}}),T?"Analyzing...":"AI Categorize"]})})]})]}),e.jsxs(m,{sx:{fontFamily:"Outfit, sans-serif",color:o.dark,fontSize:"16px"},children:["Your current inventory - ",g.length," item",g.length!==1?"s":""]})]}),e.jsx(K,{sx:{bgcolor:o.bg,borderRadius:"12px",border:`2px solid ${o.main}`,boxShadow:`3px 3px 0px ${o.light}`,mb:3},children:e.jsxs(pe,{sx:{p:2.5},children:[e.jsxs(n,{sx:{display:"flex",gap:1.5,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(ge,{placeholder:"Add item to pantry...",value:S,onChange:t=>Y(t.target.value),onKeyPress:t=>t.key==="Enter"&&ee(),disabled:P,sx:{flex:"1 1 250px","& .MuiOutlinedInput-root":{bgcolor:$,fontFamily:"Outfit, sans-serif"}}}),e.jsx(x,{variant:"contained",startIcon:P?e.jsx(f,{size:16}):e.jsx(qe,{}),onClick:ee,disabled:P,sx:{bgcolor:o.main,fontFamily:"Outfit, sans-serif",textTransform:"none",px:3,"&:hover":{bgcolor:o.dark}},children:"Add"}),e.jsx(x,{variant:"outlined",startIcon:y?e.jsx(f,{size:16}):e.jsx(ue,{}),onClick:()=>V.current?.click(),disabled:y,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:o.main,borderColor:o.main,px:2,"&:hover":{borderColor:o.dark,bgcolor:o.bg}},children:"Photo"}),e.jsx(x,{variant:"outlined",startIcon:y?e.jsx(f,{size:16}):e.jsx(Ye,{}),onClick:()=>_.current?.click(),disabled:y,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:o.main,borderColor:o.main,px:2,"&:hover":{borderColor:o.dark,bgcolor:o.bg}},children:"Upload"})]}),y&&e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mt:2},children:[e.jsx(f,{size:20,sx:{color:o.main}}),e.jsx(m,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",color:o.dark,fontSize:"13px"},children:"Analyzing photo..."})]}),e.jsx("input",{ref:V,type:"file",accept:"image/*",capture:"environment",style:{display:"none"},onChange:te}),e.jsx("input",{ref:_,type:"file",accept:"image/*",style:{display:"none"},onChange:te})]})}),g.length===0?e.jsxs(K,{sx:{bgcolor:p.bg,borderRadius:"16px",border:`2px solid ${p.main}`,boxShadow:`3px 3px 0px ${p.light}`,p:5,textAlign:"center"},children:[e.jsx(A,{sx:{fontSize:56,color:G.main,mb:2}}),e.jsx(m,{variant:"h5",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,color:G.main,mb:1,fontSize:"20px"},children:"Your Pantry is Empty"}),e.jsx(m,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",fontWeight:400,color:G.dark},children:"Add items manually, take a pantry photo, or upload receipts to build your inventory!"})]}):e.jsx(fe,{container:!0,spacing:2.5,children:Fe.map(t=>{const s=ke.find(a=>a.value===t),r=N[t];return e.jsx(fe,{item:!0,xs:12,sm:6,md:6,lg:4,children:e.jsx(K,{sx:{bgcolor:`${s.color}08`,borderRadius:"12px",border:`2px solid ${s.color}`,boxShadow:`3px 3px 0px ${s.color}30`,height:"100%"},children:e.jsxs(pe,{sx:{p:2.5},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(m,{variant:"h6",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,color:s.color,fontSize:"16px"},children:s.label}),e.jsx(Je,{label:r.length,size:"small",sx:{height:"20px",fontSize:"11px",fontFamily:"Outfit, sans-serif",bgcolor:`${s.color}15`,color:s.color,fontWeight:600}})]}),e.jsx(n,{sx:{display:"flex",flexDirection:"column",gap:1},children:r.map(a=>e.jsxs(n,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1,borderRadius:"8px",bgcolor:$,border:`1px solid ${s.color}25`,"&:hover":{bgcolor:`${s.color}10`}},children:[e.jsxs(n,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[Oe(a.source,s.color),e.jsx(m,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontSize:"13px",color:oe.dark,textTransform:"capitalize"},children:a.name})]}),e.jsx(xe,{size:"small",onClick:()=>Ee(a),sx:{color:s.color,p:.5,"&:hover":{bgcolor:`${s.color}15`}},children:e.jsx(he,{sx:{fontSize:16}})}),e.jsx(xe,{size:"small",onClick:()=>we(a),sx:{color:F.main,p:.5,"&:hover":{bgcolor:F.bg}},children:e.jsx(Qe,{sx:{fontSize:16}})})]},a.id))})]})})},t)})})]}),e.jsxs(ye,{open:Ce,onClose:()=>w(!1),maxWidth:"xs",fullWidth:!0,children:[e.jsx(be,{children:"Delete Item?"}),e.jsx(je,{children:e.jsxs(m,{children:["Are you sure you want to delete"," ",e.jsx("strong",{children:D?.name}),"? You can undo this action."]})}),e.jsxs(ve,{children:[e.jsx(x,{onClick:()=>w(!1),children:"Cancel"}),e.jsx(x,{onClick:De,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsxs(ye,{open:ze,onClose:re,maxWidth:"sm",fullWidth:!0,children:[e.jsx(be,{children:"Edit Item Name"}),e.jsx(je,{children:e.jsx(n,{sx:{pt:1},children:e.jsx(ge,{autoFocus:!0,fullWidth:!0,label:"Item Name",value:b,onChange:t=>k(t.target.value),onKeyPress:t=>{t.key==="Enter"&&!j&&se()},helperText:"Update the item name - will automatically recategorize with AI",disabled:j})})}),e.jsxs(ve,{children:[e.jsx(x,{onClick:re,disabled:j,children:"Cancel"}),e.jsx(x,{onClick:se,variant:"contained",disabled:!b.trim()||j,children:j?"Saving...":"Save"})]})]}),e.jsx(Ne,{open:z.open,autoHideDuration:4e3,onClose:()=>i({...z,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx(Me,{severity:z.severity,sx:{fontFamily:"Outfit, sans-serif"},children:z.message})})]})}export{zt as default};
