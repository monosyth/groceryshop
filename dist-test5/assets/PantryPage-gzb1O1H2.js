import{d as Ie,j as e,H as ze,r as l,ab as ke,ac as we,q as T,z as De,B as c,w as o,K as W,L as V,M as u,aw as ee,T as x,x as m,E as Ee,D as te,ar as Ae,I as re,S as Fe,F as $e,l as g,p as se,n as Oe,o as Pe,k as D,m as U}from"./index-C2G5Qrmf.js";import{c as N,a as Re}from"./geminiService-CitDXh9M.js";import{b as Te}from"./pantryService-yP5Ke4q3.js";import{d as We,a as Ue,c as Ne,i as Be,j as Le,h as He}from"./categoryStyles-C3wW_7yD.js";import{C as B,a as oe}from"./CardContent-D5eKlfp7.js";import{T as ne}from"./TextField-ETWgCp6-.js";import{A as Ge}from"./Add-DpEXkwoF.js";import{C as ae,U as Ke}from"./Upload-BGj_7kI8.js";import{G as ie}from"./Grid-CuLLcuhA.js";import{C as Me}from"./Chip-BJD8abz6.js";import{R as qe}from"./Receipt-5wn0UxAi.js";import{E as le}from"./Edit-BMOzjRBW.js";import{D as Ye}from"./Delete-CUcsfPkY.js";import{D as ce,a as de,b as me,c as xe}from"./DialogTitle-DhEsK6Gm.js";import"./useFormControl-BnHOaqgP.js";const Je=Ie(e.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}));function xt(){const{currentUser:f}=ze(),[p,pe]=l.useState([]),[ge,L]=l.useState(!0),[v,H]=l.useState(""),[E,G]=l.useState(!1),[h,A]=l.useState(!1),[F,K]=l.useState(!1),[C,i]=l.useState({open:!1,message:"",severity:"info"}),[ue,$]=l.useState(!1),[S,O]=l.useState(null),[y,I]=l.useState(""),[b,M]=l.useState(!1),[fe,z]=l.useState(!1),[k,q]=l.useState(null),[w,P]=l.useState([]),Y=l.useRef(null),J=l.useRef(null),he=We;l.useEffect(()=>{if(!f)return;const t=ke(T(g,"pantry"),we("userId","==",f.uid)),s=De(t,r=>{const a=[];r.forEach(n=>{a.push({id:n.id,...n.data()})}),a.sort((n,d)=>{const j=n.createdAt?.toDate()||new Date(0);return(d.createdAt?.toDate()||new Date(0))-j}),pe(a),L(!1)},r=>{console.error("Error fetching pantry:",r),L(!1)});return()=>s()},[f]);const Q=async()=>{if(!v.trim()){i({open:!0,message:"Please enter an item name",severity:"warning"});return}G(!0);try{const t=await N(v.trim());await se(T(g,"pantry"),{userId:f.uid,name:v.trim().toLowerCase(),category:t,source:"manual",createdAt:Oe()}),H(""),i({open:!0,message:"Item added to pantry!",severity:"success"})}catch(t){console.error("Error adding item:",t),i({open:!0,message:"Failed to add item",severity:"error"})}finally{G(!1)}},X=async t=>{const s=t.target.files?.[0];if(s){A(!0);try{const r=new FileReader;r.onload=async a=>{const n=a.target.result.split(",")[1];try{const d=await Re(n);if(d.length>0)try{const j=await Te(f.uid,d);i({open:!0,message:`Found ${d.length} ingredient${d.length!==1?"s":""} and added ${j} to pantry!`,severity:"success"})}catch(j){console.error("Error adding to pantry:",j),i({open:!0,message:`Found ${d.length} ingredient${d.length!==1?"s":""}, but couldn't add to pantry`,severity:"warning"})}else i({open:!0,message:"No ingredients found in photo",severity:"info"})}catch(d){console.error("Error analyzing photo:",d),i({open:!0,message:d.message.includes("API")?"Please add your Gemini API key to use this feature":"Failed to analyze photo. Please try again.",severity:"error"})}finally{A(!1)}},r.readAsDataURL(s)}catch(r){console.error("Error reading file:",r),A(!1),i({open:!0,message:"Failed to read image file",severity:"error"})}}},ye=t=>{q(t),z(!0)},be=async()=>{if(k)try{const t={type:"delete",item:{...k},timestamp:Date.now()};P(s=>[t,...s].slice(0,30)),await Pe(D(g,"pantry",k.id)),i({open:!0,message:"Item removed from pantry",severity:"success"})}catch(t){console.error("Error deleting item:",t),i({open:!0,message:"Failed to delete item",severity:"error"})}finally{z(!1),q(null)}},je=t=>{O(t.id),I(t.name),$(!0)},Z=async()=>{if(!(!S||!y.trim())){M(!0);try{const t=p.find(a=>a.id===S),s=await N(y.trim());await U(D(g,"pantry",S),{name:y.trim(),category:s});const r={type:"edit",itemId:S,oldData:{name:t.name,category:t.category},timestamp:Date.now()};P(a=>[r,...a].slice(0,30)),i({open:!0,message:"Item updated and recategorized successfully",severity:"success"}),$(!1),O(null),I("")}catch(t){console.error("Error updating item:",t),i({open:!0,message:"Failed to update item",severity:"error"})}finally{M(!1)}}},ve=async()=>{if(w.length===0)return;const[t,...s]=w;try{if(t.type==="delete"){const{item:r}=t,{id:a,...n}=r;await se(T(g,"pantry"),n),i({open:!0,message:`Restored: ${r.name}`,severity:"success"})}else t.type==="edit"&&(await U(D(g,"pantry",t.itemId),t.oldData),i({open:!0,message:"Edit undone",severity:"success"}));P(s)}catch(r){console.error("Error undoing operation:",r),i({open:!0,message:"Failed to undo",severity:"error"})}},_=()=>{$(!1),O(null),I("")},Ce=async()=>{const t=p.filter(a=>!a.category||a.category==="other");if(t.length===0){i({open:!0,message:"All items are already categorized!",severity:"info"});return}K(!0);let s=0,r=0;try{for(const a of t)try{const n=await N(a.name);n&&n!=="other"?(await U(D(g,"pantry",a.id),{category:n}),s++):r++}catch(n){console.error(`Error recategorizing ${a.name}:`,n),r++}i({open:!0,message:`Recategorized ${s} items${r>0?`, ${r} remained as 'other'`:""}`,severity:s>0?"success":"info"})}catch(a){console.error("Error recategorizing items:",a),i({open:!0,message:"Failed to recategorize items",severity:"error"})}finally{K(!1)}},R=p.reduce((t,s)=>{const r=s.category||"other";return t[r]||(t[r]=[]),t[r].push(s),t},{}),Se=["produce","meat","dairy","bakery","frozen","pantry","beverages","snacks","household","other"].filter(t=>R[t]&&R[t].length>0);return ge?e.jsx(c,{sx:{background:`linear-gradient(180deg, ${o.bg} 0%, ${W} 100%)`,minHeight:"100vh",pb:4},children:e.jsx(V,{maxWidth:"lg",children:e.jsx(c,{sx:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"60vh"},children:e.jsx(u,{size:60,sx:{color:o.main}})})})}):e.jsxs(c,{sx:{background:`linear-gradient(180deg, ${o.bg} 0%, ${W} 100%)`,minHeight:"100vh",pb:4},children:[e.jsxs(V,{maxWidth:"lg",children:[e.jsxs(c,{sx:{pt:4,pb:3},children:[e.jsxs(c,{sx:{display:"flex",justifyContent:"space-between",alignItems:"start",mb:1},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsx(ee,{sx:{fontSize:{xs:32,md:40},color:o.main}}),e.jsx(x,{variant:"h3",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,color:o.main,fontSize:{xs:"28px",md:"34px"}},children:"My Pantry"})]}),e.jsxs(c,{sx:{display:"flex",gap:1},children:[w.length>0&&e.jsxs(m,{size:"small",onClick:ve,startIcon:e.jsx(Je,{}),sx:{fontFamily:"Outfit, sans-serif",fontSize:"12px",textTransform:"none",color:amber.main,border:`1px solid ${amber.main}`,borderRadius:"8px",px:2,py:.75,"&:hover":{bgcolor:o.bg,border:`1px solid ${amber.dark}`}},children:["Undo (",w.length,")"]}),p.length>0&&e.jsx(m,{size:"small",onClick:Ce,disabled:F,startIcon:F?e.jsx(u,{size:16}):null,sx:{fontFamily:"Outfit, sans-serif",fontSize:"12px",textTransform:"none",color:o.main,border:`1px solid ${o.main}`,borderRadius:"8px",px:2,py:.75,"&:hover":{bgcolor:o.bg,border:`1px solid ${o.dark}`},"&:disabled":{color:te.light,border:`1px solid ${Ee.light}`}},children:e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(Ae,{sx:{fontSize:16}}),F?"Analyzing...":"AI Categorize"]})})]})]}),e.jsxs(x,{sx:{fontFamily:"Outfit, sans-serif",color:o.dark,fontSize:"16px"},children:["Your current inventory - ",p.length," item",p.length!==1?"s":""]})]}),e.jsx(B,{sx:{bgcolor:o.bg,borderRadius:"12px",border:`2px solid ${o.main}`,boxShadow:`3px 3px 0px ${o.light}`,mb:3},children:e.jsxs(oe,{sx:{p:2.5},children:[e.jsxs(c,{sx:{display:"flex",gap:1.5,alignItems:"center",flexWrap:"wrap"},children:[e.jsx(ne,{placeholder:"Add item to pantry...",value:v,onChange:t=>H(t.target.value),onKeyPress:t=>t.key==="Enter"&&Q(),disabled:E,sx:{flex:"1 1 250px","& .MuiOutlinedInput-root":{bgcolor:W,fontFamily:"Outfit, sans-serif"}}}),e.jsx(m,{variant:"contained",startIcon:E?e.jsx(u,{size:16}):e.jsx(Ge,{}),onClick:Q,disabled:E,sx:{bgcolor:o.main,fontFamily:"Outfit, sans-serif",textTransform:"none",px:3,"&:hover":{bgcolor:o.dark}},children:"Add"}),e.jsx(m,{variant:"outlined",startIcon:h?e.jsx(u,{size:16}):e.jsx(ae,{}),onClick:()=>J.current?.click(),disabled:h,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:o.main,borderColor:o.main,px:2,"&:hover":{borderColor:o.dark,bgcolor:o.bg}},children:"Photo"}),e.jsx(m,{variant:"outlined",startIcon:h?e.jsx(u,{size:16}):e.jsx(Ke,{}),onClick:()=>Y.current?.click(),disabled:h,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:o.main,borderColor:o.main,px:2,"&:hover":{borderColor:o.dark,bgcolor:o.bg}},children:"Upload"})]}),h&&e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,mt:2},children:[e.jsx(u,{size:20,sx:{color:o.main}}),e.jsx(x,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",color:o.dark,fontSize:"13px"},children:"Analyzing photo..."})]}),e.jsx("input",{ref:J,type:"file",accept:"image/*",capture:"environment",style:{display:"none"},onChange:X}),e.jsx("input",{ref:Y,type:"file",accept:"image/*",style:{display:"none"},onChange:X})]})}),p.length===0?e.jsxs(B,{sx:{bgcolor:amber.bg,borderRadius:"16px",border:`2px solid ${amber.main}`,boxShadow:`3px 3px 0px ${amber.light}`,p:5,textAlign:"center"},children:[e.jsx(ee,{sx:{fontSize:56,color:brown.main,mb:2}}),e.jsx(x,{variant:"h5",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,color:brown.main,mb:1,fontSize:"20px"},children:"Your Pantry is Empty"}),e.jsx(x,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",fontWeight:400,color:brown.dark},children:"Add items manually, take a pantry photo, or upload receipts to build your inventory!"})]}):e.jsx(ie,{container:!0,spacing:2.5,children:Se.map(t=>{const s=he.find(n=>n.value===t),r=R[t],a=s.icon;return e.jsx(ie,{item:!0,xs:12,sm:6,md:6,lg:4,children:e.jsx(B,{sx:He(t),children:e.jsxs(oe,{sx:{p:2.5},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[e.jsx(a,{sx:{fontSize:20,color:s.color}}),e.jsx(x,{variant:"h6",sx:Ue(t),children:s.label}),e.jsx(Me,{label:r.length,size:"small",sx:Ne(t)})]}),e.jsx(c,{sx:{display:"flex",flexDirection:"column",gap:1},children:r.map(n=>e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",...Le(t)},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[e.jsx(c,{sx:Be(s.color),children:n.source==="receipt"?e.jsx(qe,{sx:{fontSize:16,color:s.color}}):n.source==="photo"?e.jsx(ae,{sx:{fontSize:16,color:s.color}}):e.jsx(le,{sx:{fontSize:16,color:s.color}})}),e.jsx(x,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontSize:"13px",color:te.dark,textTransform:"capitalize"},children:n.name})]}),e.jsx(re,{size:"small",onClick:()=>je(n),sx:{color:s.color,p:.5,"&:hover":{bgcolor:`${s.color}15`}},children:e.jsx(le,{sx:{fontSize:16}})}),e.jsx(re,{size:"small",onClick:()=>ye(n),sx:{color:red.main,p:.5,"&:hover":{bgcolor:red.bg}},children:e.jsx(Ye,{sx:{fontSize:16}})})]},n.id))})]})})},t)})})]}),e.jsxs(ce,{open:fe,onClose:()=>z(!1),maxWidth:"xs",fullWidth:!0,children:[e.jsx(de,{children:"Delete Item?"}),e.jsx(me,{children:e.jsxs(x,{children:["Are you sure you want to delete"," ",e.jsx("strong",{children:k?.name}),"? You can undo this action."]})}),e.jsxs(xe,{children:[e.jsx(m,{onClick:()=>z(!1),children:"Cancel"}),e.jsx(m,{onClick:be,color:"error",variant:"contained",children:"Delete"})]})]}),e.jsxs(ce,{open:ue,onClose:_,maxWidth:"sm",fullWidth:!0,children:[e.jsx(de,{children:"Edit Item Name"}),e.jsx(me,{children:e.jsx(c,{sx:{pt:1},children:e.jsx(ne,{autoFocus:!0,fullWidth:!0,label:"Item Name",value:y,onChange:t=>I(t.target.value),onKeyPress:t=>{t.key==="Enter"&&!b&&Z()},helperText:"Update the item name - will automatically recategorize with AI",disabled:b})})}),e.jsxs(xe,{children:[e.jsx(m,{onClick:_,disabled:b,children:"Cancel"}),e.jsx(m,{onClick:Z,variant:"contained",disabled:!y.trim()||b,children:b?"Saving...":"Save"})]})]}),e.jsx(Fe,{open:C.open,autoHideDuration:4e3,onClose:()=>i({...C,open:!1}),anchorOrigin:{vertical:"bottom",horizontal:"center"},children:e.jsx($e,{severity:C.severity,sx:{fontFamily:"Outfit, sans-serif"},children:C.message})})]})}export{xt as default};
