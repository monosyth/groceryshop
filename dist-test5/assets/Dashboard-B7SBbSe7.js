import{g as ir,a as sr,r as te,u as lr,j as g,c as cr,b as fr,s as dr,d as mt,e as Et,f as Rt,h as ur,i as hr,k as Me,l as Se,m as et,n as Qe,o as Ut,p as kt,q as Dt,t as pr,v as vt,B as V,w as G,T as Y,A as zt,x as ve,y as Oe,z as mr,I as Ke,C as ct,D as He,P as ze,E as Le,S as Tt,F as Mt,G as gr,H as xr,J as yr,K as Ee,L as br,M as ft,N as qe}from"./index-C2G5Qrmf.js";import{A as vr,a as wr,M as wt,C as Ar,S as Ot,f as _t,b as Be}from"./formatters-DS1nVdG3.js";import{a as Cr}from"./pantryService-yP5Ke4q3.js";import{C as Pt,a as Lt}from"./CardContent-D5eKlfp7.js";import{C as Wt}from"./Chip-BJD8abz6.js";import{R as Sr}from"./Refresh-C4L8ImQN.js";import{S as Pe,L as jr,a as At}from"./ShoppingBag-DtZdHFHk.js";import{C as Ir}from"./CheckCircle-B3gvX_wz.js";import{g as Ht,a as $t,b as Nt,c as Fr}from"./categoryStyles-C3wW_7yD.js";import{c as Er}from"./geminiService-CitDXh9M.js";import{D as Ze,a as Ye,b as Xe,c as ht}from"./DialogTitle-DhEsK6Gm.js";import{D as Ct}from"./Delete-CUcsfPkY.js";import{C as Rr}from"./Close-DPoyDy28.js";import{S as St,a as Ur}from"./SearchBar-CSvzaYls.js";import{D as pt}from"./Divider-DVDlCoNV.js";import{E as Bt}from"./Edit-BMOzjRBW.js";import{T as Qt}from"./TextField-ETWgCp6-.js";import{R as dt}from"./Receipt-5wn0UxAi.js";import{C as kr,U as Dr}from"./Upload-BGj_7kI8.js";import{G as Ve}from"./Grid-CuLLcuhA.js";import{f as zr}from"./format-BNZNg-GV.js";import"./InputAdornment-C7qIAF2n.js";import"./useFormControl-BnHOaqgP.js";function Tr(j){return ir("MuiCardMedia",j)}sr("MuiCardMedia",["root","media","img"]);const Mr=j=>{const{classes:S,isMediaComponent:U,isImageComponent:f}=j;return fr({root:["root",U&&"media",f&&"img"]},Tr,S)},Or=dr("div",{name:"MuiCardMedia",slot:"Root",overridesResolver:(j,S)=>{const{ownerState:U}=j,{isMediaComponent:f,isImageComponent:e}=U;return[S.root,f&&S.media,e&&S.img]}})({display:"block",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center",variants:[{props:{isMediaComponent:!0},style:{width:"100%"}},{props:{isImageComponent:!0},style:{objectFit:"cover"}}]}),_r=["video","audio","picture","iframe","img"],Pr=["picture","img"],Lr=te.forwardRef(function(S,U){const f=lr({props:S,name:"MuiCardMedia"}),{children:e,className:t,component:d="div",image:a,src:p,style:y,...n}=f,o=_r.includes(d),r=!o&&a?{backgroundImage:`url("${a}")`,...y}:y,s={...f,component:d,isMediaComponent:o,isImageComponent:Pr.includes(d)},h=Mr(s);return g.jsx(Or,{className:cr(h.root,t),as:d,role:!o&&a?"img":void 0,ref:U,style:r,ownerState:s,src:o?a||p:void 0,...n,children:e})}),Gt=mt(g.jsx("path",{d:"M20 3h-1V1h-2v2H7V1H5v2H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2m0 18H4V8h16z"})),jt=mt(g.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"})),It=mt(g.jsx("path",{d:"M6 2v6h.01L6 8.01 10 12l-4 4 .01.01H6V22h12v-5.99h-.01L18 16l-4-4 4-3.99-.01-.01H18V2zm10 14.5V20H8v-3.5l4-4zm-4-5-4-4V4h8v3.5z"})),Wr=(j,S,U)=>({userId:j,imageUrl:S,imagePath:U,storeInfo:{name:"",location:null,date:null},items:[],summary:{subtotal:0,tax:0,total:0},metadata:{analysisStatus:vr.PENDING,processedAt:null,processingError:null,geminiFeedback:null},tags:[],notes:"",createdAt:new Date,updatedAt:new Date}),Hr=j=>{const S=[];return j.userId||S.push("User ID is required"),j.imageUrl||S.push("Image URL is required"),j.imagePath||S.push("Image path is required"),j.summary&&(typeof j.summary.total!="number"&&S.push("Total must be a number"),j.summary.total<0&&S.push("Total cannot be negative")),j.items&&Array.isArray(j.items)&&j.items.forEach((U,f)=>{U.name||S.push(`Item ${f+1}: name is required`),typeof U.totalPrice!="number"&&S.push(`Item ${f+1}: totalPrice must be a number`)}),{valid:S.length===0,errors:S}};function $r(j,S){return S.forEach((function(U){U&&typeof U!="string"&&!Array.isArray(U)&&Object.keys(U).forEach((function(f){if(f!=="default"&&!(f in j)){var e=Object.getOwnPropertyDescriptor(U,f);Object.defineProperty(j,f,e.get?e:{enumerable:!0,get:function(){return U[f]}})}}))})),Object.freeze(j)}function qt(j,S){return new Promise((function(U,f){let e;return Nr(j).then((function(t){try{return e=t,U(new Blob([S.slice(0,2),e,S.slice(2)],{type:"image/jpeg"}))}catch(d){return f(d)}}),f)}))}const Nr=j=>new Promise(((S,U)=>{const f=new FileReader;f.addEventListener("load",(({target:{result:e}})=>{const t=new DataView(e);let d=0;if(t.getUint16(d)!==65496)return U("not a valid JPEG");for(d+=2;;){const a=t.getUint16(d);if(a===65498)break;const p=t.getUint16(d+2);if(a===65505&&t.getUint32(d+4)===1165519206){const y=d+10;let n;switch(t.getUint16(y)){case 18761:n=!0;break;case 19789:n=!1;break;default:return U("TIFF header contains invalid endian")}if(t.getUint16(y+2,n)!==42)return U("TIFF header contains invalid version");const o=t.getUint32(y+4,n),r=y+o+2+12*t.getUint16(y+o,n);for(let s=y+o+2;s<r;s+=12)if(t.getUint16(s,n)==274){if(t.getUint16(s+2,n)!==3)return U("Orientation data type is invalid");if(t.getUint32(s+4,n)!==1)return U("Orientation data count is invalid");t.setUint16(s+8,1,n);break}return S(e.slice(d,d+2+p))}d+=2+p}return S(new Blob)})),f.readAsArrayBuffer(j)}));var tt={},Br={get exports(){return tt},set exports(j){tt=j}};(function(j){var S,U,f={};Br.exports=f,f.parse=function(e,t){for(var d=f.bin.readUshort,a=f.bin.readUint,p=0,y={},n=new Uint8Array(e),o=n.length-4;a(n,o)!=101010256;)o--;p=o,p+=4;var r=d(n,p+=4);d(n,p+=2);var s=a(n,p+=2),h=a(n,p+=4);p+=4,p=h;for(var I=0;I<r;I++){a(n,p),p+=4,p+=4,p+=4,a(n,p+=4),s=a(n,p+=4);var k=a(n,p+=4),b=d(n,p+=4),P=d(n,p+2),D=d(n,p+4);p+=6;var R=a(n,p+=8);p+=4,p+=b+P+D,f._readLocal(n,R,y,s,k,t)}return y},f._readLocal=function(e,t,d,a,p,y){var n=f.bin.readUshort,o=f.bin.readUint;o(e,t),n(e,t+=4),n(e,t+=2);var r=n(e,t+=2);o(e,t+=2),o(e,t+=4),t+=4;var s=n(e,t+=8),h=n(e,t+=2);t+=2;var I=f.bin.readUTF8(e,t,s);if(t+=s,t+=h,y)d[I]={size:p,csize:a};else{var k=new Uint8Array(e.buffer,t);if(r==0)d[I]=new Uint8Array(k.buffer.slice(t,t+a));else{if(r!=8)throw"unknown compression method: "+r;var b=new Uint8Array(p);f.inflateRaw(k,b),d[I]=b}}},f.inflateRaw=function(e,t){return f.F.inflate(e,t)},f.inflate=function(e,t){return e[0],e[1],f.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-6),t)},f.deflate=function(e,t){t==null&&(t={level:6});var d=0,a=new Uint8Array(50+Math.floor(1.1*e.length));a[d]=120,a[d+1]=156,d+=2,d=f.F.deflateRaw(e,a,d,t.level);var p=f.adler(e,0,e.length);return a[d+0]=p>>>24&255,a[d+1]=p>>>16&255,a[d+2]=p>>>8&255,a[d+3]=p>>>0&255,new Uint8Array(a.buffer,0,d+4)},f.deflateRaw=function(e,t){t==null&&(t={level:6});var d=new Uint8Array(50+Math.floor(1.1*e.length)),a=f.F.deflateRaw(e,d,a,t.level);return new Uint8Array(d.buffer,0,a)},f.encode=function(e,t){t==null&&(t=!1);var d=0,a=f.bin.writeUint,p=f.bin.writeUshort,y={};for(var n in e){var o=!f._noNeed(n)&&!t,r=e[n],s=f.crc.crc(r,0,r.length);y[n]={cpr:o,usize:r.length,crc:s,file:o?f.deflateRaw(r):r}}for(var n in y)d+=y[n].file.length+30+46+2*f.bin.sizeUTF8(n);d+=22;var h=new Uint8Array(d),I=0,k=[];for(var n in y){var b=y[n];k.push(I),I=f._writeHeader(h,I,n,b,0)}var P=0,D=I;for(var n in y)b=y[n],k.push(I),I=f._writeHeader(h,I,n,b,1,k[P++]);var R=I-D;return a(h,I,101010256),I+=4,p(h,I+=4,P),p(h,I+=2,P),a(h,I+=2,R),a(h,I+=4,D),I+=4,I+=2,h.buffer},f._noNeed=function(e){var t=e.split(".").pop().toLowerCase();return"png,jpg,jpeg,zip".indexOf(t)!=-1},f._writeHeader=function(e,t,d,a,p,y){var n=f.bin.writeUint,o=f.bin.writeUshort,r=a.file;return n(e,t,p==0?67324752:33639248),t+=4,p==1&&(t+=2),o(e,t,20),o(e,t+=2,0),o(e,t+=2,a.cpr?8:0),n(e,t+=2,0),n(e,t+=4,a.crc),n(e,t+=4,r.length),n(e,t+=4,a.usize),o(e,t+=4,f.bin.sizeUTF8(d)),o(e,t+=2,0),t+=2,p==1&&(t+=2,t+=2,n(e,t+=6,y),t+=4),t+=f.bin.writeUTF8(e,t,d),p==0&&(e.set(r,t),t+=r.length),t},f.crc={table:(function(){for(var e=new Uint32Array(256),t=0;t<256;t++){for(var d=t,a=0;a<8;a++)1&d?d=3988292384^d>>>1:d>>>=1;e[t]=d}return e})(),update:function(e,t,d,a){for(var p=0;p<a;p++)e=f.crc.table[255&(e^t[d+p])]^e>>>8;return e},crc:function(e,t,d){return 4294967295^f.crc.update(4294967295,e,t,d)}},f.adler=function(e,t,d){for(var a=1,p=0,y=t,n=t+d;y<n;){for(var o=Math.min(y+5552,n);y<o;)p+=a+=e[y++];a%=65521,p%=65521}return p<<16|a},f.bin={readUshort:function(e,t){return e[t]|e[t+1]<<8},writeUshort:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255},readUint:function(e,t){return 16777216*e[t+3]+(e[t+2]<<16|e[t+1]<<8|e[t])},writeUint:function(e,t,d){e[t]=255&d,e[t+1]=d>>8&255,e[t+2]=d>>16&255,e[t+3]=d>>24&255},readASCII:function(e,t,d){for(var a="",p=0;p<d;p++)a+=String.fromCharCode(e[t+p]);return a},writeASCII:function(e,t,d){for(var a=0;a<d.length;a++)e[t+a]=d.charCodeAt(a)},pad:function(e){return e.length<2?"0"+e:e},readUTF8:function(e,t,d){for(var a,p="",y=0;y<d;y++)p+="%"+f.bin.pad(e[t+y].toString(16));try{a=decodeURIComponent(p)}catch{return f.bin.readASCII(e,t,d)}return a},writeUTF8:function(e,t,d){for(var a=d.length,p=0,y=0;y<a;y++){var n=d.charCodeAt(y);if((4294967168&n)==0)e[t+p]=n,p++;else if((4294965248&n)==0)e[t+p]=192|n>>6,e[t+p+1]=128|n>>0&63,p+=2;else if((4294901760&n)==0)e[t+p]=224|n>>12,e[t+p+1]=128|n>>6&63,e[t+p+2]=128|n>>0&63,p+=3;else{if((4292870144&n)!=0)throw"e";e[t+p]=240|n>>18,e[t+p+1]=128|n>>12&63,e[t+p+2]=128|n>>6&63,e[t+p+3]=128|n>>0&63,p+=4}}return p},sizeUTF8:function(e){for(var t=e.length,d=0,a=0;a<t;a++){var p=e.charCodeAt(a);if((4294967168&p)==0)d++;else if((4294965248&p)==0)d+=2;else if((4294901760&p)==0)d+=3;else{if((4292870144&p)!=0)throw"e";d+=4}}return d}},f.F={},f.F.deflateRaw=function(e,t,d,a){var p=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][a],y=f.F.U,n=f.F._goodIndex;f.F._hash;var o=f.F._putsE,r=0,s=d<<3,h=0,I=e.length;if(a==0){for(;r<I;)o(t,s,r+(A=Math.min(65535,I-r))==I?1:0),s=f.F._copyExact(e,r,A,t,s+8),r+=A;return s>>>3}var k=y.lits,b=y.strt,P=y.prev,D=0,R=0,O=0,m=0,z=0,c=0;for(I>2&&(b[c=f.F._hash(e,0)]=0),r=0;r<I;r++){if(z=c,r+1<I-2){c=f.F._hash(e,r+1);var u=r+1&32767;P[u]=b[c],b[c]=u}if(h<=r){(D>14e3||R>26697)&&I-r>100&&(h<r&&(k[D]=r-h,D+=2,h=r),s=f.F._writeBlock(r==I-1||h==I?1:0,k,D,m,e,O,r-O,t,s),D=R=m=0,O=r);var v=0;r<I-2&&(v=f.F._bestMatch(e,r,P,z,Math.min(p[2],I-r),p[3]));var A=v>>>16,w=65535&v;if(v!=0){w=65535&v;var F=n(A=v>>>16,y.of0);y.lhst[257+F]++;var x=n(w,y.df0);y.dhst[x]++,m+=y.exb[F]+y.dxb[x],k[D]=A<<23|r-h,k[D+1]=w<<16|F<<8|x,D+=2,h=r+A}else y.lhst[e[r]]++;R++}}for(O==r&&e.length!=0||(h<r&&(k[D]=r-h,D+=2,h=r),s=f.F._writeBlock(1,k,D,m,e,O,r-O,t,s),D=0,R=0,D=R=m=0,O=r);(7&s)!=0;)s++;return s>>>3},f.F._bestMatch=function(e,t,d,a,p,y){var n=32767&t,o=d[n],r=n-o+32768&32767;if(o==n||a!=f.F._hash(e,t-r))return 0;for(var s=0,h=0,I=Math.min(32767,t);r<=I&&--y!=0&&o!=n;){if(s==0||e[t+s]==e[t+s-r]){var k=f.F._howLong(e,t,r);if(k>s){if(h=r,(s=k)>=p)break;r+2<k&&(k=r+2);for(var b=0,P=0;P<k-2;P++){var D=t-r+P+32768&32767,R=D-d[D]+32768&32767;R>b&&(b=R,o=D)}}}r+=(n=o)-(o=d[n])+32768&32767}return s<<16|h},f.F._howLong=function(e,t,d){if(e[t]!=e[t-d]||e[t+1]!=e[t+1-d]||e[t+2]!=e[t+2-d])return 0;var a=t,p=Math.min(e.length,t+258);for(t+=3;t<p&&e[t]==e[t-d];)t++;return t-a},f.F._hash=function(e,t){return(e[t]<<8|e[t+1])+(e[t+2]<<4)&65535},f.saved=0,f.F._writeBlock=function(e,t,d,a,p,y,n,o,r){var s,h,I,k,b,P,D,R,O,m=f.F.U,z=f.F._putsF,c=f.F._putsE;m.lhst[256]++,h=(s=f.F.getTrees())[0],I=s[1],k=s[2],b=s[3],P=s[4],D=s[5],R=s[6],O=s[7];var u=32+((r+3&7)==0?0:8-(r+3&7))+(n<<3),v=a+f.F.contSize(m.fltree,m.lhst)+f.F.contSize(m.fdtree,m.dhst),A=a+f.F.contSize(m.ltree,m.lhst)+f.F.contSize(m.dtree,m.dhst);A+=14+3*D+f.F.contSize(m.itree,m.ihst)+(2*m.ihst[16]+3*m.ihst[17]+7*m.ihst[18]);for(var w=0;w<286;w++)m.lhst[w]=0;for(w=0;w<30;w++)m.dhst[w]=0;for(w=0;w<19;w++)m.ihst[w]=0;var F=u<v&&u<A?0:v<A?1:2;if(z(o,r,e),z(o,r+1,F),r+=3,F==0){for(;(7&r)!=0;)r++;r=f.F._copyExact(p,y,n,o,r)}else{var x,C;if(F==1&&(x=m.fltree,C=m.fdtree),F==2){f.F.makeCodes(m.ltree,h),f.F.revCodes(m.ltree,h),f.F.makeCodes(m.dtree,I),f.F.revCodes(m.dtree,I),f.F.makeCodes(m.itree,k),f.F.revCodes(m.itree,k),x=m.ltree,C=m.dtree,c(o,r,b-257),c(o,r+=5,P-1),c(o,r+=5,D-4),r+=4;for(var l=0;l<D;l++)c(o,r+3*l,m.itree[1+(m.ordr[l]<<1)]);r+=3*D,r=f.F._codeTiny(R,m.itree,o,r),r=f.F._codeTiny(O,m.itree,o,r)}for(var i=y,M=0;M<d;M+=2){for(var E=t[M],_=E>>>23,N=i+(8388607&E);i<N;)r=f.F._writeLit(p[i++],x,o,r);if(_!=0){var $=t[M+1],Q=$>>16,H=$>>8&255,T=255&$;c(o,r=f.F._writeLit(257+H,x,o,r),_-m.of0[H]),r+=m.exb[H],z(o,r=f.F._writeLit(T,C,o,r),Q-m.df0[T]),r+=m.dxb[T],i+=_}}r=f.F._writeLit(256,x,o,r)}return r},f.F._copyExact=function(e,t,d,a,p){var y=p>>>3;return a[y]=d,a[y+1]=d>>>8,a[y+2]=255-a[y],a[y+3]=255-a[y+1],y+=4,a.set(new Uint8Array(e.buffer,t,d),y),p+(d+4<<3)},f.F.getTrees=function(){for(var e=f.F.U,t=f.F._hufTree(e.lhst,e.ltree,15),d=f.F._hufTree(e.dhst,e.dtree,15),a=[],p=f.F._lenCodes(e.ltree,a),y=[],n=f.F._lenCodes(e.dtree,y),o=0;o<a.length;o+=2)e.ihst[a[o]]++;for(o=0;o<y.length;o+=2)e.ihst[y[o]]++;for(var r=f.F._hufTree(e.ihst,e.itree,7),s=19;s>4&&e.itree[1+(e.ordr[s-1]<<1)]==0;)s--;return[t,d,r,p,n,s,a,y]},f.F.getSecond=function(e){for(var t=[],d=0;d<e.length;d+=2)t.push(e[d+1]);return t},f.F.nonZero=function(e){for(var t="",d=0;d<e.length;d+=2)e[d+1]!=0&&(t+=(d>>1)+",");return t},f.F.contSize=function(e,t){for(var d=0,a=0;a<t.length;a++)d+=t[a]*e[1+(a<<1)];return d},f.F._codeTiny=function(e,t,d,a){for(var p=0;p<e.length;p+=2){var y=e[p],n=e[p+1];a=f.F._writeLit(y,t,d,a);var o=y==16?2:y==17?3:7;y>15&&(f.F._putsE(d,a,n,o),a+=o)}return a},f.F._lenCodes=function(e,t){for(var d=e.length;d!=2&&e[d-1]==0;)d-=2;for(var a=0;a<d;a+=2){var p=e[a+1],y=a+3<d?e[a+3]:-1,n=a+5<d?e[a+5]:-1,o=a==0?-1:e[a-1];if(p==0&&y==p&&n==p){for(var r=a+5;r+2<d&&e[r+2]==p;)r+=2;(s=Math.min(r+1-a>>>1,138))<11?t.push(17,s-3):t.push(18,s-11),a+=2*s-2}else if(p==o&&y==p&&n==p){for(r=a+5;r+2<d&&e[r+2]==p;)r+=2;var s=Math.min(r+1-a>>>1,6);t.push(16,s-3),a+=2*s-2}else t.push(p,0)}return d>>>1},f.F._hufTree=function(e,t,d){var a=[],p=e.length,y=t.length,n=0;for(n=0;n<y;n+=2)t[n]=0,t[n+1]=0;for(n=0;n<p;n++)e[n]!=0&&a.push({lit:n,f:e[n]});var o=a.length,r=a.slice(0);if(o==0)return 0;if(o==1){var s=a[0].lit;return r=s==0?1:0,t[1+(s<<1)]=1,t[1+(r<<1)]=1,1}a.sort((function(R,O){return R.f-O.f}));var h=a[0],I=a[1],k=0,b=1,P=2;for(a[0]={lit:-1,f:h.f+I.f,l:h,r:I,d:0};b!=o-1;)h=k!=b&&(P==o||a[k].f<a[P].f)?a[k++]:a[P++],I=k!=b&&(P==o||a[k].f<a[P].f)?a[k++]:a[P++],a[b++]={lit:-1,f:h.f+I.f,l:h,r:I};var D=f.F.setDepth(a[b-1],0);for(D>d&&(f.F.restrictDepth(r,d,D),D=d),n=0;n<o;n++)t[1+(r[n].lit<<1)]=r[n].d;return D},f.F.setDepth=function(e,t){return e.lit!=-1?(e.d=t,t):Math.max(f.F.setDepth(e.l,t+1),f.F.setDepth(e.r,t+1))},f.F.restrictDepth=function(e,t,d){var a=0,p=1<<d-t,y=0;for(e.sort((function(o,r){return r.d==o.d?o.f-r.f:r.d-o.d})),a=0;a<e.length&&e[a].d>t;a++){var n=e[a].d;e[a].d=t,y+=p-(1<<d-n)}for(y>>>=d-t;y>0;)(n=e[a].d)<t?(e[a].d++,y-=1<<t-n-1):a++;for(;a>=0;a--)e[a].d==t&&y<0&&(e[a].d--,y++);y!=0&&console.log("debt left")},f.F._goodIndex=function(e,t){var d=0;return t[16|d]<=e&&(d|=16),t[8|d]<=e&&(d|=8),t[4|d]<=e&&(d|=4),t[2|d]<=e&&(d|=2),t[1|d]<=e&&(d|=1),d},f.F._writeLit=function(e,t,d,a){return f.F._putsF(d,a,t[e<<1]),a+t[1+(e<<1)]},f.F.inflate=function(e,t){var d=Uint8Array;if(e[0]==3&&e[1]==0)return t||new d(0);var a=f.F,p=a._bitsF,y=a._bitsE,n=a._decodeTiny,o=a.makeCodes,r=a.codes2map,s=a._get17,h=a.U,I=t==null;I&&(t=new d(e.length>>>2<<3));for(var k,b,P=0,D=0,R=0,O=0,m=0,z=0,c=0,u=0,v=0;P==0;)if(P=p(e,v,1),D=p(e,v+1,2),v+=3,D!=0){if(I&&(t=f.F._check(t,u+(1<<17))),D==1&&(k=h.flmap,b=h.fdmap,z=511,c=31),D==2){R=y(e,v,5)+257,O=y(e,v+5,5)+1,m=y(e,v+10,4)+4,v+=14;for(var A=0;A<38;A+=2)h.itree[A]=0,h.itree[A+1]=0;var w=1;for(A=0;A<m;A++){var F=y(e,v+3*A,3);h.itree[1+(h.ordr[A]<<1)]=F,F>w&&(w=F)}v+=3*m,o(h.itree,w),r(h.itree,w,h.imap),k=h.lmap,b=h.dmap,v=n(h.imap,(1<<w)-1,R+O,e,v,h.ttree);var x=a._copyOut(h.ttree,0,R,h.ltree);z=(1<<x)-1;var C=a._copyOut(h.ttree,R,O,h.dtree);c=(1<<C)-1,o(h.ltree,x),r(h.ltree,x,k),o(h.dtree,C),r(h.dtree,C,b)}for(;;){var l=k[s(e,v)&z];v+=15&l;var i=l>>>4;if(!(i>>>8))t[u++]=i;else{if(i==256)break;var M=u+i-254;if(i>264){var E=h.ldef[i-257];M=u+(E>>>3)+y(e,v,7&E),v+=7&E}var _=b[s(e,v)&c];v+=15&_;var N=_>>>4,$=h.ddef[N],Q=($>>>4)+p(e,v,15&$);for(v+=15&$,I&&(t=f.F._check(t,u+(1<<17)));u<M;)t[u]=t[u++-Q],t[u]=t[u++-Q],t[u]=t[u++-Q],t[u]=t[u++-Q];u=M}}}else{(7&v)!=0&&(v+=8-(7&v));var H=4+(v>>>3),T=e[H-4]|e[H-3]<<8;I&&(t=f.F._check(t,u+T)),t.set(new d(e.buffer,e.byteOffset+H,T),u),v=H+T<<3,u+=T}return t.length==u?t:t.slice(0,u)},f.F._check=function(e,t){var d=e.length;if(t<=d)return e;var a=new Uint8Array(Math.max(d<<1,t));return a.set(e,0),a},f.F._decodeTiny=function(e,t,d,a,p,y){for(var n=f.F._bitsE,o=f.F._get17,r=0;r<d;){var s=e[o(a,p)&t];p+=15&s;var h=s>>>4;if(h<=15)y[r]=h,r++;else{var I=0,k=0;h==16?(k=3+n(a,p,2),p+=2,I=y[r-1]):h==17?(k=3+n(a,p,3),p+=3):h==18&&(k=11+n(a,p,7),p+=7);for(var b=r+k;r<b;)y[r]=I,r++}}return p},f.F._copyOut=function(e,t,d,a){for(var p=0,y=0,n=a.length>>>1;y<d;){var o=e[y+t];a[y<<1]=0,a[1+(y<<1)]=o,o>p&&(p=o),y++}for(;y<n;)a[y<<1]=0,a[1+(y<<1)]=0,y++;return p},f.F.makeCodes=function(e,t){for(var d,a,p,y,n=f.F.U,o=e.length,r=n.bl_count,s=0;s<=t;s++)r[s]=0;for(s=1;s<o;s+=2)r[e[s]]++;var h=n.next_code;for(d=0,r[0]=0,a=1;a<=t;a++)d=d+r[a-1]<<1,h[a]=d;for(p=0;p<o;p+=2)(y=e[p+1])!=0&&(e[p]=h[y],h[y]++)},f.F.codes2map=function(e,t,d){for(var a=e.length,p=f.F.U.rev15,y=0;y<a;y+=2)if(e[y+1]!=0)for(var n=y>>1,o=e[y+1],r=n<<4|o,s=t-o,h=e[y]<<s,I=h+(1<<s);h!=I;)d[p[h]>>>15-t]=r,h++},f.F.revCodes=function(e,t){for(var d=f.F.U.rev15,a=15-t,p=0;p<e.length;p+=2){var y=e[p]<<t-e[p+1];e[p]=d[y]>>>a}},f.F._putsE=function(e,t,d){d<<=7&t;var a=t>>>3;e[a]|=d,e[a+1]|=d>>>8},f.F._putsF=function(e,t,d){d<<=7&t;var a=t>>>3;e[a]|=d,e[a+1]|=d>>>8,e[a+2]|=d>>>16},f.F._bitsE=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8)>>>(7&t)&(1<<d)-1},f.F._bitsF=function(e,t,d){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)&(1<<d)-1},f.F._get17=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16)>>>(7&t)},f.F._get25=function(e,t){return(e[t>>>3]|e[1+(t>>>3)]<<8|e[2+(t>>>3)]<<16|e[3+(t>>>3)]<<24)>>>(7&t)},f.F.U=(S=Uint16Array,U=Uint32Array,{next_code:new S(16),bl_count:new S(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new S(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new U(32),flmap:new S(512),fltree:[],fdmap:new S(32),fdtree:[],lmap:new S(32768),ltree:[],ttree:[],dmap:new S(32768),dtree:[],imap:new S(512),itree:[],rev15:new S(32768),lhst:new U(286),dhst:new U(30),ihst:new U(19),lits:new U(15e3),strt:new S(65536),prev:new S(32768)}),(function(){for(var e=f.F.U,t=0;t<32768;t++){var d=t;d=(4278255360&(d=(4042322160&(d=(3435973836&(d=(2863311530&d)>>>1|(1431655765&d)<<1))>>>2|(858993459&d)<<2))>>>4|(252645135&d)<<4))>>>8|(16711935&d)<<8,e.rev15[t]=(d>>>16|d<<16)>>>17}function a(p,y,n){for(;y--!=0;)p.push(0,n)}for(t=0;t<32;t++)e.ldef[t]=e.of0[t]<<3|e.exb[t],e.ddef[t]=e.df0[t]<<4|e.dxb[t];a(e.fltree,144,8),a(e.fltree,112,9),a(e.fltree,24,7),a(e.fltree,8,8),f.F.makeCodes(e.fltree,9),f.F.codes2map(e.fltree,9,e.flmap),f.F.revCodes(e.fltree,9),a(e.fdtree,32,5),f.F.makeCodes(e.fdtree,5),f.F.codes2map(e.fdtree,5,e.fdmap),f.F.revCodes(e.fdtree,5),a(e.itree,19,0),a(e.ltree,286,0),a(e.dtree,30,0),a(e.ttree,320,0)})()})();var Qr=$r({__proto__:null,default:tt},[tt]);const be=(function(){var j={nextZero(n,o){for(;n[o]!=0;)o++;return o},readUshort:(n,o)=>n[o]<<8|n[o+1],writeUshort(n,o,r){n[o]=r>>8&255,n[o+1]=255&r},readUint:(n,o)=>16777216*n[o]+(n[o+1]<<16|n[o+2]<<8|n[o+3]),writeUint(n,o,r){n[o]=r>>24&255,n[o+1]=r>>16&255,n[o+2]=r>>8&255,n[o+3]=255&r},readASCII(n,o,r){let s="";for(let h=0;h<r;h++)s+=String.fromCharCode(n[o+h]);return s},writeASCII(n,o,r){for(let s=0;s<r.length;s++)n[o+s]=r.charCodeAt(s)},readBytes(n,o,r){const s=[];for(let h=0;h<r;h++)s.push(n[o+h]);return s},pad:n=>n.length<2?`0${n}`:n,readUTF8(n,o,r){let s,h="";for(let I=0;I<r;I++)h+=`%${j.pad(n[o+I].toString(16))}`;try{s=decodeURIComponent(h)}catch{return j.readASCII(n,o,r)}return s}};function S(n,o,r,s){const h=o*r,I=t(s),k=Math.ceil(o*I/8),b=new Uint8Array(4*h),P=new Uint32Array(b.buffer),{ctype:D}=s,{depth:R}=s,O=j.readUshort;if(D==6){const E=h<<2;if(R==8)for(var m=0;m<E;m+=4)b[m]=n[m],b[m+1]=n[m+1],b[m+2]=n[m+2],b[m+3]=n[m+3];if(R==16)for(m=0;m<E;m++)b[m]=n[m<<1]}else if(D==2){const E=s.tabs.tRNS;if(E==null){if(R==8)for(m=0;m<h;m++){var z=3*m;P[m]=255<<24|n[z+2]<<16|n[z+1]<<8|n[z]}if(R==16)for(m=0;m<h;m++)z=6*m,P[m]=255<<24|n[z+4]<<16|n[z+2]<<8|n[z]}else{var c=E[0];const _=E[1],N=E[2];if(R==8)for(m=0;m<h;m++){var u=m<<2;z=3*m,P[m]=255<<24|n[z+2]<<16|n[z+1]<<8|n[z],n[z]==c&&n[z+1]==_&&n[z+2]==N&&(b[u+3]=0)}if(R==16)for(m=0;m<h;m++)u=m<<2,z=6*m,P[m]=255<<24|n[z+4]<<16|n[z+2]<<8|n[z],O(n,z)==c&&O(n,z+2)==_&&O(n,z+4)==N&&(b[u+3]=0)}}else if(D==3){const E=s.tabs.PLTE,_=s.tabs.tRNS,N=_?_.length:0;if(R==1)for(var v=0;v<r;v++){var A=v*k,w=v*o;for(m=0;m<o;m++){u=w+m<<2;var F=3*(x=n[A+(m>>3)]>>7-((7&m)<<0)&1);b[u]=E[F],b[u+1]=E[F+1],b[u+2]=E[F+2],b[u+3]=x<N?_[x]:255}}if(R==2)for(v=0;v<r;v++)for(A=v*k,w=v*o,m=0;m<o;m++)u=w+m<<2,F=3*(x=n[A+(m>>2)]>>6-((3&m)<<1)&3),b[u]=E[F],b[u+1]=E[F+1],b[u+2]=E[F+2],b[u+3]=x<N?_[x]:255;if(R==4)for(v=0;v<r;v++)for(A=v*k,w=v*o,m=0;m<o;m++)u=w+m<<2,F=3*(x=n[A+(m>>1)]>>4-((1&m)<<2)&15),b[u]=E[F],b[u+1]=E[F+1],b[u+2]=E[F+2],b[u+3]=x<N?_[x]:255;if(R==8)for(m=0;m<h;m++){var x;u=m<<2,F=3*(x=n[m]),b[u]=E[F],b[u+1]=E[F+1],b[u+2]=E[F+2],b[u+3]=x<N?_[x]:255}}else if(D==4){if(R==8)for(m=0;m<h;m++){u=m<<2;var C=n[l=m<<1];b[u]=C,b[u+1]=C,b[u+2]=C,b[u+3]=n[l+1]}if(R==16)for(m=0;m<h;m++){var l;u=m<<2,C=n[l=m<<2],b[u]=C,b[u+1]=C,b[u+2]=C,b[u+3]=n[l+2]}}else if(D==0)for(c=s.tabs.tRNS?s.tabs.tRNS:-1,v=0;v<r;v++){const E=v*k,_=v*o;if(R==1)for(var i=0;i<o;i++){var M=(C=255*(n[E+(i>>>3)]>>>7-(7&i)&1))==255*c?0:255;P[_+i]=M<<24|C<<16|C<<8|C}else if(R==2)for(i=0;i<o;i++)M=(C=85*(n[E+(i>>>2)]>>>6-((3&i)<<1)&3))==85*c?0:255,P[_+i]=M<<24|C<<16|C<<8|C;else if(R==4)for(i=0;i<o;i++)M=(C=17*(n[E+(i>>>1)]>>>4-((1&i)<<2)&15))==17*c?0:255,P[_+i]=M<<24|C<<16|C<<8|C;else if(R==8)for(i=0;i<o;i++)M=(C=n[E+i])==c?0:255,P[_+i]=M<<24|C<<16|C<<8|C;else if(R==16)for(i=0;i<o;i++)C=n[E+(i<<1)],M=O(n,E+(i<<1))==c?0:255,P[_+i]=M<<24|C<<16|C<<8|C}return b}function U(n,o,r,s){const h=t(n),I=Math.ceil(r*h/8),k=new Uint8Array((I+1+n.interlace)*s);return o=n.tabs.CgBI?e(o,k):f(o,k),n.interlace==0?o=d(o,n,0,r,s):n.interlace==1&&(o=(function(P,D){const R=D.width,O=D.height,m=t(D),z=m>>3,c=Math.ceil(R*m/8),u=new Uint8Array(O*c);let v=0;const A=[0,0,4,0,2,0,1],w=[0,4,0,2,0,1,0],F=[8,8,8,4,4,2,2],x=[8,8,4,4,2,2,1];let C=0;for(;C<7;){const i=F[C],M=x[C];let E=0,_=0,N=A[C];for(;N<O;)N+=i,_++;let $=w[C];for(;$<R;)$+=M,E++;const Q=Math.ceil(E*m/8);d(P,D,v,E,_);let H=0,T=A[C];for(;T<O;){let q=w[C],re=v+H*Q<<3;for(;q<R;){var l;if(m==1&&(l=(l=P[re>>3])>>7-(7&re)&1,u[T*c+(q>>3)]|=l<<7-((7&q)<<0)),m==2&&(l=(l=P[re>>3])>>6-(7&re)&3,u[T*c+(q>>2)]|=l<<6-((3&q)<<1)),m==4&&(l=(l=P[re>>3])>>4-(7&re)&15,u[T*c+(q>>1)]|=l<<4-((1&q)<<2)),m>=8){const ne=T*c+q*z;for(let J=0;J<z;J++)u[ne+J]=P[(re>>3)+J]}re+=m,q+=M}H++,T+=i}E*_!=0&&(v+=_*(1+Q)),C+=1}return u})(o,n)),o}function f(n,o){return e(new Uint8Array(n.buffer,2,n.length-6),o)}var e=(function(){const n={H:{}};return n.H.N=function(o,r){const s=Uint8Array;let h,I,k=0,b=0,P=0,D=0,R=0,O=0,m=0,z=0,c=0;if(o[0]==3&&o[1]==0)return r||new s(0);const u=n.H,v=u.b,A=u.e,w=u.R,F=u.n,x=u.A,C=u.Z,l=u.m,i=r==null;for(i&&(r=new s(o.length>>>2<<5));k==0;)if(k=v(o,c,1),b=v(o,c+1,2),c+=3,b!=0){if(i&&(r=n.H.W(r,z+(1<<17))),b==1&&(h=l.J,I=l.h,O=511,m=31),b==2){P=A(o,c,5)+257,D=A(o,c+5,5)+1,R=A(o,c+10,4)+4,c+=14;let E=1;for(var M=0;M<38;M+=2)l.Q[M]=0,l.Q[M+1]=0;for(M=0;M<R;M++){const $=A(o,c+3*M,3);l.Q[1+(l.X[M]<<1)]=$,$>E&&(E=$)}c+=3*R,F(l.Q,E),x(l.Q,E,l.u),h=l.w,I=l.d,c=w(l.u,(1<<E)-1,P+D,o,c,l.v);const _=u.V(l.v,0,P,l.C);O=(1<<_)-1;const N=u.V(l.v,P,D,l.D);m=(1<<N)-1,F(l.C,_),x(l.C,_,h),F(l.D,N),x(l.D,N,I)}for(;;){const E=h[C(o,c)&O];c+=15&E;const _=E>>>4;if(!(_>>>8))r[z++]=_;else{if(_==256)break;{let N=z+_-254;if(_>264){const q=l.q[_-257];N=z+(q>>>3)+A(o,c,7&q),c+=7&q}const $=I[C(o,c)&m];c+=15&$;const Q=$>>>4,H=l.c[Q],T=(H>>>4)+v(o,c,15&H);for(c+=15&H;z<N;)r[z]=r[z++-T],r[z]=r[z++-T],r[z]=r[z++-T],r[z]=r[z++-T];z=N}}}}else{(7&c)!=0&&(c+=8-(7&c));const E=4+(c>>>3),_=o[E-4]|o[E-3]<<8;i&&(r=n.H.W(r,z+_)),r.set(new s(o.buffer,o.byteOffset+E,_),z),c=E+_<<3,z+=_}return r.length==z?r:r.slice(0,z)},n.H.W=function(o,r){const s=o.length;if(r<=s)return o;const h=new Uint8Array(s<<1);return h.set(o,0),h},n.H.R=function(o,r,s,h,I,k){const b=n.H.e,P=n.H.Z;let D=0;for(;D<s;){const R=o[P(h,I)&r];I+=15&R;const O=R>>>4;if(O<=15)k[D]=O,D++;else{let m=0,z=0;O==16?(z=3+b(h,I,2),I+=2,m=k[D-1]):O==17?(z=3+b(h,I,3),I+=3):O==18&&(z=11+b(h,I,7),I+=7);const c=D+z;for(;D<c;)k[D]=m,D++}}return I},n.H.V=function(o,r,s,h){let I=0,k=0;const b=h.length>>>1;for(;k<s;){const P=o[k+r];h[k<<1]=0,h[1+(k<<1)]=P,P>I&&(I=P),k++}for(;k<b;)h[k<<1]=0,h[1+(k<<1)]=0,k++;return I},n.H.n=function(o,r){const s=n.H.m,h=o.length;let I,k,b,P;const D=s.j;for(var R=0;R<=r;R++)D[R]=0;for(R=1;R<h;R+=2)D[o[R]]++;const O=s.K;for(I=0,D[0]=0,k=1;k<=r;k++)I=I+D[k-1]<<1,O[k]=I;for(b=0;b<h;b+=2)P=o[b+1],P!=0&&(o[b]=O[P],O[P]++)},n.H.A=function(o,r,s){const h=o.length,I=n.H.m.r;for(let k=0;k<h;k+=2)if(o[k+1]!=0){const b=k>>1,P=o[k+1],D=b<<4|P,R=r-P;let O=o[k]<<R;const m=O+(1<<R);for(;O!=m;)s[I[O]>>>15-r]=D,O++}},n.H.l=function(o,r){const s=n.H.m.r,h=15-r;for(let I=0;I<o.length;I+=2){const k=o[I]<<r-o[I+1];o[I]=s[k]>>>h}},n.H.M=function(o,r,s){s<<=7&r;const h=r>>>3;o[h]|=s,o[h+1]|=s>>>8},n.H.I=function(o,r,s){s<<=7&r;const h=r>>>3;o[h]|=s,o[h+1]|=s>>>8,o[h+2]|=s>>>16},n.H.e=function(o,r,s){return(o[r>>>3]|o[1+(r>>>3)]<<8)>>>(7&r)&(1<<s)-1},n.H.b=function(o,r,s){return(o[r>>>3]|o[1+(r>>>3)]<<8|o[2+(r>>>3)]<<16)>>>(7&r)&(1<<s)-1},n.H.Z=function(o,r){return(o[r>>>3]|o[1+(r>>>3)]<<8|o[2+(r>>>3)]<<16)>>>(7&r)},n.H.i=function(o,r){return(o[r>>>3]|o[1+(r>>>3)]<<8|o[2+(r>>>3)]<<16|o[3+(r>>>3)]<<24)>>>(7&r)},n.H.m=(function(){const o=Uint16Array,r=Uint32Array;return{K:new o(16),j:new o(16),X:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],S:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],T:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],q:new o(32),p:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],z:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],c:new r(32),J:new o(512),_:[],h:new o(32),$:[],w:new o(32768),C:[],v:[],d:new o(32768),D:[],u:new o(512),Q:[],r:new o(32768),s:new r(286),Y:new r(30),a:new r(19),t:new r(15e3),k:new o(65536),g:new o(32768)}})(),(function(){const o=n.H.m;for(var r=0;r<32768;r++){let h=r;h=(2863311530&h)>>>1|(1431655765&h)<<1,h=(3435973836&h)>>>2|(858993459&h)<<2,h=(4042322160&h)>>>4|(252645135&h)<<4,h=(4278255360&h)>>>8|(16711935&h)<<8,o.r[r]=(h>>>16|h<<16)>>>17}function s(h,I,k){for(;I--!=0;)h.push(0,k)}for(r=0;r<32;r++)o.q[r]=o.S[r]<<3|o.T[r],o.c[r]=o.p[r]<<4|o.z[r];s(o._,144,8),s(o._,112,9),s(o._,24,7),s(o._,8,8),n.H.n(o._,9),n.H.A(o._,9,o.J),n.H.l(o._,9),s(o.$,32,5),n.H.n(o.$,5),n.H.A(o.$,5,o.h),n.H.l(o.$,5),s(o.Q,19,0),s(o.C,286,0),s(o.D,30,0),s(o.v,320,0)})(),n.H.N})();function t(n){return[1,null,3,1,2,null,4][n.ctype]*n.depth}function d(n,o,r,s,h){let I=t(o);const k=Math.ceil(s*I/8);let b,P;I=Math.ceil(I/8);let D=n[r],R=0;if(D>1&&(n[r]=[0,0,1][D-2]),D==3)for(R=I;R<k;R++)n[R+1]=n[R+1]+(n[R+1-I]>>>1)&255;for(let O=0;O<h;O++)if(b=r+O*k,P=b+O+1,D=n[P-1],R=0,D==0)for(;R<k;R++)n[b+R]=n[P+R];else if(D==1){for(;R<I;R++)n[b+R]=n[P+R];for(;R<k;R++)n[b+R]=n[P+R]+n[b+R-I]}else if(D==2)for(;R<k;R++)n[b+R]=n[P+R]+n[b+R-k];else if(D==3){for(;R<I;R++)n[b+R]=n[P+R]+(n[b+R-k]>>>1);for(;R<k;R++)n[b+R]=n[P+R]+(n[b+R-k]+n[b+R-I]>>>1)}else{for(;R<I;R++)n[b+R]=n[P+R]+a(0,n[b+R-k],0);for(;R<k;R++)n[b+R]=n[P+R]+a(n[b+R-I],n[b+R-k],n[b+R-I-k])}return n}function a(n,o,r){const s=n+o-r,h=s-n,I=s-o,k=s-r;return h*h<=I*I&&h*h<=k*k?n:I*I<=k*k?o:r}function p(n,o,r){r.width=j.readUint(n,o),o+=4,r.height=j.readUint(n,o),o+=4,r.depth=n[o],o++,r.ctype=n[o],o++,r.compress=n[o],o++,r.filter=n[o],o++,r.interlace=n[o],o++}function y(n,o,r,s,h,I,k,b,P){const D=Math.min(o,h),R=Math.min(r,I);let O=0,m=0;for(let C=0;C<R;C++)for(let l=0;l<D;l++)if(k>=0&&b>=0?(O=C*o+l<<2,m=(b+C)*h+k+l<<2):(O=(-b+C)*o-k+l<<2,m=C*h+l<<2),P==0)s[m]=n[O],s[m+1]=n[O+1],s[m+2]=n[O+2],s[m+3]=n[O+3];else if(P==1){var z=n[O+3]*.00392156862745098,c=n[O]*z,u=n[O+1]*z,v=n[O+2]*z,A=s[m+3]*(1/255),w=s[m]*A,F=s[m+1]*A,x=s[m+2]*A;const i=1-z,M=z+A*i,E=M==0?0:1/M;s[m+3]=255*M,s[m+0]=(c+w*i)*E,s[m+1]=(u+F*i)*E,s[m+2]=(v+x*i)*E}else if(P==2)z=n[O+3],c=n[O],u=n[O+1],v=n[O+2],A=s[m+3],w=s[m],F=s[m+1],x=s[m+2],z==A&&c==w&&u==F&&v==x?(s[m]=0,s[m+1]=0,s[m+2]=0,s[m+3]=0):(s[m]=c,s[m+1]=u,s[m+2]=v,s[m+3]=z);else if(P==3){if(z=n[O+3],c=n[O],u=n[O+1],v=n[O+2],A=s[m+3],w=s[m],F=s[m+1],x=s[m+2],z==A&&c==w&&u==F&&v==x)continue;if(z<220&&A>20)return!1}return!0}return{decode:function(o){const r=new Uint8Array(o);let s=8;const h=j,I=h.readUshort,k=h.readUint,b={tabs:{},frames:[]},P=new Uint8Array(r.length);let D,R=0,O=0;const m=[137,80,78,71,13,10,26,10];for(var z=0;z<8;z++)if(r[z]!=m[z])throw"The input is not a PNG file!";for(;s<r.length;){const C=h.readUint(r,s);s+=4;const l=h.readASCII(r,s,4);if(s+=4,l=="IHDR")p(r,s,b);else if(l=="iCCP"){for(var c=s;r[c]!=0;)c++;h.readASCII(r,s,c-s),r[c+1];const i=r.slice(c+2,s+C);let M=null;try{M=f(i)}catch{M=e(i)}b.tabs[l]=M}else if(l=="CgBI")b.tabs[l]=r.slice(s,s+4);else if(l=="IDAT"){for(z=0;z<C;z++)P[R+z]=r[s+z];R+=C}else if(l=="acTL")b.tabs[l]={num_frames:k(r,s),num_plays:k(r,s+4)},D=new Uint8Array(r.length);else if(l=="fcTL"){O!=0&&((x=b.frames[b.frames.length-1]).data=U(b,D.slice(0,O),x.rect.width,x.rect.height),O=0);const i={x:k(r,s+12),y:k(r,s+16),width:k(r,s+4),height:k(r,s+8)};let M=I(r,s+22);M=I(r,s+20)/(M==0?100:M);const E={rect:i,delay:Math.round(1e3*M),dispose:r[s+24],blend:r[s+25]};b.frames.push(E)}else if(l=="fdAT"){for(z=0;z<C-4;z++)D[O+z]=r[s+z+4];O+=C-4}else if(l=="pHYs")b.tabs[l]=[h.readUint(r,s),h.readUint(r,s+4),r[s+8]];else if(l=="cHRM")for(b.tabs[l]=[],z=0;z<8;z++)b.tabs[l].push(h.readUint(r,s+4*z));else if(l=="tEXt"||l=="zTXt"){b.tabs[l]==null&&(b.tabs[l]={});var u=h.nextZero(r,s),v=h.readASCII(r,s,u-s),A=s+C-u-1;if(l=="tEXt")F=h.readASCII(r,u+1,A);else{var w=f(r.slice(u+2,u+2+A));F=h.readUTF8(w,0,w.length)}b.tabs[l][v]=F}else if(l=="iTXt"){b.tabs[l]==null&&(b.tabs[l]={}),u=0,c=s,u=h.nextZero(r,c),v=h.readASCII(r,c,u-c);const i=r[c=u+1];var F;r[c+1],c+=2,u=h.nextZero(r,c),h.readASCII(r,c,u-c),c=u+1,u=h.nextZero(r,c),h.readUTF8(r,c,u-c),A=C-((c=u+1)-s),i==0?F=h.readUTF8(r,c,A):(w=f(r.slice(c,c+A)),F=h.readUTF8(w,0,w.length)),b.tabs[l][v]=F}else if(l=="PLTE")b.tabs[l]=h.readBytes(r,s,C);else if(l=="hIST"){const i=b.tabs.PLTE.length/3;for(b.tabs[l]=[],z=0;z<i;z++)b.tabs[l].push(I(r,s+2*z))}else if(l=="tRNS")b.ctype==3?b.tabs[l]=h.readBytes(r,s,C):b.ctype==0?b.tabs[l]=I(r,s):b.ctype==2&&(b.tabs[l]=[I(r,s),I(r,s+2),I(r,s+4)]);else if(l=="gAMA")b.tabs[l]=h.readUint(r,s)/1e5;else if(l=="sRGB")b.tabs[l]=r[s];else if(l=="bKGD")b.ctype==0||b.ctype==4?b.tabs[l]=[I(r,s)]:b.ctype==2||b.ctype==6?b.tabs[l]=[I(r,s),I(r,s+2),I(r,s+4)]:b.ctype==3&&(b.tabs[l]=r[s]);else if(l=="IEND")break;s+=C,h.readUint(r,s),s+=4}var x;return O!=0&&((x=b.frames[b.frames.length-1]).data=U(b,D.slice(0,O),x.rect.width,x.rect.height)),b.data=U(b,P,b.width,b.height),delete b.compress,delete b.interlace,delete b.filter,b},toRGBA8:function(o){const r=o.width,s=o.height;if(o.tabs.acTL==null)return[S(o.data,r,s,o).buffer];const h=[];o.frames[0].data==null&&(o.frames[0].data=o.data);const I=r*s*4,k=new Uint8Array(I),b=new Uint8Array(I),P=new Uint8Array(I);for(let R=0;R<o.frames.length;R++){const O=o.frames[R],m=O.rect.x,z=O.rect.y,c=O.rect.width,u=O.rect.height,v=S(O.data,c,u,o);if(R!=0)for(var D=0;D<I;D++)P[D]=k[D];if(O.blend==0?y(v,c,u,k,r,s,m,z,0):O.blend==1&&y(v,c,u,k,r,s,m,z,1),h.push(k.buffer.slice(0)),O.dispose!=0){if(O.dispose==1)y(b,c,u,k,r,s,m,z,0);else if(O.dispose==2)for(D=0;D<I;D++)k[D]=P[D]}}return h},_paeth:a,_copyTile:y,_bin:j}})();(function(){const{_copyTile:j}=be,{_bin:S}=be,U=be._paeth;var f={table:(function(){const c=new Uint32Array(256);for(let u=0;u<256;u++){let v=u;for(let A=0;A<8;A++)1&v?v=3988292384^v>>>1:v>>>=1;c[u]=v}return c})(),update(c,u,v,A){for(let w=0;w<A;w++)c=f.table[255&(c^u[v+w])]^c>>>8;return c},crc:(c,u,v)=>4294967295^f.update(4294967295,c,u,v)};function e(c,u,v,A){u[v]+=c[0]*A>>4,u[v+1]+=c[1]*A>>4,u[v+2]+=c[2]*A>>4,u[v+3]+=c[3]*A>>4}function t(c){return Math.max(0,Math.min(255,c))}function d(c,u){const v=c[0]-u[0],A=c[1]-u[1],w=c[2]-u[2],F=c[3]-u[3];return v*v+A*A+w*w+F*F}function a(c,u,v,A,w,F,x){x==null&&(x=1);const C=A.length,l=[];for(var i=0;i<C;i++){const T=A[i];l.push([T>>>0&255,T>>>8&255,T>>>16&255,T>>>24&255])}for(i=0;i<C;i++){let T=4294967295;for(var M=0,E=0;E<C;E++){var _=d(l[i],l[E]);E!=i&&_<T&&(T=_,M=E)}}const N=new Uint32Array(w.buffer),$=new Int16Array(u*v*4),Q=[0,8,2,10,12,4,14,6,3,11,1,9,15,7,13,5];for(i=0;i<Q.length;i++)Q[i]=255*((Q[i]+.5)/16-.5);for(let T=0;T<v;T++)for(let q=0;q<u;q++){var H;i=4*(T*u+q),x!=2?H=[t(c[i]+$[i]),t(c[i+1]+$[i+1]),t(c[i+2]+$[i+2]),t(c[i+3]+$[i+3])]:(_=Q[4*(3&T)+(3&q)],H=[t(c[i]+_),t(c[i+1]+_),t(c[i+2]+_),t(c[i+3]+_)]),M=0;let re=16777215;for(E=0;E<C;E++){const oe=d(H,l[E]);oe<re&&(re=oe,M=E)}const ne=l[M],J=[H[0]-ne[0],H[1]-ne[1],H[2]-ne[2],H[3]-ne[3]];x==1&&(q!=u-1&&e(J,$,i+4,7),T!=v-1&&(q!=0&&e(J,$,i+4*u-4,3),e(J,$,i+4*u,5),q!=u-1&&e(J,$,i+4*u+4,1))),F[i>>2]=M,N[i>>2]=A[M]}}function p(c,u,v,A,w){w==null&&(w={});const{crc:F}=f,x=S.writeUint,C=S.writeUshort,l=S.writeASCII;let i=8;const M=c.frames.length>1;let E,_=!1,N=33+(M?20:0);if(w.sRGB!=null&&(N+=13),w.pHYs!=null&&(N+=21),w.iCCP!=null&&(E=pako.deflate(w.iCCP),N+=21+E.length+4),c.ctype==3){for(var $=c.plte.length,Q=0;Q<$;Q++)c.plte[Q]>>>24!=255&&(_=!0);N+=8+3*$+4+(_?8+1*$+4:0)}for(var H=0;H<c.frames.length;H++)M&&(N+=38),N+=(ne=c.frames[H]).cimg.length+12,H!=0&&(N+=4);N+=12;const T=new Uint8Array(N),q=[137,80,78,71,13,10,26,10];for(Q=0;Q<8;Q++)T[Q]=q[Q];if(x(T,i,13),i+=4,l(T,i,"IHDR"),i+=4,x(T,i,u),i+=4,x(T,i,v),i+=4,T[i]=c.depth,i++,T[i]=c.ctype,i++,T[i]=0,i++,T[i]=0,i++,T[i]=0,i++,x(T,i,F(T,i-17,17)),i+=4,w.sRGB!=null&&(x(T,i,1),i+=4,l(T,i,"sRGB"),i+=4,T[i]=w.sRGB,i++,x(T,i,F(T,i-5,5)),i+=4),w.iCCP!=null){const J=13+E.length;x(T,i,J),i+=4,l(T,i,"iCCP"),i+=4,l(T,i,"ICC profile"),i+=11,i+=2,T.set(E,i),i+=E.length,x(T,i,F(T,i-(J+4),J+4)),i+=4}if(w.pHYs!=null&&(x(T,i,9),i+=4,l(T,i,"pHYs"),i+=4,x(T,i,w.pHYs[0]),i+=4,x(T,i,w.pHYs[1]),i+=4,T[i]=w.pHYs[2],i++,x(T,i,F(T,i-13,13)),i+=4),M&&(x(T,i,8),i+=4,l(T,i,"acTL"),i+=4,x(T,i,c.frames.length),i+=4,x(T,i,w.loop!=null?w.loop:0),i+=4,x(T,i,F(T,i-12,12)),i+=4),c.ctype==3){for(x(T,i,3*($=c.plte.length)),i+=4,l(T,i,"PLTE"),i+=4,Q=0;Q<$;Q++){const J=3*Q,oe=c.plte[Q],W=255&oe,L=oe>>>8&255,B=oe>>>16&255;T[i+J+0]=W,T[i+J+1]=L,T[i+J+2]=B}if(i+=3*$,x(T,i,F(T,i-3*$-4,3*$+4)),i+=4,_){for(x(T,i,$),i+=4,l(T,i,"tRNS"),i+=4,Q=0;Q<$;Q++)T[i+Q]=c.plte[Q]>>>24&255;i+=$,x(T,i,F(T,i-$-4,$+4)),i+=4}}let re=0;for(H=0;H<c.frames.length;H++){var ne=c.frames[H];M&&(x(T,i,26),i+=4,l(T,i,"fcTL"),i+=4,x(T,i,re++),i+=4,x(T,i,ne.rect.width),i+=4,x(T,i,ne.rect.height),i+=4,x(T,i,ne.rect.x),i+=4,x(T,i,ne.rect.y),i+=4,C(T,i,A[H]),i+=2,C(T,i,1e3),i+=2,T[i]=ne.dispose,i++,T[i]=ne.blend,i++,x(T,i,F(T,i-30,30)),i+=4);const J=ne.cimg;x(T,i,($=J.length)+(H==0?0:4)),i+=4;const oe=i;l(T,i,H==0?"IDAT":"fdAT"),i+=4,H!=0&&(x(T,i,re++),i+=4),T.set(J,i),i+=$,x(T,i,F(T,oe,i-oe)),i+=4}return x(T,i,0),i+=4,l(T,i,"IEND"),i+=4,x(T,i,F(T,i-4,4)),i+=4,T.buffer}function y(c,u,v){for(let A=0;A<c.frames.length;A++){const w=c.frames[A];w.rect.width;const F=w.rect.height,x=new Uint8Array(F*w.bpl+F);w.cimg=s(w.img,F,w.bpp,w.bpl,x,u,v)}}function n(c,u,v,A,w){const F=w[0],x=w[1],C=w[2],l=w[3],i=w[4],M=w[5];let E=6,_=8,N=255;for(var $=0;$<c.length;$++){const se=new Uint8Array(c[$]);for(var Q=se.length,H=0;H<Q;H+=4)N&=se[H+3]}const T=N!=255,q=(function(ee,K,ae,fe,le,me){const ce=[];for(var ie=0;ie<ee.length;ie++){const he=new Uint8Array(ee[ie]),ye=new Uint32Array(he.buffer);var ge;let xe=0,Ce=0,we=K,Ue=ae,st=fe?1:0;if(ie!=0){const or=me||fe||ie==1||ce[ie-2].dispose!=0?1:2;let lt=0,yt=1e9;for(let $e=0;$e<or;$e++){var je=new Uint8Array(ee[ie-1-$e]);const ar=new Uint32Array(ee[ie-1-$e]);let Ie=K,Fe=ae,_e=-1,Ne=-1;for(let ke=0;ke<ae;ke++)for(let De=0;De<K;De++)ye[de=ke*K+De]!=ar[de]&&(De<Ie&&(Ie=De),De>_e&&(_e=De),ke<Fe&&(Fe=ke),ke>Ne&&(Ne=ke));_e==-1&&(Ie=Fe=_e=Ne=0),le&&((1&Ie)==1&&Ie--,(1&Fe)==1&&Fe--);const bt=(_e-Ie+1)*(Ne-Fe+1);bt<yt&&(yt=bt,lt=$e,xe=Ie,Ce=Fe,we=_e-Ie+1,Ue=Ne-Fe+1)}je=new Uint8Array(ee[ie-1-lt]),lt==1&&(ce[ie-1].dispose=2),ge=new Uint8Array(we*Ue*4),j(je,K,ae,ge,we,Ue,-xe,-Ce,0),st=j(he,K,ae,ge,we,Ue,-xe,-Ce,3)?1:0,st==1?r(he,K,ae,ge,{x:xe,y:Ce,width:we,height:Ue}):j(he,K,ae,ge,we,Ue,-xe,-Ce,0)}else ge=he.slice(0);ce.push({rect:{x:xe,y:Ce,width:we,height:Ue},img:ge,blend:st,dispose:0})}if(fe)for(ie=0;ie<ce.length;ie++){if((Re=ce[ie]).blend==1)continue;const he=Re.rect,ye=ce[ie-1].rect,xe=Math.min(he.x,ye.x),Ce=Math.min(he.y,ye.y),we={x:xe,y:Ce,width:Math.max(he.x+he.width,ye.x+ye.width)-xe,height:Math.max(he.y+he.height,ye.y+ye.height)-Ce};ce[ie-1].dispose=1,ie-1!=0&&o(ee,K,ae,ce,ie-1,we,le),o(ee,K,ae,ce,ie,we,le)}let Ge=0;if(ee.length!=1)for(var de=0;de<ce.length;de++){var Re;Ge+=(Re=ce[de]).rect.width*Re.rect.height}return ce})(c,u,v,F,x,C),re={},ne=[],J=[];if(A!=0){const se=[];for(H=0;H<q.length;H++)se.push(q[H].img.buffer);const ee=(function(le){let me=0;for(var ce=0;ce<le.length;ce++)me+=le[ce].byteLength;const ie=new Uint8Array(me);let ge=0;for(ce=0;ce<le.length;ce++){const je=new Uint8Array(le[ce]),Ge=je.length;for(let de=0;de<Ge;de+=4){let Re=je[de],he=je[de+1],ye=je[de+2];const xe=je[de+3];xe==0&&(Re=he=ye=0),ie[ge+de]=Re,ie[ge+de+1]=he,ie[ge+de+2]=ye,ie[ge+de+3]=xe}ge+=Ge}return ie.buffer})(se),K=I(ee,A);for(H=0;H<K.plte.length;H++)ne.push(K.plte[H].est.rgba);let ae=0;for(H=0;H<q.length;H++){const fe=(W=q[H]).img.length;var oe=new Uint8Array(K.inds.buffer,ae>>2,fe>>2);J.push(oe);const le=new Uint8Array(K.abuf,ae,fe);M&&a(W.img,W.rect.width,W.rect.height,ne,le,oe),W.img.set(le),ae+=fe}}else for($=0;$<q.length;$++){var W=q[$];const se=new Uint32Array(W.img.buffer);var L=W.rect.width;for(Q=se.length,oe=new Uint8Array(Q),J.push(oe),H=0;H<Q;H++){const ee=se[H];if(H!=0&&ee==se[H-1])oe[H]=oe[H-1];else if(H>L&&ee==se[H-L])oe[H]=oe[H-L];else{let K=re[ee];if(K==null&&(re[ee]=K=ne.length,ne.push(ee),ne.length>=300))break;oe[H]=K}}}const B=ne.length;for(B<=256&&i==0&&(_=B<=2?1:B<=4?2:B<=16?4:8,_=Math.max(_,l)),$=0;$<q.length;$++){(W=q[$]).rect.x,W.rect.y,L=W.rect.width;const se=W.rect.height;let ee=W.img;new Uint32Array(ee.buffer);let K=4*L,ae=4;if(B<=256&&i==0){K=Math.ceil(_*L/8);var X=new Uint8Array(K*se);const fe=J[$];for(let le=0;le<se;le++){H=le*K;const me=le*L;if(_==8)for(var Z=0;Z<L;Z++)X[H+Z]=fe[me+Z];else if(_==4)for(Z=0;Z<L;Z++)X[H+(Z>>1)]|=fe[me+Z]<<4-4*(1&Z);else if(_==2)for(Z=0;Z<L;Z++)X[H+(Z>>2)]|=fe[me+Z]<<6-2*(3&Z);else if(_==1)for(Z=0;Z<L;Z++)X[H+(Z>>3)]|=fe[me+Z]<<7-1*(7&Z)}ee=X,E=3,ae=1}else if(T==0&&q.length==1){X=new Uint8Array(L*se*3);const fe=L*se;for(H=0;H<fe;H++){const le=3*H,me=4*H;X[le]=ee[me],X[le+1]=ee[me+1],X[le+2]=ee[me+2]}ee=X,E=2,ae=3,K=3*L}W.img=ee,W.bpl=K,W.bpp=ae}return{ctype:E,depth:_,plte:ne,frames:q}}function o(c,u,v,A,w,F,x){const C=Uint8Array,l=Uint32Array,i=new C(c[w-1]),M=new l(c[w-1]),E=w+1<c.length?new C(c[w+1]):null,_=new C(c[w]),N=new l(_.buffer);let $=u,Q=v,H=-1,T=-1;for(let re=0;re<F.height;re++)for(let ne=0;ne<F.width;ne++){const J=F.x+ne,oe=F.y+re,W=oe*u+J,L=N[W];L==0||A[w-1].dispose==0&&M[W]==L&&(E==null||E[4*W+3]!=0)||(J<$&&($=J),J>H&&(H=J),oe<Q&&(Q=oe),oe>T&&(T=oe))}H==-1&&($=Q=H=T=0),x&&((1&$)==1&&$--,(1&Q)==1&&Q--),F={x:$,y:Q,width:H-$+1,height:T-Q+1};const q=A[w];q.rect=F,q.blend=1,q.img=new Uint8Array(F.width*F.height*4),A[w-1].dispose==0?(j(i,u,v,q.img,F.width,F.height,-F.x,-F.y,0),r(_,u,v,q.img,F)):j(_,u,v,q.img,F.width,F.height,-F.x,-F.y,0)}function r(c,u,v,A,w){j(c,u,v,A,w.width,w.height,-w.x,-w.y,2)}function s(c,u,v,A,w,F,x){const C=[];let l,i=[0,1,2,3,4];F!=-1?i=[F]:(u*A>5e5||v==1)&&(i=[0]),x&&(l={level:0});const M=Qr;for(var E=0;E<i.length;E++){for(let $=0;$<u;$++)h(w,c,$,A,v,i[E]);C.push(M.deflate(w,l))}let _,N=1e9;for(E=0;E<C.length;E++)C[E].length<N&&(_=E,N=C[E].length);return C[_]}function h(c,u,v,A,w,F){const x=v*A;let C=x+v;if(c[C]=F,C++,F==0)if(A<500)for(var l=0;l<A;l++)c[C+l]=u[x+l];else c.set(new Uint8Array(u.buffer,x,A),C);else if(F==1){for(l=0;l<w;l++)c[C+l]=u[x+l];for(l=w;l<A;l++)c[C+l]=u[x+l]-u[x+l-w]+256&255}else if(v==0){for(l=0;l<w;l++)c[C+l]=u[x+l];if(F==2)for(l=w;l<A;l++)c[C+l]=u[x+l];if(F==3)for(l=w;l<A;l++)c[C+l]=u[x+l]-(u[x+l-w]>>1)+256&255;if(F==4)for(l=w;l<A;l++)c[C+l]=u[x+l]-U(u[x+l-w],0,0)+256&255}else{if(F==2)for(l=0;l<A;l++)c[C+l]=u[x+l]+256-u[x+l-A]&255;if(F==3){for(l=0;l<w;l++)c[C+l]=u[x+l]+256-(u[x+l-A]>>1)&255;for(l=w;l<A;l++)c[C+l]=u[x+l]+256-(u[x+l-A]+u[x+l-w]>>1)&255}if(F==4){for(l=0;l<w;l++)c[C+l]=u[x+l]+256-U(0,u[x+l-A],0)&255;for(l=w;l<A;l++)c[C+l]=u[x+l]+256-U(u[x+l-w],u[x+l-A],u[x+l-w-A])&255}}}function I(c,u){const v=new Uint8Array(c),A=v.slice(0),w=new Uint32Array(A.buffer),F=k(A,u),x=F[0],C=F[1],l=v.length,i=new Uint8Array(l>>2);let M;if(v.length<2e7)for(var E=0;E<l;E+=4)M=b(x,_=v[E]*(1/255),N=v[E+1]*(1/255),$=v[E+2]*(1/255),Q=v[E+3]*(1/255)),i[E>>2]=M.ind,w[E>>2]=M.est.rgba;else for(E=0;E<l;E+=4){var _=v[E]*.00392156862745098,N=v[E+1]*(1/255),$=v[E+2]*(1/255),Q=v[E+3]*(1/255);for(M=x;M.left;)M=P(M.est,_,N,$,Q)<=0?M.left:M.right;i[E>>2]=M.ind,w[E>>2]=M.est.rgba}return{abuf:A.buffer,inds:i,plte:C}}function k(c,u,v){v==null&&(v=1e-4);const A=new Uint32Array(c.buffer),w={i0:0,i1:c.length,bst:null,est:null,tdst:0,left:null,right:null};w.bst=O(c,w.i0,w.i1),w.est=m(w.bst);const F=[w];for(;F.length<u;){let C=0,l=0;for(var x=0;x<F.length;x++)F[x].est.L>C&&(C=F[x].est.L,l=x);if(C<v)break;const i=F[l],M=D(c,A,i.i0,i.i1,i.est.e,i.est.eMq255);if(i.i0>=M||i.i1<=M){i.est.L=0;continue}const E={i0:i.i0,i1:M,bst:null,est:null,tdst:0,left:null,right:null};E.bst=O(c,E.i0,E.i1),E.est=m(E.bst);const _={i0:M,i1:i.i1,bst:null,est:null,tdst:0,left:null,right:null};for(_.bst={R:[],m:[],N:i.bst.N-E.bst.N},x=0;x<16;x++)_.bst.R[x]=i.bst.R[x]-E.bst.R[x];for(x=0;x<4;x++)_.bst.m[x]=i.bst.m[x]-E.bst.m[x];_.est=m(_.bst),i.left=E,i.right=_,F[l]=E,F.push(_)}for(F.sort(((C,l)=>l.bst.N-C.bst.N)),x=0;x<F.length;x++)F[x].ind=x;return[w,F]}function b(c,u,v,A,w){if(c.left==null)return c.tdst=(function(E,_,N,$,Q){const H=_-E[0],T=N-E[1],q=$-E[2],re=Q-E[3];return H*H+T*T+q*q+re*re})(c.est.q,u,v,A,w),c;const F=P(c.est,u,v,A,w);let x=c.left,C=c.right;F>0&&(x=c.right,C=c.left);const l=b(x,u,v,A,w);if(l.tdst<=F*F)return l;const i=b(C,u,v,A,w);return i.tdst<l.tdst?i:l}function P(c,u,v,A,w){const{e:F}=c;return F[0]*u+F[1]*v+F[2]*A+F[3]*w-c.eMq}function D(c,u,v,A,w,F){for(A-=4;v<A;){for(;R(c,v,w)<=F;)v+=4;for(;R(c,A,w)>F;)A-=4;if(v>=A)break;const x=u[v>>2];u[v>>2]=u[A>>2],u[A>>2]=x,v+=4,A-=4}for(;R(c,v,w)>F;)v-=4;return v+4}function R(c,u,v){return c[u]*v[0]+c[u+1]*v[1]+c[u+2]*v[2]+c[u+3]*v[3]}function O(c,u,v){const A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],w=[0,0,0,0],F=v-u>>2;for(let x=u;x<v;x+=4){const C=c[x]*.00392156862745098,l=c[x+1]*(1/255),i=c[x+2]*(1/255),M=c[x+3]*(1/255);w[0]+=C,w[1]+=l,w[2]+=i,w[3]+=M,A[0]+=C*C,A[1]+=C*l,A[2]+=C*i,A[3]+=C*M,A[5]+=l*l,A[6]+=l*i,A[7]+=l*M,A[10]+=i*i,A[11]+=i*M,A[15]+=M*M}return A[4]=A[1],A[8]=A[2],A[9]=A[6],A[12]=A[3],A[13]=A[7],A[14]=A[11],{R:A,m:w,N:F}}function m(c){const{R:u}=c,{m:v}=c,{N:A}=c,w=v[0],F=v[1],x=v[2],C=v[3],l=A==0?0:1/A,i=[u[0]-w*w*l,u[1]-w*F*l,u[2]-w*x*l,u[3]-w*C*l,u[4]-F*w*l,u[5]-F*F*l,u[6]-F*x*l,u[7]-F*C*l,u[8]-x*w*l,u[9]-x*F*l,u[10]-x*x*l,u[11]-x*C*l,u[12]-C*w*l,u[13]-C*F*l,u[14]-C*x*l,u[15]-C*C*l],M=i,E=z;let _=[Math.random(),Math.random(),Math.random(),Math.random()],N=0,$=0;if(A!=0)for(let H=0;H<16&&(_=E.multVec(M,_),$=Math.sqrt(E.dot(_,_)),_=E.sml(1/$,_),!(H!=0&&Math.abs($-N)<1e-9));H++)N=$;const Q=[w*l,F*l,x*l,C*l];return{Cov:i,q:Q,e:_,L:N,eMq255:E.dot(E.sml(255,Q),_),eMq:E.dot(_,Q),rgba:(Math.round(255*Q[3])<<24|Math.round(255*Q[2])<<16|Math.round(255*Q[1])<<8|Math.round(255*Q[0])<<0)>>>0}}var z={multVec:(c,u)=>[c[0]*u[0]+c[1]*u[1]+c[2]*u[2]+c[3]*u[3],c[4]*u[0]+c[5]*u[1]+c[6]*u[2]+c[7]*u[3],c[8]*u[0]+c[9]*u[1]+c[10]*u[2]+c[11]*u[3],c[12]*u[0]+c[13]*u[1]+c[14]*u[2]+c[15]*u[3]],dot:(c,u)=>c[0]*u[0]+c[1]*u[1]+c[2]*u[2]+c[3]*u[3],sml:(c,u)=>[c*u[0],c*u[1],c*u[2],c*u[3]]};be.encode=function(u,v,A,w,F,x,C){w==null&&(w=0),C==null&&(C=!1);const l=n(u,v,A,w,[!1,!1,!1,0,C,!1]);return y(l,-1),p(l,v,A,F,x)},be.encodeLL=function(u,v,A,w,F,x,C,l){const i={ctype:0+(w==1?0:2)+(F==0?0:4),depth:x,frames:[]},M=(w+F)*x,E=M*v;for(let _=0;_<u.length;_++)i.frames.push({rect:{x:0,y:0,width:v,height:A},img:new Uint8Array(u[_]),blend:0,dispose:1,bpp:Math.ceil(M/8),bpl:Math.ceil(E/8)});return y(i,0,!0),p(i,v,A,C,l)},be.encode.compress=n,be.encode.dither=a,be.quantize=I,be.quantize.getKDtree=k,be.quantize.getNearest=b})();const Vt={toArrayBuffer(j,S){const U=j.width,f=j.height,e=U<<2,t=j.getContext("2d").getImageData(0,0,U,f),d=new Uint32Array(t.data.buffer),a=(32*U+31)/32<<2,p=a*f,y=122+p,n=new ArrayBuffer(y),o=new DataView(n),r=1<<20;let s,h,I,k,b=r,P=0,D=0,R=0;function O(c){o.setUint16(D,c,!0),D+=2}function m(c){o.setUint32(D,c,!0),D+=4}function z(c){D+=c}O(19778),m(y),z(4),m(122),m(108),m(U),m(-f>>>0),O(1),O(32),m(3),m(p),m(2835),m(2835),z(8),m(16711680),m(65280),m(255),m(4278190080),m(1466527264),(function c(){for(;P<f&&b>0;){for(k=122+P*a,s=0;s<e;)b--,h=d[R++],I=h>>>24,o.setUint32(k+s,h<<8|I),s+=4;P++}R<d.length?(b=r,setTimeout(c,Vt._dly)):S(n)})()},toBlob(j,S){this.toArrayBuffer(j,(U=>{S(new Blob([U],{type:"image/bmp"}))}))},_dly:9};var pe={CHROME:"CHROME",FIREFOX:"FIREFOX",DESKTOP_SAFARI:"DESKTOP_SAFARI",IE:"IE",IOS:"IOS",ETC:"ETC"},Gr={[pe.CHROME]:16384,[pe.FIREFOX]:11180,[pe.DESKTOP_SAFARI]:16384,[pe.IE]:8192,[pe.IOS]:4096,[pe.ETC]:8192};const gt=typeof window<"u",Kt=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,rt=gt&&window.cordova&&window.cordova.require&&window.cordova.require("cordova/modulemapper"),qr=(gt||Kt)&&(rt&&rt.getOriginalSymbol(window,"File")||typeof File<"u"&&File),Zt=(gt||Kt)&&(rt&&rt.getOriginalSymbol(window,"FileReader")||typeof FileReader<"u"&&FileReader);function xt(j,S,U=Date.now()){return new Promise((f=>{const e=j.split(","),t=e[0].match(/:(.*?);/)[1],d=globalThis.atob(e[1]);let a=d.length;const p=new Uint8Array(a);for(;a--;)p[a]=d.charCodeAt(a);const y=new Blob([p],{type:t});y.name=S,y.lastModified=U,f(y)}))}function Yt(j){return new Promise(((S,U)=>{const f=new Zt;f.onload=()=>S(f.result),f.onerror=e=>U(e),f.readAsDataURL(j)}))}function Xt(j){return new Promise(((S,U)=>{const f=new Image;f.onload=()=>S(f),f.onerror=e=>U(e),f.src=j}))}function Te(){if(Te.cachedResult!==void 0)return Te.cachedResult;let j=pe.ETC;const{userAgent:S}=navigator;return/Chrom(e|ium)/i.test(S)?j=pe.CHROME:/iP(ad|od|hone)/i.test(S)&&/WebKit/i.test(S)?j=pe.IOS:/Safari/i.test(S)?j=pe.DESKTOP_SAFARI:/Firefox/i.test(S)?j=pe.FIREFOX:(/MSIE/i.test(S)||document.documentMode)&&(j=pe.IE),Te.cachedResult=j,Te.cachedResult}function Jt(j,S){const U=Te(),f=Gr[U];let e=j,t=S,d=e*t;const a=e>t?t/e:e/t;for(;d>f*f;){const p=(f+e)/2,y=(f+t)/2;p<y?(t=y,e=y*a):(t=p*a,e=p),d=e*t}return{width:e,height:t}}function it(j,S){let U,f;try{if(U=new OffscreenCanvas(j,S),f=U.getContext("2d"),f===null)throw new Error("getContext of OffscreenCanvas returns null")}catch{U=document.createElement("canvas"),f=U.getContext("2d")}return U.width=j,U.height=S,[U,f]}function er(j,S){const{width:U,height:f}=Jt(j.width,j.height),[e,t]=it(U,f);return S&&/jpe?g/.test(S)&&(t.fillStyle="white",t.fillRect(0,0,e.width,e.height)),t.drawImage(j,0,0,e.width,e.height),e}function Je(){return Je.cachedResult!==void 0||(Je.cachedResult=["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(navigator.platform)||navigator.userAgent.includes("Mac")&&typeof document<"u"&&"ontouchend"in document),Je.cachedResult}function nt(j,S={}){return new Promise((function(U,f){let e,t;var d=function(){try{return t=er(e,S.fileType||j.type),U([e,t])}catch(p){return f(p)}},a=function(p){try{var y=function(n){try{throw n}catch(o){return f(o)}};try{let n;return Yt(j).then((function(o){try{return n=o,Xt(n).then((function(r){try{return e=r,(function(){try{return d()}catch(s){return f(s)}})()}catch(s){return y(s)}}),y)}catch(r){return y(r)}}),y)}catch(n){y(n)}}catch(n){return f(n)}};try{if(Je()||[pe.DESKTOP_SAFARI,pe.MOBILE_SAFARI].includes(Te()))throw new Error("Skip createImageBitmap on IOS and Safari");return createImageBitmap(j).then((function(p){try{return e=p,d()}catch{return a()}}),a)}catch{a()}}))}function ot(j,S,U,f,e=1){return new Promise((function(t,d){let a;if(S==="image/png"){let y,n,o;return y=j.getContext("2d"),{data:n}=y.getImageData(0,0,j.width,j.height),o=be.encode([n.buffer],j.width,j.height,4096*e),a=new Blob([o],{type:S}),a.name=U,a.lastModified=f,p.call(this)}{let y=function(){return p.call(this)};if(S==="image/bmp")return new Promise((n=>Vt.toBlob(j,n))).then((function(n){try{return a=n,a.name=U,a.lastModified=f,y.call(this)}catch(o){return d(o)}}).bind(this),d);{let n=function(){return y.call(this)};if(typeof OffscreenCanvas=="function"&&j instanceof OffscreenCanvas)return j.convertToBlob({type:S,quality:e}).then((function(o){try{return a=o,a.name=U,a.lastModified=f,n.call(this)}catch(r){return d(r)}}).bind(this),d);{let o;return o=j.toDataURL(S,e),xt(o,U,f).then((function(r){try{return a=r,n.call(this)}catch(s){return d(s)}}).bind(this),d)}}}function p(){return t(a)}}))}function Ae(j){j.width=0,j.height=0}function We(){return new Promise((function(j,S){let U,f,e,t;return We.cachedResult!==void 0?j(We.cachedResult):xt("data:image/jpeg;base64,/9j/4QAiRXhpZgAATU0AKgAAAAgAAQESAAMAAAABAAYAAAAAAAD/2wCEAAEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAf/AABEIAAEAAgMBEQACEQEDEQH/xABKAAEAAAAAAAAAAAAAAAAAAAALEAEAAAAAAAAAAAAAAAAAAAAAAQEAAAAAAAAAAAAAAAAAAAAAEQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIRAxEAPwA/8H//2Q==","test.jpg",Date.now()).then((function(d){try{return U=d,nt(U).then((function(a){try{return f=a[1],ot(f,U.type,U.name,U.lastModified).then((function(p){try{return e=p,Ae(f),nt(e).then((function(y){try{return t=y[0],We.cachedResult=t.width===1&&t.height===2,j(We.cachedResult)}catch(n){return S(n)}}),S)}catch(y){return S(y)}}),S)}catch(p){return S(p)}}),S)}catch(a){return S(a)}}),S)}))}function tr(j){return new Promise(((S,U)=>{const f=new Zt;f.onload=e=>{const t=new DataView(e.target.result);if(t.getUint16(0,!1)!=65496)return S(-2);const d=t.byteLength;let a=2;for(;a<d;){if(t.getUint16(a+2,!1)<=8)return S(-1);const p=t.getUint16(a,!1);if(a+=2,p==65505){if(t.getUint32(a+=2,!1)!=1165519206)return S(-1);const y=t.getUint16(a+=6,!1)==18761;a+=t.getUint32(a+4,y);const n=t.getUint16(a,y);a+=2;for(let o=0;o<n;o++)if(t.getUint16(a+12*o,y)==274)return S(t.getUint16(a+12*o+8,y))}else{if((65280&p)!=65280)break;a+=t.getUint16(a,!1)}}return S(-1)},f.onerror=e=>U(e),f.readAsArrayBuffer(j)}))}function rr(j,S){const{width:U}=j,{height:f}=j,{maxWidthOrHeight:e}=S;let t,d=j;return isFinite(e)&&(U>e||f>e)&&([d,t]=it(U,f),U>f?(d.width=e,d.height=f/U*e):(d.width=U/f*e,d.height=e),t.drawImage(j,0,0,d.width,d.height),Ae(j)),d}function nr(j,S){const{width:U}=j,{height:f}=j,[e,t]=it(U,f);switch(S>4&&S<9?(e.width=f,e.height=U):(e.width=U,e.height=f),S){case 2:t.transform(-1,0,0,1,U,0);break;case 3:t.transform(-1,0,0,-1,U,f);break;case 4:t.transform(1,0,0,-1,0,f);break;case 5:t.transform(0,1,1,0,0,0);break;case 6:t.transform(0,1,-1,0,f,0);break;case 7:t.transform(0,-1,-1,0,f,U);break;case 8:t.transform(0,-1,1,0,0,U)}return t.drawImage(j,0,0,U,f),Ae(j),e}function Ft(j,S,U=0){return new Promise((function(f,e){let t,d,a,p,y,n,o,r,s,h,I,k,b,P,D,R,O,m,z,c;function u(A=5){if(S.signal&&S.signal.aborted)throw S.signal.reason;t+=A,S.onProgress(Math.min(t,100))}function v(A){if(S.signal&&S.signal.aborted)throw S.signal.reason;t=Math.min(Math.max(A,t),100),S.onProgress(t)}return t=U,d=S.maxIteration||10,a=1024*S.maxSizeMB*1024,u(),nt(j,S).then((function(A){try{return[,p]=A,u(),y=rr(p,S),u(),new Promise((function(w,F){var x;if(!(x=S.exifOrientation))return tr(j).then((function(l){try{return x=l,C.call(this)}catch(i){return F(i)}}).bind(this),F);function C(){return w(x)}return C.call(this)})).then((function(w){try{return n=w,u(),We().then((function(F){try{return o=F?y:nr(y,n),u(),r=S.initialQuality||1,s=S.fileType||j.type,ot(o,s,j.name,j.lastModified,r).then((function(x){try{{let l=function(){if(d--&&(D>a||D>b)){let M,E;return M=c?.95*z.width:z.width,E=c?.95*z.height:z.height,[O,m]=it(M,E),m.drawImage(z,0,0,M,E),r*=s==="image/png"?.85:.95,ot(O,s,j.name,j.lastModified,r).then((function(_){try{return R=_,Ae(z),z=O,D=R.size,v(Math.min(99,Math.floor((P-D)/(P-a)*100))),l}catch(N){return e(N)}}),e)}return[1]},i=function(){return Ae(z),Ae(O),Ae(y),Ae(o),Ae(p),v(100),f(R)};if(h=x,u(),I=h.size>a,k=h.size>j.size,!I&&!k)return v(100),f(h);var C;return b=j.size,P=h.size,D=P,z=o,c=!S.alwaysKeepResolution&&I,(C=(function(M){for(;M;){if(M.then)return void M.then(C,e);try{if(M.pop){if(M.length)return M.pop()?i.call(this):M;M=l}else M=M.call(this)}catch(E){return e(E)}}}).bind(this))(l)}}catch(l){return e(l)}}).bind(this),e)}catch(x){return e(x)}}).bind(this),e)}catch(F){return e(F)}}).bind(this),e)}catch(w){return e(w)}}).bind(this),e)}))}const Vr=`
let scriptImported = false
self.addEventListener('message', async (e) => {
  const { file, id, imageCompressionLibUrl, options } = e.data
  options.onProgress = (progress) => self.postMessage({ progress, id })
  try {
    if (!scriptImported) {
      // console.log('[worker] importScripts', imageCompressionLibUrl)
      self.importScripts(imageCompressionLibUrl)
      scriptImported = true
    }
    // console.log('[worker] self', self)
    const compressedFile = await imageCompression(file, options)
    self.postMessage({ file: compressedFile, id })
  } catch (e) {
    // console.error('[worker] error', e)
    self.postMessage({ error: e.message + '\\n' + e.stack, id })
  }
})
`;let ut;function Kr(j,S){return new Promise(((U,f)=>{ut||(ut=(function(d){const a=[];return a.push(d),URL.createObjectURL(new Blob(a))})(Vr));const e=new Worker(ut);e.addEventListener("message",(function(d){if(S.signal&&S.signal.aborted)e.terminate();else if(d.data.progress===void 0){if(d.data.error)return f(new Error(d.data.error)),void e.terminate();U(d.data.file),e.terminate()}else S.onProgress(d.data.progress)})),e.addEventListener("error",f),S.signal&&S.signal.addEventListener("abort",(()=>{f(S.signal.reason),e.terminate()})),e.postMessage({file:j,imageCompressionLibUrl:S.libURL,options:{...S,onProgress:void 0,signal:void 0}})}))}function ue(j,S){return new Promise((function(U,f){let e,t,d,a,p,y;if(e={...S},d=0,{onProgress:a}=e,e.maxSizeMB=e.maxSizeMB||Number.POSITIVE_INFINITY,p=typeof e.useWebWorker!="boolean"||e.useWebWorker,delete e.useWebWorker,e.onProgress=s=>{d=s,typeof a=="function"&&a(d)},!(j instanceof Blob||j instanceof qr))return f(new Error("The file given is not an instance of Blob or File"));if(!/^image/.test(j.type))return f(new Error("The file given is not an image"));if(y=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,!p||typeof Worker!="function"||y)return Ft(j,e).then((function(s){try{return t=s,r.call(this)}catch(h){return f(h)}}).bind(this),f);var n=(function(){try{return r.call(this)}catch(s){return f(s)}}).bind(this),o=function(s){try{return Ft(j,e).then((function(h){try{return t=h,n()}catch(I){return f(I)}}),f)}catch(h){return f(h)}};try{return e.libURL=e.libURL||"https://cdn.jsdelivr.net/npm/browser-image-compression@2.0.2/dist/browser-image-compression.js",Kr(j,e).then((function(s){try{return t=s,n()}catch{return o()}}),o)}catch{o()}function r(){try{t.name=j.name,t.lastModified=j.lastModified}catch{}try{e.preserveExif&&j.type==="image/jpeg"&&(!e.fileType||e.fileType&&e.fileType===j.type)&&(t=qt(j,t))}catch{}return U(t)}}))}ue.getDataUrlFromFile=Yt,ue.getFilefromDataUrl=xt,ue.loadImage=Xt,ue.drawImageInCanvas=er,ue.drawFileInCanvas=nt,ue.canvasToFile=ot,ue.getExifOrientation=tr,ue.handleMaxWidthOrHeight=rr,ue.followExifOrientation=nr,ue.cleanupCanvasMemory=Ae,ue.isAutoOrientationInBrowser=We,ue.approximateBelowMaximumCanvasSizeOfBrowser=Jt,ue.copyExifWithoutOrientation=qt,ue.getBrowserName=Te,ue.version="2.0.2";const Zr=j=>j?wr.includes(j.type)?j.size>wt?{valid:!1,error:`File size exceeds ${wt/1024/1024}MB limit.`}:{valid:!0,error:null}:{valid:!1,error:"Invalid file type. Please upload a JPEG, PNG, or WebP image."}:{valid:!1,error:"No file provided"},Yr=async(j,S)=>{try{const U={maxSizeMB:Ar/1024/1024,maxWidthOrHeight:1920,useWebWorker:!0,fileType:j.type,onProgress:S||void 0};return await ue(j,U)}catch(U){throw console.error("Image compression error:",U),new Error("Failed to compress image")}},Xr=async(j,S,U)=>{try{const f=Zr(j);if(!f.valid)throw new Error(f.error);const e=await Yr(j,n=>{U&&U(n*.3)}),t=Date.now(),d=j.name.replace(/[^a-zA-Z0-9.-]/g,"_"),a=`receipts/${S}/${t}_${d}`,p=Et(Rt,a),y=ur(p,e);return new Promise((n,o)=>{y.on("state_changed",r=>{const s=r.bytesTransferred/r.totalBytes*70+30;U&&U(s)},r=>{console.error("Upload error:",r),o(new Error("Failed to upload image"))},async()=>{try{const r=await hr(y.snapshot.ref);U&&U(100),n({url:r,path:a})}catch(r){console.error("Error getting download URL:",r),o(new Error("Failed to get download URL"))}})})}catch(f){throw console.error("uploadReceiptImage error:",f),f}},at="receipts",Jr=async(j,S,U,f=null)=>{try{const{url:e,path:t}=await Xr(j,S,U),d=Wr(S,e,t),a=Hr(d);if(!a.valid)throw new Error(`Validation error: ${a.errors.join(", ")}`);return(await kt(Dt(Se,at),{...d,householdId:f||null,createdAt:Qe(),updatedAt:Qe()})).id}catch(e){throw console.error("createReceipt error:",e),e}},en=async j=>{try{const S=Me(Se,at,j),U=await pr(S);if(!U.exists())throw new Error("Receipt not found");return{id:U.id,...U.data()}}catch(S){throw console.error("getReceipt error:",S),S}},tn=async j=>{try{const S=Me(Se,at,j);await et(S,{"metadata.analysisStatus":"pending","metadata.processingError":null,"metadata.technicalError":null,"metadata.retryable":null,"metadata.retryCount":Qe(),updatedAt:Qe()});const U=await en(j);await Ut(S),await kt(Dt(Se,at),{...U,id:void 0,metadata:{...U.metadata,analysisStatus:"pending",processingError:null,technicalError:null,retryable:null},updatedAt:Qe()})}catch(S){throw console.error("retryReceiptAnalysis error:",S),S}};function rn({receipt:j,onClick:S,onRetry:U}){const{storeInfo:f,summary:e,metadata:t,imageUrl:d}=j,a=j.id?j.id.charCodeAt(0)%vt.length:0,p=vt[a],n=(s=>{switch(s){case"completed":return{label:" Analyzed",color:"success",icon:g.jsx(Ir,{sx:{fontSize:16}})};case"processing":return{label:" Processing",color:"warning",icon:g.jsx(It,{sx:{fontSize:16}})};case"failed_retryable":return{label:" Try Again",color:"warning",icon:g.jsx(jt,{sx:{fontSize:16}})};case"failed":return{label:" Failed",color:"error",icon:g.jsx(jt,{sx:{fontSize:16}})};default:return{label:" Pending",color:"default",icon:g.jsx(It,{sx:{fontSize:16}})}}})(t?.analysisStatus),o=t?.analysisStatus==="failed_retryable"||t?.retryable,r=s=>{s.stopPropagation(),U&&U(j.id)};return g.jsxs(Pt,{onClick:S,sx:{cursor:"pointer",height:"100%",display:"flex",flexDirection:"column",bgcolor:p.bg,borderRadius:"12px",border:`2px solid ${p.border}`,boxShadow:`3px 3px 0px ${p.shadow}`},children:[g.jsx(Lr,{component:"img",height:"200",image:d,alt:f?.name||"Receipt",sx:{objectFit:"cover",backgroundColor:"grey.100"}}),g.jsxs(Lt,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[g.jsx(V,{sx:{mb:2},children:g.jsx(Wt,{label:n.label,color:t?.analysisStatus==="completed"?void 0:n.color,size:"small",sx:{fontWeight:600,fontFamily:"Outfit, sans-serif",borderRadius:"8px",fontSize:"12px",...t?.analysisStatus==="completed"&&{bgcolor:G.main,color:"white","& .MuiChip-icon":{color:"white"}}}})}),g.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:.75,mb:1},children:[g.jsx(Ot,{sx:{fontSize:"20px",color:p.border}}),g.jsx(Y,{variant:"h6",component:"h3",noWrap:!0,sx:{fontWeight:600,fontFamily:"Outfit, sans-serif",color:p.border,fontSize:"18px"},children:f?.name||"Unknown Store"})]}),g.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:.75,mb:1},children:[g.jsx(Gt,{sx:{fontSize:"16px",color:"text.secondary"}}),g.jsx(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",color:"text.secondary",fontWeight:500,fontSize:"13px"},children:f?.date?_t(f.date):"No date"})]}),g.jsx(Y,{variant:"body2",sx:{mb:2,fontFamily:"Outfit, sans-serif",color:"text.secondary",minHeight:"18px",fontWeight:400,fontSize:"13px"},children:f?.location||""}),g.jsx(V,{sx:{flexGrow:1}}),e?.total!==void 0&&g.jsxs(V,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",pt:2,borderTop:`2px solid ${p.border}`},children:[g.jsx(zt,{sx:{fontSize:"24px",color:p.border}}),g.jsx(Y,{variant:"h5",sx:{fontWeight:700,fontFamily:"Outfit, sans-serif",color:p.border,fontSize:"22px"},children:Be(e.total)})]}),(t?.analysisStatus==="failed"||t?.analysisStatus==="failed_retryable")&&t?.processingError&&g.jsxs(V,{sx:{mt:2},children:[g.jsx(Y,{variant:"body2",color:"error",sx:{mb:1,fontFamily:"Outfit, sans-serif",fontWeight:600},children:t.processingError}),o&&U&&g.jsx(ve,{size:"small",variant:"contained",startIcon:g.jsx(Sr,{}),onClick:r,sx:{mt:1,fontFamily:"Outfit, sans-serif",fontWeight:700,textTransform:"none",borderRadius:"12px",bgcolor:p.border,border:`2px solid ${p.shadow}`,"&:hover":{bgcolor:p.shadow}},children:"Retry Analysis"})]})]})]})}function nn(){return g.jsxs(Pt,{sx:{borderRadius:"24px",border:`4px solid ${Oe.border}`},children:[g.jsx(Pe,{variant:"rectangular",height:200}),g.jsxs(Lt,{children:[g.jsx(Pe,{variant:"rounded",width:100,height:24,sx:{mb:2,borderRadius:"12px"}}),g.jsx(Pe,{variant:"text",width:"80%",height:32,sx:{mb:1}}),g.jsx(Pe,{variant:"text",width:"60%",height:20,sx:{mb:1}}),g.jsx(Pe,{variant:"text",width:"70%",height:20,sx:{mb:2}}),g.jsx(Pe,{variant:"text",width:"40%",height:36})]})]})}function on({receipt:j,open:S,onClose:U}){const[f,e]=te.useState(!1),[t,d]=te.useState(!1),[a,p]=te.useState({open:!1,message:"",severity:"success"}),[y,n]=te.useState(!1),[o,r]=te.useState(null),[s,h]=te.useState(""),[I,k]=te.useState(!1),[b,P]=te.useState(j);if(te.useEffect(()=>{if(!j?.id)return;const C=mr(Me(Se,"receipts",j.id),l=>{l.exists()&&P({id:l.id,...l.data()})},l=>{console.error("Error listening to receipt updates:",l)});return()=>C()},[j?.id]),te.useEffect(()=>{j&&P(j)},[j]),!b)return null;const{storeInfo:D,items:R=[],summary:O,metadata:m,imageUrl:z}=b,c=["produce","meat","dairy","bakery","frozen","pantry","beverages","snacks","household","personal care","health","other"],u=R.map((C,l)=>({...C,originalIndex:l})).sort((C,l)=>{const i=C.category?.toLowerCase()||"other",M=l.category?.toLowerCase()||"other",E=c.indexOf(i),_=c.indexOf(M),N=E===-1?c.length:E,$=_===-1?c.length:_;return N-$}),v=async()=>{d(!0);try{if(await Ut(Me(Se,"receipts",b.id)),b.imagePath){const C=Et(Rt,b.imagePath);await gr(C)}p({open:!0,message:"Receipt deleted successfully!",severity:"success"}),e(!1),setTimeout(()=>{U()},500)}catch(C){console.error("Error deleting receipt:",C),p({open:!0,message:"Failed to delete receipt. Please try again.",severity:"error"})}finally{d(!1)}},A=()=>{p({...a,open:!1})},w=(C,l)=>{r(C),h(l),n(!0)},F=async()=>{if(!(o===null||!s.trim())){k(!0);try{const C=await Er(s.trim()),l=[...R];l[o]={...l[o],name:s.trim(),category:C},await et(Me(Se,"receipts",b.id),{items:l}),p({open:!0,message:"Item updated and recategorized successfully",severity:"success"}),n(!1),r(null),h("")}catch(C){console.error("Error updating item name:",C),p({open:!0,message:"Failed to update item",severity:"error"})}finally{k(!1)}}},x=()=>{n(!1),r(null),h("")};return g.jsxs(Ze,{open:S,onClose:U,maxWidth:"md",fullWidth:!0,PaperProps:{sx:{borderRadius:"16px",border:`2px solid ${G.main}`,boxShadow:`4px 4px 0px ${G.light}`}},children:[g.jsx(Ye,{sx:{pb:1},children:g.jsxs(V,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[g.jsx(Y,{variant:"h5",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,color:G.main,fontSize:"24px"},children:"Receipt Details"}),g.jsxs(V,{sx:{display:"flex",gap:1},children:[g.jsx(Ke,{onClick:()=>e(!0),size:"small",sx:{color:ct.dark,border:`2px solid ${ct.dark}`,"&:hover":{bgcolor:ct.light}},children:g.jsx(Ct,{fontSize:"small"})}),g.jsx(Ke,{onClick:U,size:"small",sx:{border:`2px solid ${He.light}`,"&:hover":{bgcolor:Oe.borderLight}},children:g.jsx(Rr,{fontSize:"small"})})]})]})}),g.jsxs(Xe,{children:[g.jsxs(V,{sx:{display:"flex",gap:2,mb:3,flexDirection:{xs:"column",sm:"row"}},children:[g.jsx(V,{component:"img",src:z,alt:"Receipt",sx:{width:{xs:"100%",sm:"50%"},maxHeight:300,objectFit:"contain",borderRadius:"10px",backgroundColor:"grey.100",border:`2px solid ${Oe.border}`}}),g.jsx(ze,{elevation:0,sx:{flex:1,p:2.5,bgcolor:G.bg,borderRadius:"12px",border:`2px solid ${G.main}`,boxShadow:`2px 2px 0px ${G.light}`,display:"flex",flexDirection:"column",justifyContent:"center"},children:g.jsxs(St,{spacing:1.5,children:[D?.name&&g.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1},children:[g.jsx(Ot,{sx:{fontSize:"20px",color:G.main}}),g.jsx(Y,{variant:"h6",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,color:G.dark,fontSize:"18px"},children:D.name})]}),D?.location&&g.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1},children:[g.jsx(jr,{sx:{fontSize:"16px",color:G.main}}),g.jsx(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontWeight:500,color:G.dark,fontSize:"13px"},children:D.location})]}),D?.date&&g.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1},children:[g.jsx(Gt,{sx:{fontSize:"16px",color:G.main}}),g.jsx(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontWeight:500,color:G.dark,fontSize:"13px"},children:_t(D.date)})]})]})})]}),R.length>0?g.jsxs(g.Fragment,{children:[g.jsxs(Y,{variant:"h6",sx:{mb:2,fontFamily:"Outfit, sans-serif",fontWeight:600,color:G.main,fontSize:"18px"},children:["Items (",R.length,")"]}),g.jsx(ze,{elevation:0,sx:{mb:3,borderRadius:"12px",border:`2px solid ${amber.main}`,boxShadow:`2px 2px 0px ${amber.light}`,p:2},children:(()=>{const C={};return u.forEach(l=>{const i=l.category||"other";C[i]||(C[i]=[]),C[i].push(l)}),Object.entries(C).map(([l,i],M)=>{const E=Ht(l),_=E.icon;return g.jsxs(V,{children:[M>0&&g.jsx(pt,{sx:{my:1.5,borderStyle:"dashed",borderColor:Oe.border}}),g.jsxs(V,{sx:{...Nt(l),gap:.5,mb:1,px:1,py:.5,borderRadius:"6px"},children:[g.jsx(_,{sx:{fontSize:"14px",color:E.color}}),g.jsx(Y,{variant:"caption",sx:{...$t(l),fontSize:"11px",fontWeight:700,textTransform:"uppercase",letterSpacing:"0.5px"},children:E.label})]}),i.map(N=>g.jsxs(V,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:.75,px:.5,borderRadius:"4px","&:hover":{bgcolor:`${E.color}10`}},children:[g.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1,flex:1},children:[g.jsxs(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontWeight:500,fontSize:"12px",color:He.dark,flex:1},children:[N.quantity>1&&g.jsxs(V,{component:"span",sx:{color:Le.main,fontSize:"11px",mr:.5},children:[N.quantity,"x"]}),N.name]}),g.jsx(Ke,{size:"small",onClick:()=>w(N.originalIndex,N.name),sx:{padding:.25,color:"text.secondary","&:hover":{color:G.main,bgcolor:G.bg}},children:g.jsx(Bt,{sx:{fontSize:14}})})]}),g.jsx(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,fontSize:"12px",color:He.darker,minWidth:"60px",textAlign:"right"},children:Be(N.totalPrice)})]},N.originalIndex))]},l)})})()})]}):g.jsx(Y,{variant:"body2",color:"text.secondary",sx:{mb:3,textAlign:"center",py:3},children:"No items extracted yet"}),O&&g.jsxs(ze,{elevation:0,sx:{p:2.5,bgcolor:G.bg,borderRadius:"12px",border:`2px solid ${G.main}`,boxShadow:`2px 2px 0px ${G.light}`},children:[g.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1,mb:2},children:[g.jsx(zt,{sx:{color:G.dark,fontSize:"24px"}}),g.jsx(Y,{variant:"h6",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,color:G.dark,fontSize:"18px"},children:"Summary"})]}),g.jsxs(St,{spacing:1,children:[g.jsxs(V,{sx:{display:"flex",justifyContent:"space-between"},children:[g.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",fontWeight:500,fontSize:"14px"},children:"Subtotal:"}),g.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",fontWeight:500,fontSize:"14px"},children:Be(O.subtotal)})]}),g.jsxs(V,{sx:{display:"flex",justifyContent:"space-between"},children:[g.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",fontWeight:500,fontSize:"14px"},children:"Tax:"}),g.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",fontWeight:500,fontSize:"14px"},children:Be(O.tax)})]}),g.jsx(pt,{sx:{my:1,borderColor:G.light}}),g.jsxs(V,{sx:{display:"flex",justifyContent:"space-between"},children:[g.jsx(Y,{variant:"h6",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,color:G.dark,fontSize:"18px"},children:"Total:"}),g.jsx(Y,{variant:"h6",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,color:G.dark,fontSize:"18px"},children:Be(O.total)})]})]})]}),m?.analysisStatus&&g.jsx(V,{sx:{mt:2,textAlign:"center"},children:g.jsxs(Y,{variant:"caption",color:"text.secondary",children:["Status: ",m.analysisStatus,m.geminiFeedback&&`  Confidence: ${m.geminiFeedback}`]})})]}),g.jsxs(Ze,{open:f,onClose:()=>!t&&e(!1),maxWidth:"xs",fullWidth:!0,children:[g.jsx(Ye,{children:"Delete Receipt?"}),g.jsx(Xe,{children:g.jsx(Y,{children:"Are you sure you want to delete this receipt? This will permanently remove the receipt data and image. This action cannot be undone."})}),g.jsxs(ht,{children:[g.jsx(ve,{onClick:()=>e(!1),disabled:t,children:"Cancel"}),g.jsx(ve,{onClick:v,color:"error",variant:"contained",disabled:t,startIcon:t?null:g.jsx(Ct,{}),children:t?"Deleting...":"Delete"})]})]}),g.jsxs(Ze,{open:y,onClose:x,maxWidth:"sm",fullWidth:!0,children:[g.jsx(Ye,{children:"Edit Item Name"}),g.jsx(Xe,{children:g.jsx(V,{sx:{pt:1},children:g.jsx(Qt,{autoFocus:!0,fullWidth:!0,label:"Item Name",value:s,onChange:C=>h(C.target.value),onKeyPress:C=>{C.key==="Enter"&&F()},helperText:"Update the product name - will automatically recategorize with AI",disabled:I})})}),g.jsxs(ht,{children:[g.jsx(ve,{onClick:x,disabled:I,children:"Cancel"}),g.jsx(ve,{onClick:F,variant:"contained",disabled:!s.trim()||I,children:I?"Saving...":"Save"})]})]}),g.jsx(Tt,{open:a.open,autoHideDuration:4e3,onClose:A,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:g.jsx(Mt,{onClose:A,severity:a.severity,sx:{width:"100%"},children:a.message})})]})}function Rn(){const{currentUser:j}=xr(),{receipts:S,loading:U}=yr(),[f,e]=te.useState(null),[t,d]=te.useState(!1),[a,p]=te.useState(0),[y,n]=te.useState(""),[o,r]=te.useState({dateRange:"all",category:"all"}),[s,h]=te.useState("date-desc"),[I,k]=te.useState("name-asc"),[b,P]=te.useState(!1),[D,R]=te.useState(null),[O,m]=te.useState(""),[z,c]=te.useState({open:!1,message:"",severity:"success"}),[u,v]=te.useState(!1),[A,w]=te.useState(0),F=te.useRef(null),x=te.useRef(null),C=te.useRef(new Set);te.useEffect(()=>{!j||!S.length||S.forEach(async W=>{if(W.items&&W.items.length>0&&W.metadata?.analysisStatus==="completed"&&!W.metadata?.addedToPantry&&!C.current.has(W.id)){C.current.add(W.id);try{const L=await Cr(j.uid,W.id,W.items,W.storeInfo?.name);await et(Me(Se,"receipts",W.id),{"metadata.addedToPantry":!0,"metadata.pantryItemsAdded":L}),L>0&&c({open:!0,message:`Added ${L} item${L!==1?"s":""} to pantry!`,severity:"success"})}catch(L){console.error("Error adding items to pantry:",L)}}})},[S,j]);const l=W=>{e(W),d(!0)},i=async W=>{try{await tn(W),c({open:!0,message:"Retrying analysis... Please wait a moment.",severity:"info"})}catch(L){console.error("Retry error:",L),c({open:!0,message:"Failed to retry. Please try again.",severity:"error"})}},M=async W=>{if(!j){c({open:!0,message:"You must be logged in to upload receipts",severity:"error"});return}try{v(!0),w(0),await Jr(W,j.uid,L=>{w(L)}),c({open:!0,message:"Receipt uploaded successfully! Analyzing...",severity:"success"})}catch(L){console.error("Upload error:",L),c({open:!0,message:L.message||"Failed to upload receipt",severity:"error"})}finally{v(!1),w(0)}},E=W=>{const L=W.target.files?.[0];L&&M(L)},_=()=>{F.current?.click()},N=()=>{x.current?.click()},$=()=>{c({...z,open:!1})},Q=()=>{d(!1),e(null)},H=(W,L)=>{p(L),n("")},T=te.useMemo(()=>{const W=[];return S.forEach(L=>{L.items&&Array.isArray(L.items)&&L.items.forEach((B,X)=>{W.push({...B,itemId:`${L.id}-${X}`,receiptId:L.id,receiptStore:L.storeInfo?.name||"Unknown Store",receiptDate:L.storeInfo?.date,receiptLocation:L.storeInfo?.location})})}),W},[S]),q=te.useMemo(()=>{let W=[...S];if(y){const L=y.toLowerCase();W=W.filter(B=>{const X=B.storeInfo?.name?.toLowerCase()||"",Z=B.storeInfo?.location?.toLowerCase()||"",se=B.items?.map(ae=>ae.name?.toLowerCase()).join(" ")||"",ee=B.items?.map(ae=>ae.receiptText?.toLowerCase()).join(" ")||"",K=B.items?.flatMap(ae=>ae.keywords||[]).map(ae=>ae.toLowerCase()).join(" ")||"";return X.includes(L)||Z.includes(L)||se.includes(L)||ee.includes(L)||K.includes(L)})}if(o.dateRange!=="all"){const L=new Date,B=new Date;switch(o.dateRange){case"today":B.setHours(0,0,0,0);break;case"7days":B.setDate(L.getDate()-7);break;case"30days":B.setDate(L.getDate()-30);break;case"90days":B.setDate(L.getDate()-90);break}W=W.filter(X=>(X.createdAt?.toDate()||new Date(0))>=B)}return o.category!=="all"&&(W=W.filter(L=>L.items?.some(B=>B.category===o.category))),W.sort((L,B)=>{switch(s){case"date-desc":return(B.createdAt?.toDate()||new Date(0))-(L.createdAt?.toDate()||new Date(0));case"date-asc":return(L.createdAt?.toDate()||new Date(0))-(B.createdAt?.toDate()||new Date(0));case"amount-desc":return(B.summary?.total||0)-(L.summary?.total||0);case"amount-asc":return(L.summary?.total||0)-(B.summary?.total||0);case"store-asc":return(L.storeInfo?.name||"").localeCompare(B.storeInfo?.name||"");default:return 0}}),W},[S,y,o,s]),re=te.useMemo(()=>{let W=[...T];if(y.trim()){const L=y.toLowerCase().trim();W=W.filter(B=>!!(B.name?.toLowerCase().includes(L)||B.receiptText?.toLowerCase().includes(L)||B.keywords&&Array.isArray(B.keywords)&&B.keywords.some(X=>X.toLowerCase().includes(L))||B.category?.toLowerCase().includes(L)||B.receiptStore?.toLowerCase().includes(L)||B.receiptLocation?.toLowerCase().includes(L)))}if(o.dateRange!=="all"){const L=new Date,B=new Date;switch(o.dateRange){case"today":B.setHours(0,0,0,0);break;case"7days":B.setDate(L.getDate()-7);break;case"30days":B.setDate(L.getDate()-30);break;case"90days":B.setDate(L.getDate()-90);break}W=W.filter(X=>X.receiptDate?X.receiptDate.toDate()>=B:!1)}switch(o.category!=="all"&&(W=W.filter(L=>L.category===o.category)),I){case"name-asc":W.sort((L,B)=>(L.name||"").localeCompare(B.name||""));break;case"name-desc":W.sort((L,B)=>(B.name||"").localeCompare(L.name||""));break;case"store-asc":W.sort((L,B)=>(L.receiptStore||"").localeCompare(B.receiptStore||""));break;case"store-desc":W.sort((L,B)=>(B.receiptStore||"").localeCompare(L.receiptStore||""));break;case"amount-asc":W.sort((L,B)=>(L.totalPrice||0)-(B.totalPrice||0));break;case"amount-desc":W.sort((L,B)=>(B.totalPrice||0)-(L.totalPrice||0));break}return W},[T,y,o,I]),ne=W=>{R(W),m(W.name),P(!0)},J=async()=>{if(!(!D||!O.trim()))try{const W=Me(Se,"receipts",D.receiptId),L=S.find(Z=>Z.id===D.receiptId);if(!L)throw new Error("Receipt not found");const B=L.items.findIndex((Z,se)=>`${D.receiptId}-${se}`===D.itemId);if(B===-1)throw new Error("Item not found in receipt");const X=[...L.items];X[B]={...X[B],name:O.trim()},await et(W,{items:X}),c({open:!0,message:"Item name updated successfully",severity:"success"}),P(!1),R(null),m("")}catch(W){console.error("Error updating item name:",W),c({open:!0,message:"Failed to update item name",severity:"error"})}},oe=()=>{P(!1),R(null),m("")};return g.jsx(V,{sx:{background:`linear-gradient(180deg, ${G.bg} 0%, ${Ee} 100%)`,minHeight:"100vh",pb:4},children:g.jsxs(br,{maxWidth:"lg",children:[g.jsxs(V,{sx:{pt:4,pb:3},children:[g.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:2,mb:1,flexWrap:"wrap"},children:[g.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[a===0?g.jsx(dt,{sx:{fontSize:{xs:28,md:34},color:G.main}}):g.jsx(At,{sx:{fontSize:{xs:28,md:34},color:G.main}}),g.jsx(Y,{variant:"h3",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,color:G.main,fontSize:{xs:"28px",md:"34px"}},children:a===0?"Receipts":"All Items"})]}),a===0&&g.jsxs(V,{sx:{display:"flex",gap:1.5},children:[g.jsx(ve,{variant:"outlined",startIcon:u?g.jsx(ft,{size:16}):g.jsx(kr,{}),onClick:N,disabled:u,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:G.main,borderColor:G.main,px:2,"&:hover":{borderColor:G.darker,bgcolor:G.bg}},children:"Photo"}),g.jsx(ve,{variant:"outlined",startIcon:u?g.jsx(ft,{size:16}):g.jsx(Dr,{}),onClick:_,disabled:u,sx:{fontFamily:"Outfit, sans-serif",textTransform:"none",color:G.main,borderColor:G.main,px:2,"&:hover":{borderColor:G.darker,bgcolor:G.bg}},children:"Upload"})]})]}),g.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",color:qe.main,fontWeight:400},children:a===0?S.length>0?`${q.length} of ${S.length} receipt${S.length===1?"":"s"}`:"Upload your first receipt to get started!":`${re.length} total item${re.length!==1?"s":""}`}),u&&g.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1,mt:2},children:[g.jsx(ft,{size:20,sx:{color:G.main}}),g.jsx(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",color:G.dark,fontSize:"13px"},children:"Analyzing receipt..."})]})]}),g.jsx("input",{ref:F,type:"file",accept:"image/*",style:{display:"none"},onChange:E}),g.jsx("input",{ref:x,type:"file",accept:"image/*",capture:"environment",style:{display:"none"},onChange:E}),!U&&S.length>0&&g.jsxs(V,{sx:{mb:3,display:"flex",gap:1},children:[g.jsx(ve,{onClick:W=>H(W,0),sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,fontSize:"13px",px:2,py:.75,borderRadius:"8px",textTransform:"none",color:a===0?Ee:G.main,bgcolor:a===0?G.main:Ee,border:"1px solid",borderColor:a===0?G.main:Oe.border,minWidth:"auto",transition:"all 0.15s ease","&:hover":{bgcolor:a===0?G.darker:Le.bg,borderColor:a===0?G.darker:Le.light}},startIcon:g.jsx(dt,{fontSize:"small"}),children:"Receipts"}),g.jsx(ve,{onClick:W=>H(W,1),sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,fontSize:"13px",px:2,py:.75,borderRadius:"8px",textTransform:"none",color:a===1?Ee:G.main,bgcolor:a===1?G.main:Ee,border:"1px solid",borderColor:a===1?G.main:Oe.border,minWidth:"auto",transition:"all 0.15s ease","&:hover":{bgcolor:a===1?G.darker:Le.bg,borderColor:a===1?G.darker:Le.light}},startIcon:g.jsx(At,{fontSize:"small"}),children:"Items"})]}),!U&&S.length>0&&g.jsx(Ur,{onSearchChange:n,onFilterChange:r,onSortChange:a===0?h:k,hideSortDropdown:a===1}),U&&g.jsx(Ve,{container:!0,spacing:3,children:[1,2,3,4,5,6].map(W=>g.jsx(Ve,{item:!0,xs:12,sm:6,md:4,children:g.jsx(nn,{})},W))}),!U&&S.length===0&&g.jsxs(ze,{elevation:0,sx:{p:8,textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",gap:2,bgcolor:Ee,borderRadius:"24px",border:`4px solid ${blue.bg}`,boxShadow:`6px 6px 0px ${blue.bg}`},children:[g.jsx(dt,{sx:{fontSize:"80px",mb:1,color:G.light}}),g.jsx(Y,{variant:"h5",sx:{fontFamily:"Outfit, sans-serif",fontWeight:800,color:G.main},children:"No Receipts Yet!"}),g.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",color:qe.main,maxWidth:400},children:"Upload your first receipt to start tracking your grocery spending"})]}),!U&&S.length>0&&a===0&&g.jsxs(g.Fragment,{children:[q.length===0&&g.jsxs(ze,{elevation:0,sx:{p:8,textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",gap:2,bgcolor:Ee,borderRadius:"24px",border:`4px solid ${pink.bg}`,boxShadow:`6px 6px 0px ${pink.bg}`},children:[g.jsx(V,{sx:{fontSize:"80px",mb:1},children:""}),g.jsx(Y,{variant:"h5",sx:{fontFamily:"Outfit, sans-serif",fontWeight:800,color:G.main},children:"No Receipts Found"}),g.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",color:qe.main},children:"Try adjusting your search or filters"})]}),q.length>0&&g.jsx(Ve,{container:!0,spacing:3,children:q.map(W=>g.jsx(Ve,{item:!0,xs:12,sm:6,md:4,children:g.jsx(rn,{receipt:W,onClick:()=>l(W),onRetry:i})},W.id))})]}),!U&&S.length>0&&a===1&&g.jsxs(g.Fragment,{children:[re.length===0&&(y||o.category!=="all"||o.dateRange!=="all")&&g.jsxs(ze,{elevation:0,sx:{p:6,textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",gap:2,bgcolor:Ee,borderRadius:"24px",border:`4px solid ${G.light}`,boxShadow:`6px 6px 0px ${G.light}`},children:[g.jsx(V,{sx:{fontSize:"64px",mb:1},children:""}),g.jsx(Y,{variant:"h6",sx:{fontFamily:"Outfit, sans-serif",fontWeight:800,color:G.main},children:"No Items Found"}),g.jsx(Y,{variant:"body1",sx:{fontFamily:"Outfit, sans-serif",color:qe.main},children:"Try adjusting your search or filters"})]}),re.length>0&&g.jsx(ze,{elevation:0,sx:{borderRadius:"16px",border:`3px solid ${amber.main}`,boxShadow:`3px 3px 0px ${amber.light}`,p:2.5},children:(()=>{const W=["produce","meat","dairy","bakery","frozen","pantry","beverages","snacks","household","personal care","health","other"],L=[...re].sort((X,Z)=>{const se=X.category?.toLowerCase()||"other",ee=Z.category?.toLowerCase()||"other",K=W.indexOf(se),ae=W.indexOf(ee),fe=K===-1?W.length:K,le=ae===-1?W.length:ae;return fe-le}),B={};return L.forEach(X=>{const Z=X.category||"other";B[Z]||(B[Z]=[]),B[Z].push(X)}),Object.entries(B).map(([X,Z],se)=>{const ee=Ht(X);return g.jsxs(V,{children:[se>0&&g.jsx(pt,{sx:{my:2,borderStyle:"dashed",borderColor:Oe.border}}),g.jsxs(V,{sx:{...Nt(X),mb:1.5},children:[g.jsx(Y,{variant:"subtitle2",sx:{...$t(X),fontSize:"13px",fontWeight:700},children:ee.label}),g.jsx(Wt,{label:`${Z.length}`,size:"small",sx:Fr(X)})]}),Z.map(K=>g.jsxs(V,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",py:1,px:1,borderRadius:"8px","&:hover":{bgcolor:`${ee.color}10`}},children:[g.jsxs(V,{sx:{display:"flex",flexDirection:"column",gap:.5,flex:1},children:[g.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:.5},children:[g.jsxs(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontWeight:600,fontSize:"13px",color:He.darker},children:[K.quantity>1&&g.jsxs(V,{component:"span",sx:{color:Le.main,fontSize:"12px",mr:.5},children:[K.quantity,"x"]}),K.name]}),g.jsx(Ke,{size:"small",onClick:()=>ne(K),sx:{padding:.25,color:"text.secondary","&:hover":{color:G.main,bgcolor:G.bg}},children:g.jsx(Bt,{sx:{fontSize:14}})})]}),g.jsxs(V,{sx:{display:"flex",alignItems:"center",gap:1},children:[g.jsx(Y,{variant:"caption",sx:{fontFamily:"Outfit, sans-serif",fontSize:"11px",color:G.main,fontWeight:600},children:K.receiptStore}),K.receiptDate&&g.jsx(Y,{variant:"caption",sx:{fontFamily:"Outfit, sans-serif",fontSize:"11px",color:He.light},children:zr(K.receiptDate.toDate(),"MMM d, yyyy")})]})]}),g.jsxs(Y,{variant:"body2",sx:{fontFamily:"Outfit, sans-serif",fontWeight:700,fontSize:"13px",color:He.darker,minWidth:"70px",textAlign:"right"},children:["$",(K.totalPrice||0).toFixed(2)]})]},K.itemId))]},X)})})()})]}),g.jsx(on,{receipt:f,open:t,onClose:Q}),g.jsxs(Ze,{open:b,onClose:oe,maxWidth:"sm",fullWidth:!0,children:[g.jsx(Ye,{children:"Edit Item Name"}),g.jsx(Xe,{children:g.jsx(V,{sx:{pt:1},children:g.jsx(Qt,{autoFocus:!0,fullWidth:!0,label:"Item Name",value:O,onChange:W=>m(W.target.value),onKeyPress:W=>{W.key==="Enter"&&J()},helperText:"Update the product name (e.g., 'Tillamook Ice Cream' instead of 'Tillamook Cheese')"})})}),g.jsxs(ht,{children:[g.jsx(ve,{onClick:oe,children:"Cancel"}),g.jsx(ve,{onClick:J,variant:"contained",disabled:!O.trim(),children:"Save"})]})]}),g.jsx(Tt,{open:z.open,autoHideDuration:4e3,onClose:$,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:g.jsx(Mt,{onClose:$,severity:z.severity,sx:{width:"100%"},children:z.message})})]})})}export{Rn as default};
